"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[8667],{9798:(e,a,n)=>{n.d(a,{Z:()=>o});var t=n(7378),l=n(8944);const r="tabItem_wHwb";function o(e){let{children:a,hidden:n,className:o}=e;return t.createElement("div",{role:"tabpanel",className:(0,l.Z)(r,o),hidden:n},a)}},3337:(e,a,n)=>{n.d(a,{Z:()=>d});var t=n(5773),l=n(7378),r=n(8944),o=n(6457),i=n(784),s=n(9947),p=n(3457);const c="tabList_J5MA",m="tabItem_l0OV";function u(e){var a;const{lazy:n,block:o,defaultValue:u,values:d,groupId:k,className:g}=e,h=l.Children.map(e.children,(e=>{if((0,l.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),b=d??h.map((e=>{let{props:{value:a,label:n,attributes:t}}=e;return{value:a,label:n,attributes:t}})),f=(0,i.l)(b,((e,a)=>e.value===a.value));if(f.length>0)throw new Error(`Docusaurus error: Duplicate values "${f.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const N=null===u?u:u??(null==(a=h.find((e=>e.props.default)))?void 0:a.props.value)??h[0].props.value;if(null!==N&&!b.some((e=>e.value===N)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${N}" but none of its children has the corresponding value. Available values are: ${b.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:v,setTabGroupChoices:y}=(0,s.U)(),[w,x]=(0,l.useState)(N),C=[],{blockElementScrollPositionUntilNextRender:I}=(0,p.o5)();if(null!=k){const e=v[k];null!=e&&e!==w&&b.some((a=>a.value===e))&&x(e)}const Z=e=>{const a=e.currentTarget,n=C.indexOf(a),t=b[n].value;t!==w&&(I(a),x(t),null!=k&&y(k,String(t)))},j=e=>{var a;let n=null;switch(e.key){case"ArrowRight":{const a=C.indexOf(e.currentTarget)+1;n=C[a]??C[0];break}case"ArrowLeft":{const a=C.indexOf(e.currentTarget)-1;n=C[a]??C[C.length-1];break}}null==(a=n)||a.focus()};return l.createElement("div",{className:(0,r.Z)("tabs-container",c)},l.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":o},g)},b.map((e=>{let{value:a,label:n,attributes:o}=e;return l.createElement("li",(0,t.Z)({role:"tab",tabIndex:w===a?0:-1,"aria-selected":w===a,key:a,ref:e=>C.push(e),onKeyDown:j,onFocus:Z,onClick:Z},o,{className:(0,r.Z)("tabs__item",m,null==o?void 0:o.className,{"tabs__item--active":w===a})}),n??a)}))),n?(0,l.cloneElement)(h.filter((e=>e.props.value===w))[0],{className:"margin-top--md"}):l.createElement("div",{className:"margin-top--md"},h.map(((e,a)=>(0,l.cloneElement)(e,{key:a,hidden:e.props.value!==w})))))}function d(e){const a=(0,o.Z)();return l.createElement(u,(0,t.Z)({key:String(a)},e))}},6642:(e,a,n)=>{n.d(a,{Z:()=>p});var t=n(7378),l=n(4267),r=n(9798),o=n(3337);function i(e,a,n){let t=e.package?`yarn workspace ${e.package} add `:"yarn add ";return e.dev?t+="--dev ":e.peer&&(t+="--peer "),n&&a&&!e.package&&(t+="-W "),t+=e.dep,t}function s(e,a){let n="pnpm add ";return e.dev?n+="--save-dev ":e.peer&&(n+="--save-peer "),e.package?n+=`--filter ${e.package} `:a&&(n+="-w "),n+=e.dep,n}function p(e){let a=i(e,!1,!0),n=s(e,!1);return e.package||(a+="\n\n# If using workspaces\n",n+="\n\n# If using workspaces\n",a+=i(e,!0,!0),n+=s(e,!0)),t.createElement(o.Z,{groupId:"package-manager",defaultValue:"yarn",values:[{label:"Yarn",value:"yarn"},{label:"Yarn (classic)",value:"yarn1"},{label:"npm",value:"npm"},{label:"pnpm",value:"pnpm"}]},t.createElement(r.Z,{value:"yarn"},t.createElement(l.Z,{language:"shell"},i(e,!1,!1))),t.createElement(r.Z,{value:"yarn1"},t.createElement(l.Z,{language:"shell"},a)),t.createElement(r.Z,{value:"npm"},t.createElement(l.Z,{language:"shell"},function(e){let a="npm install ";return e.dev?a+="--save-dev ":e.peer&&(a+="--save-peer "),e.package&&(a+=`--workspace ${e.package} `),a+=e.dep,a}(e))),t.createElement(r.Z,{value:"pnpm"},t.createElement(l.Z,{language:"shell"},n)))}},7915:(e,a,n)=>{n.d(a,{Z:()=>o});var t=n(7378),l=n(3469),r=n(9619);function o(e){let{text:a}=e;return t.createElement(r.Z,{text:a,icon:l.SZw,variant:"success",className:"absolute right-0 top-1.5"})}},9634:(e,a,n)=>{n.d(a,{Z:()=>m});var t=n(7378),l=n(1884),r=n(5773),o=n(9928),i=n(3469),s=n(1792);const p={discord:o.omb,github:o.zhw,moon:i.Gp0,"new-project":i.g6h,"new-task":i.EQ8,project:i.pL1,"project-config":i.dhu,"project-config-global":i.YdP,"project-graph":i.Bkj,"run-task":i.sl_,task:i.diR,"task-config":i.o$R,token:i.BwA,toolchain:i.AlB,twitter:o.mdU,workspace:i.emM,"workspace-config":i.cRF};function c(e){let{name:a,...n}=e;return t.createElement(s.Z,(0,r.Z)({},n,{icon:p[a]}))}function m(e){let{links:a}=e;return t.createElement("div",{className:"grid grid-cols-1 gap-2 sm:grid-cols-2"},a.map((e=>t.createElement(l.default,{key:e.url,href:e.url,className:"focus:outline-none"},t.createElement("div",{className:"relative rounded-lg px-3 py-3 flex items-center space-x-2 border-solid border border-t-0 border-b-2 bg-gray-50 hover:bg-gray-100/90 border-gray-200/75 dark:bg-slate-700 dark:hover:bg-slate-600 dark:border-slate-900/75"},t.createElement("div",{className:"flex-shrink-0"},t.createElement(c,{size:"lg",name:e.icon})),t.createElement("div",{className:"flex-1 min-w-0 text-gray-900 dark:text-gray-100"},e.label))))))}},9619:(e,a,n)=>{n.d(a,{Z:()=>i});var t=n(7378),l=n(8944),r=n(1792);const o={failure:"bg-red-100 text-red-900",info:"bg-pink-100 text-pink-900",success:"bg-green-100 text-green-900",warning:"bg-orange-100 text-orange-900"};function i(e){let{className:a,icon:n,text:i,variant:s}=e;return t.createElement("span",{className:(0,l.Z)("inline-flex items-center px-1 py-0.5 rounded text-xs font-bold uppercase",s?o[s]:"bg-gray-100 text-gray-800",a)},n&&t.createElement(r.Z,{icon:n,className:"mr-1"}),i)}},6841:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>d,contentTitle:()=>m,default:()=>h,frontMatter:()=>c,metadata:()=>u,toc:()=>k});var t=n(5773),l=(n(7378),n(5318)),r=n(3337),o=n(9798),i=n(7915),s=n(9634),p=n(6642);const c={title:"Install moon"},m=void 0,u={unversionedId:"install",id:"install",title:"Install moon",description:"The following guide can be used for adding moon to an existing repository (with incremental",source:"@site/docs/install.mdx",sourceDirName:".",slug:"/install",permalink:"/docs/install",draft:!1,editUrl:"https://github.com/moonrepo/moon/tree/master/website/docs/install.mdx",tags:[],version:"current",frontMatter:{title:"Install moon"},sidebar:"docs",previous:{title:"Introduction",permalink:"/docs/"},next:{title:"Setup workspace",permalink:"/docs/setup-workspace"}},d={},k=[{value:"Choosing a package manager",id:"choosing-a-package-manager",level:2},{value:"Enabling workspaces",id:"enabling-workspaces",level:3},{value:"Installing the CLI",id:"installing-the-cli",level:2},{value:"Accessing the <code>moon</code> binary",id:"accessing-the-moon-binary",level:3},{value:"Adding a package script",id:"adding-a-package-script",level:3},{value:"Supported targets",id:"supported-targets",level:3},{value:"Initializing moon",id:"initializing-moon",level:2},{value:"Next steps",id:"next-steps",level:2}],g={toc:k};function h(e){let{components:a,...n}=e;return(0,l.kt)("wrapper",(0,t.Z)({},g,n,{components:a,mdxType:"MDXLayout"}),(0,l.kt)(i.Z,{text:"5 min",mdxType:"HeaderLabel"}),(0,l.kt)("p",null,"The following guide can be used for adding moon to an existing repository (with incremental\nadoption), or to a fresh repository. All that's required is..."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://nodejs.org/en/"},"Node.js")," and basic knowledge of the ecosystem"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://git-scm.com/"},"git")," >= 2.20, a version control system"),(0,l.kt)("li",{parentName:"ul"},"A ",(0,l.kt)("inlineCode",{parentName:"li"},"package.json")," in your repository root")),(0,l.kt)(r.Z,{groupId:"repo-type",defaultValue:"new",values:[{label:"New repo",value:"new"},{label:"Existing repo",value:"existing"}],mdxType:"Tabs"},(0,l.kt)(o.Z,{value:"new",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"git init ./app\ncd ./app\nnpm init\n"))),(0,l.kt)(o.Z,{value:"existing",mdxType:"TabItem"},(0,l.kt)("p",null,"If you already have a root ",(0,l.kt)("inlineCode",{parentName:"p"},"package.json"),", continue to the next section, otherwise..."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"npm init\n")))),(0,l.kt)("h2",{id:"choosing-a-package-manager"},"Choosing a package manager"),(0,l.kt)("p",null,'Before we install moon, we should briefly talk about Node.js package managers. To start, moon does\nnot replace a package manager, nor does it apply any "magic" for them to work differently. Instead,\nmoon builds upon a package manager to provide a robust build system, assumes a standard\n',(0,l.kt)("inlineCode",{parentName:"p"},"node_modules")," layout and module resolution algorithm, and supports any of the following 3 package\nmanagers."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://docs.npmjs.com/"},"npm")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://pnpm.io/"},"pnpm")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://yarnpkg.com/"},"Yarn")," (v1, v2+ in ",(0,l.kt)("inlineCode",{parentName:"li"},"node-modules")," linker mode)")),(0,l.kt)("p",null,"We suggest Yarn 3 for its powerful workspaces implementation, extensive support for native binaries,\nbuilt-in package patching, and blazing speed, but feel free to choose the one that works best for\nyou!"),(0,l.kt)("h3",{id:"enabling-workspaces"},"Enabling workspaces"),(0,l.kt)("p",null,"moon was built with monorepos in mind, and as such, has first-class support for them through package\nworkspaces (but is not a requirement). To utilize workspaces, enable them for your chosen package\nmanager."),(0,l.kt)(r.Z,{groupId:"package-manager",defaultValue:"yarn",values:[{label:"Yarn",value:"yarn"},{label:"Yarn (classic)",value:"yarn1"},{label:"npm",value:"npm"},{label:"pnpm",value:"pnpm"}],mdxType:"Tabs"},(0,l.kt)(o.Z,{value:"yarn",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="package.json"',title:'"package.json"'},'{\n  // ...\n  "workspaces": ["apps/*", "packages/*"]\n}\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title=".yarnrc.yml"',title:'".yarnrc.yml"'},"# ...\nnodeLinker: 'node-modules'\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://yarnpkg.com/features/workspaces"},"Documentation")))),(0,l.kt)(o.Z,{value:"yarn1",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="package.json"',title:'"package.json"'},'{\n  // ...\n  "workspaces": ["apps/*", "packages/*"]\n}\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://classic.yarnpkg.com/en/docs/workspaces"},"Documentation")))),(0,l.kt)(o.Z,{value:"npm",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="package.json"',title:'"package.json"'},'{\n  // ...\n  "workspaces": ["apps/*", "packages/*"]\n}\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://docs.npmjs.com/cli/v8/using-npm/workspaces"},"Documentation")))),(0,l.kt)(o.Z,{value:"pnpm",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="pnpm-workspace.yaml"',title:'"pnpm-workspace.yaml"'},"packages:\n    - 'apps/*'\n    - 'packages/*'\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://pnpm.io/workspaces"},"Documentation"))))),(0,l.kt)("h2",{id:"installing-the-cli"},"Installing the CLI"),(0,l.kt)("p",null,"The entirety of moon is packaged and shipped as a single binary through the\n",(0,l.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/@moonrepo/cli"},(0,l.kt)("inlineCode",{parentName:"a"},"@moonrepo/cli"))," npm package. Begin by installing this\npackage at the root of the repository."),(0,l.kt)(p.Z,{dep:"@moonrepo/cli",dev:!0,mdxType:"AddDepsTabs"}),(0,l.kt)("h3",{id:"accessing-the-moon-binary"},"Accessing the ",(0,l.kt)("inlineCode",{parentName:"h3"},"moon")," binary"),(0,l.kt)("p",null,"For developers, we suggest installing the\n",(0,l.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/@moonrepo/cli"},(0,l.kt)("inlineCode",{parentName:"a"},"@moonrepo/cli"))," package globally, so that you can\neasily run ",(0,l.kt)("inlineCode",{parentName:"p"},"moon")," commands from ",(0,l.kt)("em",{parentName:"p"},"any")," directory, instead of relying on ",(0,l.kt)("inlineCode",{parentName:"p"},"package.json")," scripts. When\nusing this approach, the global must be installed with npm (not pnpm or yarn)!"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"npm install -g @moonrepo/cli\n")),(0,l.kt)("p",null,"Don't worry though, when using the global binary, we ensure the same version of moon is being\nexecuted that was defined as a dependency in the repo."),(0,l.kt)("h3",{id:"adding-a-package-script"},"Adding a package script"),(0,l.kt)("p",null,"For other scenarios or environments, like CI, ",(0,l.kt)("inlineCode",{parentName:"p"},"moon")," can be ran with through a ",(0,l.kt)("inlineCode",{parentName:"p"},"package.json")," script\n-- but this comes with a cost -- which is the overhead of launching Node.js and your chosen package\nmanager to execute the Rust binary, ",(0,l.kt)("em",{parentName:"p"},"instead of")," executing the Rust binary directly. If this is\nproblematic, feel free to use the global approach above."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="package.json"',title:'"package.json"'},'{\n  // ...\n  "scripts": {\n    // ...\n    "moon": "moon",\n    // For Yarn 2+\n    "moon": "$(yarn bin moon)"\n  }\n}\n')),(0,l.kt)("admonition",{type:"caution"},(0,l.kt)("p",{parentName:"admonition"},"Yarn 2+ does not support executing Rust binaries through package scripts\n(",(0,l.kt)("a",{parentName:"p",href:"https://github.com/yarnpkg/berry/issues/882"},"issue"),"), so we must access the full binary path and\nexecute on that.")),(0,l.kt)("p",null,"With this script, moon can then be run with ",(0,l.kt)("inlineCode",{parentName:"p"},"npm run moon ...")," (or ",(0,l.kt)("inlineCode",{parentName:"p"},"yarn run"),", or ",(0,l.kt)("inlineCode",{parentName:"p"},"pnpm run"),"), but\ndo note that this pattern ",(0,l.kt)("em",{parentName:"p"},"will not")," work with package workspaces unless the script is ran from the\nrepository root."),(0,l.kt)("h3",{id:"supported-targets"},"Supported targets"),(0,l.kt)("p",null,"Because moon is written in Rust, we only support targets that are explicitly compiled for, which are\ncurrently:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"macOS 64-bit - Intel (",(0,l.kt)("inlineCode",{parentName:"li"},"x86_64-apple-darwin"),")"),(0,l.kt)("li",{parentName:"ul"},"macOS 64-bit - Silicon (",(0,l.kt)("inlineCode",{parentName:"li"},"aarch64-apple-darwin"),")"),(0,l.kt)("li",{parentName:"ul"},"Linux 64-bit - GNU - Intel (",(0,l.kt)("inlineCode",{parentName:"li"},"x86_64-unknown-linux-gnu"),")"),(0,l.kt)("li",{parentName:"ul"},"Linux 64-bit - musl - Intel (",(0,l.kt)("inlineCode",{parentName:"li"},"x86_64-unknown-linux-musl"),")"),(0,l.kt)("li",{parentName:"ul"},"Linux 64-bit - GNU - Arm (",(0,l.kt)("inlineCode",{parentName:"li"},"aarch64-unknown-linux-gnu"),")"),(0,l.kt)("li",{parentName:"ul"},"Linux 64-bit - musl - Arm (",(0,l.kt)("inlineCode",{parentName:"li"},"aarch64-unknown-linux-musl"),")"),(0,l.kt)("li",{parentName:"ul"},"Windows 64-bit (",(0,l.kt)("inlineCode",{parentName:"li"},"x86_64-pc-windows-msvc"),")")),(0,l.kt)("h2",{id:"initializing-moon"},"Initializing moon"),(0,l.kt)("p",null,"Now that we have the CLI installed, let's scaffold and initialize moon in a repository with the\n",(0,l.kt)("a",{parentName:"p",href:"./commands/init"},(0,l.kt)("inlineCode",{parentName:"a"},"moon init"))," command. Be sure to ",(0,l.kt)("a",{parentName:"p",href:"#accessing-the-moon-binary"},"access the binary"),"\nas mentioned above."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"$ moon init\n")),(0,l.kt)("p",null,"When executed, the following operations will be applied."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Creates a ",(0,l.kt)("inlineCode",{parentName:"li"},".moon")," folder with associated ",(0,l.kt)("a",{parentName:"li",href:"./config/workspace"},(0,l.kt)("inlineCode",{parentName:"a"},".moon/workspace.yml"))," and\n",(0,l.kt)("a",{parentName:"li",href:"./config/global-project"},(0,l.kt)("inlineCode",{parentName:"a"},".moon/project.yml"))," configuration files."),(0,l.kt)("li",{parentName:"ul"},"Appends necessary ignore patterns to the relative ",(0,l.kt)("inlineCode",{parentName:"li"},".gitignore"),"."),(0,l.kt)("li",{parentName:"ul"},"Infers the Node.js version from any ",(0,l.kt)("inlineCode",{parentName:"li"},".nvmrc")," or ",(0,l.kt)("inlineCode",{parentName:"li"},".node-version")," file."),(0,l.kt)("li",{parentName:"ul"},"Infers the package manager based on any existing config and lock files."),(0,l.kt)("li",{parentName:"ul"},"Infers the package manager version from the ",(0,l.kt)("inlineCode",{parentName:"li"},"packageManager")," field in ",(0,l.kt)("inlineCode",{parentName:"li"},"package.json"),"."),(0,l.kt)("li",{parentName:"ul"},"Infers projects from the ",(0,l.kt)("inlineCode",{parentName:"li"},"workspaces")," field in ",(0,l.kt)("inlineCode",{parentName:"li"},"package.json"),"."),(0,l.kt)("li",{parentName:"ul"},"Infers the version control system from the environment.")),(0,l.kt)("h2",{id:"next-steps"},"Next steps"),(0,l.kt)(s.Z,{links:[{icon:"workspace-config",label:"Setup workspace",url:"./setup-workspace"},{icon:"workspace",label:"Learn about the workspace",url:"./concepts/workspace"}],mdxType:"NextSteps"}))}h.isMDXComponent=!0}}]);