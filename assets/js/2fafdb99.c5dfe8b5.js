"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[30464],{53230:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>u,frontMatter:()=>l,metadata:()=>s,toc:()=>d});var t=o(24246),i=o(71670);const l={slug:"proto-v0.13",title:"proto v0.13 - Bun, Deno, and Go now powered by WASM plugins",authors:["milesj"],tags:["proto","wasm","plugin"]},r=void 0,s={permalink:"/blog/proto-v0.13",editUrl:"https://github.com/moonrepo/moon/tree/master/website/blog/2023-07-21_proto-v0.13.mdx",source:"@site/blog/2023-07-21_proto-v0.13.mdx",title:"proto v0.13 - Bun, Deno, and Go now powered by WASM plugins",description:"With this release, we're embracing WASM even further.",date:"2023-07-21T00:00:00.000Z",tags:[{label:"proto",permalink:"/blog/tags/proto"},{label:"wasm",permalink:"/blog/tags/wasm"},{label:"plugin",permalink:"/blog/tags/plugin"}],readingTime:2.195,hasTruncateMarker:!0,authors:[{name:"Miles Johnson",title:"Founder, developer",url:"https://github.com/milesj",imageURL:"/img/authors/miles.jpg",key:"milesj"}],frontMatter:{slug:"proto-v0.13",title:"proto v0.13 - Bun, Deno, and Go now powered by WASM plugins",authors:["milesj"],tags:["proto","wasm","plugin"]},unlisted:!1,prevItem:{title:"moon v1.11 - Next-generation project graph",permalink:"/blog/moon-v1.11"},nextItem:{title:"moon v1.10 - Mid-year quality of life improvements",permalink:"/blog/moon-v1.10"}},a={authorsImageUrls:[void 0]},d=[{value:"Core migration to WASM",id:"core-migration-to-wasm",level:2},{value:"New <code>github:</code> plugin configuration",id:"new-github-plugin-configuration",level:2},{value:"New <code>proto plugins</code> commands",id:"new-proto-plugins-commands",level:2},{value:"Other changes",id:"other-changes",level:2}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"With this release, we're embracing WASM even further."}),"\n",(0,t.jsx)(n.h2,{id:"core-migration-to-wasm",children:"Core migration to WASM"}),"\n",(0,t.jsx)(n.p,{children:'Now that WASM plugin support is up and running, we\'ve hit a non-ideal situation where we have\nmultiple competing implementations for "tools" in proto. We currently have 3 different approaches:'}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Tools implemented in Rust and built into proto's core."}),"\n",(0,t.jsx)(n.li,{children:"TOML based plugins, with a simple Rust based wrapper."}),"\n",(0,t.jsx)(n.li,{children:"WASM based plugins."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This is far too many implementations to support, and makes it extremely difficult to add new\nfeatures for tools, as it affects all 3. To remedy this situation, we've decided to migrate all core\ntools to WASM plugins, and remove the Rust based implementations. The core of proto and its CLI will\nstill be Rust, but will be slowly migrated into a truly pluggable architecture."}),"\n",(0,t.jsxs)(n.p,{children:["To test drive and experiment with this solution, we've migrated\n",(0,t.jsx)(n.a,{href:"https://github.com/moonrepo/bun-plugin",children:"Bun"}),", ",(0,t.jsx)(n.a,{href:"https://github.com/moonrepo/deno-plugin",children:"Deno"}),", and\n",(0,t.jsx)(n.a,{href:"https://github.com/moonrepo/go-plugin",children:"Go"})," into WASM plugins, and starting with this release, they\nare purely powered by WASM and have been removed entirely from the Rust implementation."]}),"\n",(0,t.jsxs)(n.p,{children:["In the next release, we hope to migrate Node.js and Rust as well. And in a future release, the TOML\nplugins will be compiled into\n",(0,t.jsxs)(n.a,{href:"https://developer.mozilla.org/en-US/docs/WebAssembly/Understanding_the_text_format",children:[(0,t.jsx)(n.code,{children:".wat"})," files"]}),"\nand loaded as WASM plugins. From here, we will have a single tool implementation, and can implement\nsome really exciting features!"]}),"\n",(0,t.jsxs)(n.h2,{id:"new-github-plugin-configuration",children:["New ",(0,t.jsx)(n.code,{children:"github:"})," plugin configuration"]}),"\n",(0,t.jsxs)(n.p,{children:["Alongside the ",(0,t.jsx)(n.code,{children:"source:"})," configuration strategy, plugins can now be configured with the ",(0,t.jsx)(n.code,{children:"github:"}),"\nstrategy to locate WASM files from GitHub releases. For example, the ",(0,t.jsx)(n.code,{children:"bun_plugin.wasm"})," file will be\ndownloaded from our\n",(0,t.jsxs)(n.a,{href:"https://github.com/moonrepo/bun-plugin/releases",children:[(0,t.jsx)(n.code,{children:"bun-plugin"}),"'s latest release"]}),"."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"/docs/proto/plugins",children:"Learn more about this new locator scope!"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",metastring:'title=".prototools"',children:'[plugins]\nbun = "github:moonrepo/bun-plugin"\n'})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Bun support is built into proto, there is merely an example!"}),"\n"]}),"\n",(0,t.jsxs)(n.h2,{id:"new-proto-plugins-commands",children:["New ",(0,t.jsx)(n.code,{children:"proto plugins"})," commands"]}),"\n",(0,t.jsxs)(n.p,{children:["With the advent of plugins, we thought it would be nice to know which plugins are actually\nconfigured and in use, without having to manually search config files across the file system, and as\nsuch, have added a new ",(0,t.jsx)(n.a,{href:"/docs/proto/commands/plugin/list",children:(0,t.jsx)(n.code,{children:"proto plugins"})})," command."]}),"\n",(0,t.jsxs)(n.p,{children:["This command is simple. It will list all plugins that are currently configured for the current\nproject, by loading all ",(0,t.jsx)(n.code,{children:".prototools"})," files up the tree, and loading the user\n",(0,t.jsx)(n.code,{children:"~/.proto/config.toml"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ proto plugins\nbun - Bun\n  GitHub: moonrepo/bun-plugin\n  Tag: latest\n\ndeno - Deno\n  GitHub: moonrepo/deno-plugin\n  Tag: latest\n\ngo - Go\n  GitHub: moonrepo/go-plugin\n  Tag: latest\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"/docs/proto/commands/plugin/list",children:"Learn more about this new command!"})}),"\n",(0,t.jsx)(n.h2,{id:"other-changes",children:"Other changes"}),"\n",(0,t.jsxs)(n.p,{children:["View the ",(0,t.jsx)(n.a,{href:"https://github.com/moonrepo/proto/releases/tag/v0.13.0",children:"official release"})," for a full list\nof changes."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Added documentation for writing ",(0,t.jsx)(n.a,{href:"/docs/proto/wasm-plugin#unit-tests",children:"unit tests for WASM plugins"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Updated ",(0,t.jsx)(n.code,{children:"proto clean"})," and ",(0,t.jsx)(n.code,{children:"proto use"})," to load and merge all ",(0,t.jsx)(n.code,{children:".prototools"})," from the current\ndirectory and upwards."]}),"\n",(0,t.jsx)(n.li,{children:"Many WASM API improvements."}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},71670:(e,n,o)=>{o.d(n,{Z:()=>s,a:()=>r});var t=o(27378);const i={},l=t.createContext(i);function r(e){const n=t.useContext(l);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);