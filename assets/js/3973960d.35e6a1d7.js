"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[93212],{33319:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>t});const i=JSON.parse('{"id":"migrate/2.0","title":"Migrate to moon v2.0","description":"To ease the migration process from moon v1 to v2, we\'ve compiled a list of all breaking changes and","source":"@site/docs/migrate/2.0.mdx","sourceDirName":"migrate","slug":"/migrate/2.0","permalink":"/docs/migrate/2.0","draft":false,"unlisted":false,"editUrl":"https://github.com/moonrepo/moon/tree/master/website/docs/migrate/2.0.mdx","tags":[],"version":"current","frontMatter":{"title":"Migrate to moon v2.0","sidebar_label":"v2.0","toc_max_heading_level":6},"sidebar":"docs","previous":{"title":"upgrade","permalink":"/docs/commands/upgrade"},"next":{"title":"Cheat sheet","permalink":"/docs/cheat-sheet"}}');var o=s(62540),d=s(43023);const l={title:"Migrate to moon v2.0",sidebar_label:"v2.0",toc_max_heading_level:6},c=void 0,r={},t=[{value:"CLI",id:"cli",level:2},{value:"Commands",id:"commands",level:3},{value:"<code>moon action-graph</code>",id:"moon-action-graph",level:4},{value:"<code>moon check</code>",id:"moon-check",level:4},{value:"<code>moon ci</code>",id:"moon-ci",level:4},{value:"<code>moon generate</code>",id:"moon-generate",level:4},{value:"<code>moon init</code>",id:"moon-init",level:4},{value:"<code>moon mcp</code>",id:"moon-mcp",level:4},{value:"<code>moon query projects</code>",id:"moon-query-projects",level:4},{value:"<code>moon run</code>",id:"moon-run",level:4},{value:"<code>moon templates</code>",id:"moon-templates",level:4},{value:"<code>moon run</code>",id:"moon-run-1",level:4},{value:"Workspace",id:"workspace",level:2},{value:"Configuration: <code>.moon/workspace.*</code>",id:"configuration-moonworkspace",level:3},{value:"Toolchains",id:"toolchains",level:2},{value:"Configuration: <code>.moon/toolchain.*</code>",id:"configuration-moontoolchain",level:3},{value:"JavaScript",id:"javascript",level:4},{value:"Extensions",id:"extensions",level:2},{value:"Configuration: <code>.moon/extensions.*</code>",id:"configuration-moonextensions",level:3},{value:"Project",id:"project",level:2},{value:"Configuration: <code>moon.*</code>",id:"configuration-moon",level:3},{value:"Language detection",id:"language-detection",level:3},{value:"Custom metadata",id:"custom-metadata",level:3},{value:"Toolchain disabling",id:"toolchain-disabling",level:3},{value:"Tasks",id:"tasks",level:2},{value:"Configuration: <code>moon.*</code>, <code>.moon/tasks</code>",id:"configuration-moon-moontasks",level:3},{value:"Local mode",id:"local-mode",level:3},{value:"Shells by default",id:"shells-by-default",level:3},{value:"Env var substitution behavior",id:"env-var-substitution-behavior",level:3},{value:"Env var precedence",id:"env-var-precedence",level:3},{value:"Deferred <code>.env</code> files",id:"deferred-env-files",level:3},{value:"Other changes",id:"other-changes",level:3},{value:"Task inheritance",id:"task-inheritance",level:2},{value:"Deep merged instead of shallow merged",id:"deep-merged-instead-of-shallow-merged",level:3},{value:"File groups are merged",id:"file-groups-are-merged",level:3},{value:"VCS",id:"vcs",level:2},{value:"New hooks system",id:"new-hooks-system",level:3},{value:"Other changes",id:"other-changes-1",level:2},{value:"Changed (touched) files",id:"changed-touched-files",level:3},{value:"Docker",id:"docker",level:3},{value:"Query language (MQL)",id:"query-language-mql",level:3},{value:"Webhooks",id:"webhooks",level:3}];function a(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"To ease the migration process from moon v1 to v2, we've compiled a list of all breaking changes and\nimportant changes that you should be aware of. Please read through these carefully before upgrading\nyour workspace."}),"\n",(0,o.jsxs)(n.p,{children:["To automate some of the migration process, we've created the ",(0,o.jsx)(n.code,{children:"moon migrate v2"})," command that will\nmigrate all applicable settings in configuration files."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"$ moon migrate v2\n"})}),"\n",(0,o.jsx)(n.h2,{id:"cli",children:"CLI"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Removed ",(0,o.jsx)(n.code,{children:"x86_64-apple-darwin"})," (Apple Intel) as a supported operating system. Only\n",(0,o.jsx)(n.code,{children:"aarch64-apple-darwin"})," (Apple Silicon) is now supported."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"commands",children:"Commands"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["We've done a large polish pass for all commands, based on the ",(0,o.jsx)(n.a,{href:"https://clig.dev",children:"CLI guidelines"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["Updated the ",(0,o.jsx)(n.code,{children:"moonx"})," binary to use ",(0,o.jsx)(n.code,{children:"moon exec"})," instead of ",(0,o.jsx)(n.code,{children:"moon run"})," under the hood."]}),"\n",(0,o.jsxs)(n.li,{children:["Renamed all options and flags to kebab-case instead of camelCase.","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Example: ",(0,o.jsx)(n.code,{children:"--logLevel"})," -> ",(0,o.jsx)(n.code,{children:"--log-level"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Renamed options for all commands:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"--platform"})," -> ",(0,o.jsx)(n.code,{children:"--toolchain"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Removed commands:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"moon node"})}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"moon migrate from-package-json"})," (use the ",(0,o.jsx)(n.code,{children:"migrate-turborepo"})," extension instead)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"moon query hash"})," (use ",(0,o.jsx)(n.code,{children:"moon hash"})," instead)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"moon query hash-diff"})," (use ",(0,o.jsx)(n.code,{children:"moon hash"})," instead)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"moon-action-graph",children:(0,o.jsx)(n.code,{children:"moon action-graph"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Changed the output of ",(0,o.jsx)(n.code,{children:"--json"})," to a new JSON structure (now matches the project and task graphs)."]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"moon-check",children:(0,o.jsx)(n.code,{children:"moon check"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Now runs ",(0,o.jsx)(n.code,{children:"moon exec"})," under the hood, with some arguments/options pre-filled."]}),"\n",(0,o.jsxs)(n.li,{children:["If the project ID is not specifed, it will no longer find the closest project. Instead you must\npass ",(0,o.jsx)(n.code,{children:"--closest"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["Renamed options:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"--update-cache, -u"})," -> ",(0,o.jsx)(n.code,{children:"--force, -f"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"moon-ci",children:(0,o.jsx)(n.code,{children:"moon ci"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Now runs ",(0,o.jsx)(n.code,{children:"moon exec"})," under the hood, with some arguments/options pre-filled."]}),"\n",(0,o.jsxs)(n.li,{children:["Renamed options:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"--update-cache, -u"})," -> ",(0,o.jsx)(n.code,{children:"--force, -f"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"moon-generate",children:(0,o.jsx)(n.code,{children:"moon generate"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Changed the destination from a positional argument, to the ",(0,o.jsx)(n.code,{children:"--to"})," option.","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Example: ",(0,o.jsx)(n.code,{children:"moon generate <id> ./dist"})," -> ",(0,o.jsx)(n.code,{children:"moon generate <id> --to ./dist"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"moon-init",children:(0,o.jsx)(n.code,{children:"moon init"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:['Removed "scaffolding a toolchain" functionality from the command. Use the ',(0,o.jsx)(n.code,{children:"moon toolchain add"}),"\ncommand instead."]}),"\n",(0,o.jsxs)(n.li,{children:["Removed options:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"--to"})," (use a positional argument instead)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"moon-mcp",children:(0,o.jsx)(n.code,{children:"moon mcp"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Updated the ",(0,o.jsx)(n.code,{children:"get_projects"})," tool to no longer have an ",(0,o.jsx)(n.code,{children:"includeTasks"})," option."]}),"\n",(0,o.jsxs)(n.li,{children:["Updated the ",(0,o.jsx)(n.code,{children:"get_projects"})," tool to return a list of project fragments, instead of the whole\nproject object. This was required as the response was too large for MCP."]}),"\n",(0,o.jsxs)(n.li,{children:["Updated the ",(0,o.jsx)(n.code,{children:"get_tasks"})," tool to return a list of task fragments, instead of the whole task object.\nThis was required as the response was too large for MCP."]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"moon-query-projects",children:(0,o.jsx)(n.code,{children:"moon query projects"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Removed options:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"--dependents"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"moon-run",children:(0,o.jsx)(n.code,{children:"moon run"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Now runs ",(0,o.jsx)(n.code,{children:"moon exec"})," under the hood, with some arguments/options pre-filled."]}),"\n",(0,o.jsxs)(n.li,{children:["Updated options:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"--dependents"})," now requires a value, either ",(0,o.jsx)(n.code,{children:"deep"})," or ",(0,o.jsx)(n.code,{children:"direct"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Renamed options:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"--update-cache, -u"})," -> ",(0,o.jsx)(n.code,{children:"--force, -f"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Removed options:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"--no-bail"})," (use ",(0,o.jsx)(n.code,{children:"moon exec"})," instead)"]}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"--profile"})}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"--remote"})," (use ",(0,o.jsx)(n.code,{children:"--affected remote"})," instead)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"moon-templates",children:(0,o.jsx)(n.code,{children:"moon templates"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Changed the output to render a table instead of a list."}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"moon-run-1",children:(0,o.jsx)(n.code,{children:"moon run"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Running a target without a scope no longer locates the closest project and instead uses the new\ndefault project feature. To run a target in the closets project, use ",(0,o.jsx)(n.code,{children:"~:"})," scope instead.","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Example: ",(0,o.jsx)(n.code,{children:"moon run build"})," -> ",(0,o.jsx)(n.code,{children:"moon run ~:build"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"workspace",children:"Workspace"}),"\n",(0,o.jsxs)(n.h3,{id:"configuration-moonworkspace",children:["Configuration: ",(0,o.jsx)(n.code,{children:".moon/workspace.*"})]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Renamed setting values:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"codeowners.orderBy"})," value ",(0,o.jsx)(n.code,{children:"project-name"})," -> ",(0,o.jsx)(n.code,{children:"project-id"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Renamed settings:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"codeowners.syncOnRun"})," -> ",(0,o.jsx)(n.code,{children:"codeowners.sync"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"constraints.enforceProjectTypeRelationships"})," -> ",(0,o.jsx)(n.code,{children:"constraints.enforceLayerRelationships"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"docker.prune.installToolchainDeps"})," -> ",(0,o.jsx)(n.code,{children:"docker.prune.installToolchainDependencies"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"docker.scaffold.include"})," -> ",(0,o.jsx)(n.code,{children:"docker.scaffold.configsPhaseGlobs"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"runner"})," -> ",(0,o.jsx)(n.code,{children:"pipeline"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"unstable_remote"})," -> ",(0,o.jsx)(n.code,{children:"remote"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"vcs.manager"})," -> ",(0,o.jsx)(n.code,{children:"vcs.client"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"vcs.syncHooks"})," -> ",(0,o.jsx)(n.code,{children:"vcs.sync"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Removed settings:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"docker.scaffold.copyToolchainFiles"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"experiments.*"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"hasher.batchSize"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"pipeline.archivableTargets"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"toolchains",children:"Toolchains"}),"\n",(0,o.jsxs)(n.h3,{id:"configuration-moontoolchain",children:["Configuration: ",(0,o.jsx)(n.code,{children:".moon/toolchain.*"})]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["This file was renamed to ",(0,o.jsx)(n.code,{children:".moon/toolchains.*"})," (plural) to reflect that multiple toolchains are\nconfigured. This also aligns with the new ",(0,o.jsx)(n.code,{children:".moon/extensions.*"})," file."]}),"\n",(0,o.jsxs)(n.li,{children:["All toolchains have been stabilized, so the ",(0,o.jsx)(n.code,{children:"unstable_"})," prefix must be removed from identifiers."]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"javascript",children:"JavaScript"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"bun"}),", ",(0,o.jsx)(n.code,{children:"deno"}),", and ",(0,o.jsx)(n.code,{children:"node"})," toolchains now require the ",(0,o.jsx)(n.code,{children:"javascript"})," toolchain to be defined as\nwell. All shared settings have been moved to the ",(0,o.jsx)(n.code,{children:"javascript"})," toolchain."]}),"\n",(0,o.jsxs)(n.p,{children:["In addition, all ",(0,o.jsx)(n.code,{children:"node"})," package managers are no longer nested under the ",(0,o.jsx)(n.code,{children:"node"})," toolchain, but are\nnow top-level settings. These are only required when the ",(0,o.jsx)(n.code,{children:"javascript.packageManager"})," setting is\ndefined."]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Moved settings:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"bun.dependencyVersionFormat"})," -> ",(0,o.jsx)(n.code,{children:"javascript.dependencyVersionFormat"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"bun.inferTasksFromScripts"})," -> ",(0,o.jsx)(n.code,{children:"javascript.inferTasksFromScripts"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"bun.rootPackageOnly"})," -> ",(0,o.jsx)(n.code,{children:"javascript.rootPackageDependenciesOnly"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"bun.syncProjectWorkspaceDependencies"})," -> ",(0,o.jsx)(n.code,{children:"javascript.syncProjectWorkspaceDependencies"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"node.dependencyVersionFormat"})," -> ",(0,o.jsx)(n.code,{children:"javascript.dependencyVersionFormat"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"node.dedupeOnLockfileChange"})," -> ",(0,o.jsx)(n.code,{children:"javascript.dedupeOnLockfileChange"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"node.inferTasksFromScripts"})," -> ",(0,o.jsx)(n.code,{children:"javascript.inferTasksFromScripts"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"node.packageManager"})," -> ",(0,o.jsx)(n.code,{children:"javascript.packageManager"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"node.rootPackageOnly"})," -> ",(0,o.jsx)(n.code,{children:"javascript.rootPackageDependenciesOnly"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"node.syncPackageManagerField"})," -> ",(0,o.jsx)(n.code,{children:"javascript.syncPackageManagerField"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"node.syncProjectWorkspaceDependencies"})," -> ",(0,o.jsx)(n.code,{children:"javascript.syncProjectWorkspaceDependencies"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"node.bun"})," -> ",(0,o.jsx)(n.code,{children:"bun"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"node.npm"})," -> ",(0,o.jsx)(n.code,{children:"npm"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"node.pnpm"})," -> ",(0,o.jsx)(n.code,{children:"pnpm"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"node.yarn"})," -> ",(0,o.jsx)(n.code,{children:"yarn"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Renamed settings:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"node.binExecArgs"})," -> ",(0,o.jsx)(n.code,{children:"node.executeArgs"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Removed settings:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"bun.packagesRoot"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"deno.depsFile"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"deno.lockfile"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"node.addEnginesConstraint"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"node.packagesRoot"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title=".moon/toolchains.yml"',children:"# Before\nnode:\n  version: '22.14.0'\n  packageManager: 'yarn'\n  inferTasksFromScripts: false\n  syncPackageManagerField: true\n  syncProjectWorkspaceDependencies: true\n  yarn:\n    version: '4.8.0'\n\n# After\njavascript:\n  packageManager: 'yarn'\n  inferTasksFromScripts: false\n  syncPackageManagerField: true\n  syncProjectWorkspaceDependencies: true\n\nnode:\n  version: '22.14.0'\n\nyarn:\n  version: '4.8.0'\n"})}),"\n",(0,o.jsx)(n.h2,{id:"extensions",children:"Extensions"}),"\n",(0,o.jsxs)(n.h3,{id:"configuration-moonextensions",children:["Configuration: ",(0,o.jsx)(n.code,{children:".moon/extensions.*"})]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["The ",(0,o.jsx)(n.code,{children:"extensions"})," setting from ",(0,o.jsx)(n.code,{children:".moon/workspace.*"})," has been moved (and flattened) to its own file,\n",(0,o.jsx)(n.code,{children:".moon/extensions.*"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["The built-in extensions ",(0,o.jsx)(n.code,{children:"download"}),", ",(0,o.jsx)(n.code,{children:"migrate-nx"}),", and ",(0,o.jsx)(n.code,{children:"migrate-turborepo"})," must now be enabled in\nthe configuration file before they can be used. Simply set an empty object.","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"This change was made to reduce the number of extensions that are loaded by default, improving\nperformance."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title=".moon/extensions.yml"',children:"download: {}\n\nmigrate-nx: {}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"project",children:"Project"}),"\n",(0,o.jsxs)(n.h3,{id:"configuration-moon",children:["Configuration: ",(0,o.jsx)(n.code,{children:"moon.*"})]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Renamed settings:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"docker.scaffold.include"})," -> ",(0,o.jsx)(n.code,{children:"docker.scaffold.sourcesPhaseGlobs"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"project.name"})," -> ",(0,o.jsx)(n.code,{children:"project.title"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"type"})," -> ",(0,o.jsx)(n.code,{children:"layer"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"toolchain"})," -> ",(0,o.jsx)(n.code,{children:"toolchains"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"platform"})," -> ",(0,o.jsx)(n.code,{children:"toolchains.default"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Removed settings:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#custom-metadata",children:(0,o.jsx)(n.code,{children:"project.metadata"})})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"#toolchain-disabling",children:(0,o.jsx)(n.code,{children:"toolchain.*.disabled"})})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"language-detection",children:"Language detection"}),"\n",(0,o.jsxs)(n.p,{children:["The primary ",(0,o.jsx)(n.code,{children:"language"})," is now detected from toolchains, instead of being a hardcoded implementation.\nThe result may now differ, as the first toolchain in the list will be used. Additionally, languages\nthat don't have a toolchain yet, like PHP or Ruby, will not be detected and must be explicitly\nconfigured."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"# After\nlanguage: 'ruby'\n"})}),"\n",(0,o.jsx)(n.h3,{id:"custom-metadata",children:"Custom metadata"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"project.metadata"})," setting has been removed, but all custom metadata fields can now be defined\nat the root of the ",(0,o.jsx)(n.code,{children:"project"})," setting."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"# Before\nproject:\n  metadata:\n    customField: 'value'\n\n# After\nproject:\n  customField: 'value'\n"})}),"\n",(0,o.jsx)(n.h3,{id:"toolchain-disabling",children:"Toolchain disabling"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"toolchain.*.disabled"})," setting was removed. Instead set the toolchain itself to null/false."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"# Before\ntoolchain:\n  typescript:\n    disabled: true\n\n# After\ntoolchains:\n  typescript: null\n"})}),"\n",(0,o.jsx)(n.h2,{id:"tasks",children:"Tasks"}),"\n",(0,o.jsxs)(n.h3,{id:"configuration-moon-moontasks",children:["Configuration: ",(0,o.jsx)(n.code,{children:"moon.*"}),", ",(0,o.jsx)(n.code,{children:".moon/tasks"})]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["The file ",(0,o.jsx)(n.code,{children:".moon/tasks.yml"})," has been removed. If you want to support tasks that are inherited by\n",(0,o.jsx)(n.em,{children:"all projects"}),", then move this to ",(0,o.jsx)(n.code,{children:".moon/tasks/all.yml"})," and ",(0,o.jsx)(n.em,{children:"do not"})," configure the new\n",(0,o.jsx)(n.code,{children:"inheritedBy"})," setting."]}),"\n",(0,o.jsxs)(n.li,{children:["Renamed tokens:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"$projectName"})," -> ",(0,o.jsx)(n.code,{children:"$projectTitle"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"$projectType"})," -> ",(0,o.jsx)(n.code,{children:"$projectLayer"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"$taskPlatform"})," -> ",(0,o.jsx)(n.code,{children:"$taskToolchain"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Renamed settings:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"#local-mode",children:(0,o.jsx)(n.code,{children:"tasks.*.local"})})," -> ",(0,o.jsx)(n.code,{children:"tasks.*.preset"})," using ",(0,o.jsx)(n.code,{children:"server"})," value"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"tasks.*.platform"})," -> ",(0,o.jsx)(n.code,{children:"tasks.*.toolchains"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Removed setting values:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"tasks.*.preset"})," value ",(0,o.jsx)(n.code,{children:"watcher"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Changed option defaults:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"tasks.*.options.envFile"})," now defaults to a list of files, instead of a single file, when\n",(0,o.jsx)(n.code,{children:"true"}),". Refer to the blog post for more information."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"tasks.*.options.inferInputs"})," now defaults to ",(0,o.jsx)(n.code,{children:"false"})," instead of ",(0,o.jsx)(n.code,{children:"true"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"tasks.*.options.shell"})," now defaults to ",(0,o.jsx)(n.code,{children:"true"})," instead of ",(0,o.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"tasks.*.options.unixShell"})," now defaults to ",(0,o.jsx)(n.code,{children:"bash"})," instead of nothing."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"tasks.*.options.windowsShell"})," now defaults to ",(0,o.jsx)(n.code,{children:"pwsh"})," instead of nothing."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"local-mode",children:"Local mode"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"local"}),' task setting has been removed as the name was confusing. Users assumed it meant "only\nrun locally", but it actually meant "this is a persistent server that should only run locally".\nInstead, use the ',(0,o.jsx)(n.code,{children:"preset"})," setting with a value of ",(0,o.jsx)(n.code,{children:"server"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"# Before\ntasks:\n  dev:\n    command: 'start-dev'\n    local: true\n\n# Before\ntasks:\n  dev:\n    command: 'start-dev'\n    preset: 'server'\n"})}),"\n",(0,o.jsxs)(n.p,{children:['If you want a task that is simply "local only" without other options changes, use ',(0,o.jsx)(n.code,{children:"options.runInCI"}),"\ndirectly."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"tasks:\n  dev:\n    command: 'start-dev'\n    options:\n      runInCI: false\n"})}),"\n",(0,o.jsx)(n.h3,{id:"shells-by-default",children:"Shells by default"}),"\n",(0,o.jsxs)(n.p,{children:["Tasks now run in a shell by default, and will use Bash on Unix (",(0,o.jsx)(n.code,{children:"options.unixShell"}),"), and pwsh on\nWindows (",(0,o.jsx)(n.code,{children:"options.windowsShell"}),"). You can disable this behavior by setting ",(0,o.jsx)(n.code,{children:"options.shell"})," to\n",(0,o.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"tasks:\n  dev:\n    command: 'start-dev'\n    options:\n      shell: false\n"})}),"\n",(0,o.jsx)(n.h3,{id:"env-var-substitution-behavior",children:"Env var substitution behavior"}),"\n",(0,o.jsxs)(n.p,{children:["The syntax and behavior for substituting (expanding/interpolation) environment variables has\nchanged, to better align with the standard of ",(0,o.jsx)(n.code,{children:".env"})," files. The biggest change is that flagless\ntokens (",(0,o.jsx)(n.code,{children:"$VAR"}),") and ",(0,o.jsx)(n.code,{children:"?"})," flag tokens (",(0,o.jsx)(n.code,{children:"$VAR?"}),") swapped functionality. Refer to the following table:"]}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Syntax"}),(0,o.jsx)(n.th,{children:"v1"}),(0,o.jsx)(n.th,{children:"v2"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"$VAR"})}),(0,o.jsxs)(n.td,{children:["Substitute with variable syntax (",(0,o.jsx)(n.code,{children:"$VAR"}),") if variable empty"]}),(0,o.jsx)(n.td,{children:"\ud83d\udca5 Substitute with empty string if variable empty"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"$VAR!"})}),(0,o.jsxs)(n.td,{children:["Don't substitute and keep variable syntax (",(0,o.jsx)(n.code,{children:"$VAR"}),")"]}),(0,o.jsx)(n.td,{children:"\ud83d\udca5 Removed syntax"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"$VAR?"})}),(0,o.jsx)(n.td,{children:"Substitute with empty string if variable empty"}),(0,o.jsx)(n.td,{children:"\ud83d\udca5 Removed syntax"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"${VAR}"})}),(0,o.jsxs)(n.td,{children:["Substitute with variable syntax (",(0,o.jsx)(n.code,{children:"$VAR"}),") if variable empty"]}),(0,o.jsx)(n.td,{children:"\ud83d\udca5 Substitute with empty string if variable empty"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"${VAR!}"})}),(0,o.jsxs)(n.td,{children:["Don't substitute and keep variable syntax (",(0,o.jsx)(n.code,{children:"$VAR"}),")"]}),(0,o.jsx)(n.td,{children:"~"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"${VAR?}"})}),(0,o.jsx)(n.td,{children:"Substitute with empty string if variable empty"}),(0,o.jsxs)(n.td,{children:["\ud83d\udca5 Substitute with variable syntax (",(0,o.jsx)(n.code,{children:"$VAR"}),") if variable empty"]})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"${VAR:default}"})}),(0,o.jsx)(n.td,{children:"Use default value if variable empty"}),(0,o.jsx)(n.td,{children:"~"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsxs)(n.td,{children:[(0,o.jsx)(n.code,{children:"${VAR:-default}"}),", ",(0,o.jsx)(n.code,{children:"${VAR-default}"})]}),(0,o.jsx)(n.td,{children:"\u26d4\ufe0f Not supported"}),(0,o.jsx)(n.td,{children:"Use default value if variable empty"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsxs)(n.td,{children:[(0,o.jsx)(n.code,{children:"${VAR:+alternate}"}),", ",(0,o.jsx)(n.code,{children:"${VAR+alternate}"})]}),(0,o.jsx)(n.td,{children:"\u26d4\ufe0f Not supported"}),(0,o.jsx)(n.td,{children:"Use alternate value if variable non-empty"})]})]})]}),"\n",(0,o.jsx)(n.p,{children:"Legend:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"~"})," indicates the syntax/functionality is the same as v1"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"\ud83d\udca5"})," indicates breaking change"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"\u26d4\ufe0f"})," indicates not supported"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"env-var-precedence",children:"Env var precedence"}),"\n",(0,o.jsx)(n.p,{children:"The order of precedence for environment variables has slightly changed when running tasks, as it was\nconfusing to users. The new order of precedence is as follows, from lowest to highest tier, with the\nlatter overwriting the former:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Task ",(0,o.jsx)(n.code,{children:".env"})," files","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["via ",(0,o.jsx)(n.code,{children:"options.envFile"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Task env variables","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["via ",(0,o.jsx)(n.code,{children:"env"})," or ",(0,o.jsx)(n.code,{children:"deps.*.env"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["System variables","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["via profile scripts (",(0,o.jsx)(n.code,{children:".bashrc"}),", ",(0,o.jsx)(n.code,{children:".zshrc"}),", etc)"]}),"\n",(0,o.jsxs)(n.li,{children:["via command line: ",(0,o.jsx)(n.code,{children:"KEY=value moon ..."})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["In regards to variable substitution, each tier can reference variables within the same tier, or the\nhigher tier(s), but ",(0,o.jsx)(n.em,{children:"not"})," from lower tier(s). This is because variables are processed in ",(0,o.jsx)(n.em,{children:"reverse\norder"}),". Refer to the following table:"]}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Tier"}),(0,o.jsx)(n.th,{children:"Can reference"}),(0,o.jsx)(n.th,{children:"Evaluated during"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Dotenv"}),(0,o.jsx)(n.td,{children:"Dotenv, Task, System"}),(0,o.jsx)(n.td,{children:"Before task execution"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Task"}),(0,o.jsx)(n.td,{children:"Task, System"}),(0,o.jsx)(n.td,{children:"After task creation"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"System"}),(0,o.jsx)(n.td,{children:"System"}),(0,o.jsx)(n.td,{children:"CLI startup"})]})]})]}),"\n",(0,o.jsx)(n.p,{children:"If you don't want to inherit a system variable, you can override it in the task with a null value."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"tasks:\n  dev:\n    env:\n      EXAMPLE: null\n"})}),"\n",(0,o.jsxs)(n.h3,{id:"deferred-env-files",children:["Deferred ",(0,o.jsx)(n.code,{children:".env"})," files"]}),"\n",(0,o.jsxs)(n.p,{children:["In v1, when ",(0,o.jsx)(n.code,{children:"options.envFile"})," was enabled, the ",(0,o.jsx)(n.code,{children:".env"})," file(s) were loaded at the time of task\ncreation, during the building of project/task graphs. This meant that if the ",(0,o.jsx)(n.code,{children:".env"})," file changed\nbetween the time of graph creation and task execution, the changes would not be reflected."]}),"\n",(0,o.jsxs)(n.p,{children:["In v2 and later, ",(0,o.jsx)(n.code,{children:".env"})," files are loaded ",(0,o.jsx)(n.em,{children:"just before"})," task execution, ensuring that any changes to\nthe file are picked up."]}),"\n",(0,o.jsx)(n.admonition,{type:"caution",children:(0,o.jsxs)(n.p,{children:["Because of this change, task ",(0,o.jsx)(n.code,{children:"env"})," variables will continue to override ",(0,o.jsx)(n.code,{children:".env"})," file variables, BUT\ncan no longer reference them for substitution. This is because the ",(0,o.jsx)(n.code,{children:".env"})," files are loaded later in\nthe process."]})}),"\n",(0,o.jsx)(n.h3,{id:"other-changes",children:"Other changes"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["When ",(0,o.jsx)(n.code,{children:"options.affectedFiles"})," is enabled, the list of files will be joined with the OS path\nseparator (",(0,o.jsx)(n.code,{children:":"})," on Unix, ",(0,o.jsx)(n.code,{children:";"})," on Windows) instead of a comma (",(0,o.jsx)(n.code,{children:","}),") when passed as the\n",(0,o.jsx)(n.code,{children:"MOON_AFFECTED_FILES"})," environment variable."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"task-inheritance",children:"Task inheritance"}),"\n",(0,o.jsx)(n.h3,{id:"deep-merged-instead-of-shallow-merged",children:"Deep merged instead of shallow merged"}),"\n",(0,o.jsxs)(n.p,{children:["In v1, when inheriting tasks, all global configs (those in ",(0,o.jsx)(n.code,{children:".moon"}),") were ",(0,o.jsx)(n.em,{children:"shallow merged"})," into a\nsingle config ignoring merge task options, and ",(0,o.jsx)(n.em,{children:"then"})," merged with the local config (",(0,o.jsx)(n.code,{children:"moon.*"}),") using\nmerge task options. This was not intuitive, as users expected all configs to be merged in sequence.\nTo demonstrate this, take the following example configs, in order of inherited:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"# .moon/tasks.yml\ntasks:\n  build:\n    command: 'build --cache'\n    options:\n      mutex: 'build'\n\n# .moon/tasks/tag-a.yml\ntasks:\n  build:\n    args: '--force'\n\n# .moon/tasks/tag-b.yml\ntasks:\n  build:\n    args: '--clean'\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Users would expect the final ",(0,o.jsx)(n.code,{children:"build"})," task to be ",(0,o.jsx)(n.code,{children:"build --cache --force --clean"})," with the mutex\noption set. However, since the ",(0,o.jsx)(n.code,{children:"tasks"})," setting was shallow merged, only the last config (",(0,o.jsx)(n.code,{children:"tag-b"}),")\nwould be used, resulting in the task being ",(0,o.jsx)(n.code,{children:"noop --clean"})," without the mutex. The ",(0,o.jsx)(n.code,{children:"noop"})," pops up\nbecause the ",(0,o.jsx)(n.code,{children:"command"})," setting was not configured in the last config."]}),"\n",(0,o.jsx)(n.p,{children:"To remedy this, and to improve task composition overall, global configs are no longer shallow merged\ninto a single config before merging with the local config. Instead, all configs are merged in\nsequence, while respecting the task merge options. This is the order of operations for the new\nsystem:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Load all global configs (",(0,o.jsx)(n.code,{children:".moon"}),") into a list, in order, based on the ",(0,o.jsx)(n.code,{children:"inheritedBy"})," setting."]}),"\n",(0,o.jsxs)(n.li,{children:["Load the local config (",(0,o.jsx)(n.code,{children:"moon.*"}),")."]}),"\n",(0,o.jsxs)(n.li,{children:["Create an inheritance chain by resolving global configs first, then the local config last, while\nrespecting ",(0,o.jsx)(n.code,{children:"extend"})," and other composition settings."]}),"\n",(0,o.jsx)(n.li,{children:"Merge all task options in order, to create the final task options."}),"\n",(0,o.jsx)(n.li,{children:"Merge all tasks in order, using the final task options to guide the merging behavior."}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"file-groups-are-merged",children:"File groups are merged"}),"\n",(0,o.jsx)(n.p,{children:"Because of the new deep merging behavior, file groups defined in inherited configs are now merged\ntogether, instead of being replaced by the following config in the sequence. For example, given the\nconfigs:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"# .moon/tasks/tag-a.yml\nfileGroups:\n  sources:\n    - 'src/**'\n\n# .moon/tasks/tag-b.yml\nfileGroups:\n  sources:\n    - 'docs/**'\n"})}),"\n",(0,o.jsxs)(n.p,{children:["In v1, the final ",(0,o.jsx)(n.code,{children:"sources"})," file group would only include ",(0,o.jsx)(n.code,{children:"docs/**"}),", as the second config would\nreplace the first. In v2, the final ",(0,o.jsx)(n.code,{children:"sources"})," file group includes both ",(0,o.jsx)(n.code,{children:"src/**"})," and ",(0,o.jsx)(n.code,{children:"docs/**"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"vcs",children:"VCS"}),"\n",(0,o.jsx)(n.h3,{id:"new-hooks-system",children:"New hooks system"}),"\n",(0,o.jsxs)(n.p,{children:["We've rewritten our Git hooks from the ground up to be based around the ",(0,o.jsx)(n.code,{children:"core.hooksPath"})," setting.\nThe following changes have been made:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["We no longer write hooks to the ",(0,o.jsx)(n.code,{children:".git/hooks"})," directory."]}),"\n",(0,o.jsxs)(n.li,{children:["Instead, all hooks are written to ",(0,o.jsx)(n.code,{children:".moon/hooks"})," and Git is configured to use this directory."]}),"\n",(0,o.jsxs)(n.li,{children:["Bash scripts no longer end in ",(0,o.jsx)(n.code,{children:".sh"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{type:"caution",children:(0,o.jsxs)(n.p,{children:["We currently don't have an easy way to clean the previous implementation of hooks. You may need to\nmanually remove the old scripts from ",(0,o.jsx)(n.code,{children:".git/hooks"})," and ",(0,o.jsx)(n.code,{children:".moon/hooks"})," if they are causing issues."]})}),"\n",(0,o.jsx)(n.h2,{id:"other-changes-1",children:"Other changes"}),"\n",(0,o.jsx)(n.h3,{id:"changed-touched-files",children:"Changed (touched) files"}),"\n",(0,o.jsx)(n.p,{children:'We renamed the terminology "touched files" to "changed files" throughout the codebase and\ndocumentation. This better aligns with common VCS terminology and reduces confusion. Because of\nthis, the following changes were made:'}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Renamed the ",(0,o.jsx)(n.code,{children:"moon query touched-files"})," CLI command to ",(0,o.jsx)(n.code,{children:"moon query changed-files"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["Renamed the ",(0,o.jsx)(n.code,{children:"get_touched_files"})," MCP tool to ",(0,o.jsx)(n.code,{children:"get_changed_files"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["Renamed the ",(0,o.jsx)(n.code,{children:"touchedFiles"})," run report field to ",(0,o.jsx)(n.code,{children:"changedFiles"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"# Before\n$ moon query touched-files\n\n# After\n$ moon query changed-files\n"})}),"\n",(0,o.jsx)(n.h3,{id:"docker",children:"Docker"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["The scaffolded ",(0,o.jsx)(n.code,{children:".moon/docker/workspace"})," directory was renamed to ",(0,o.jsx)(n.code,{children:".moon/docker/configs"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["The ",(0,o.jsx)(n.code,{children:"moon docker file"}),' command will now loop through all toolchains and use the first image found,\notherwise it defaults to "scratch". If you want to be explicit, set the ',(0,o.jsx)(n.code,{children:"docker.file.image"}),"\nsetting."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"query-language-mql",children:"Query language (MQL)"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Renamed fields:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"projectName"})," -> ",(0,o.jsx)(n.code,{children:"projectId"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"projectType"})," -> ",(0,o.jsx)(n.code,{children:"projectLayer"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"taskPlatform"})," -> ",(0,o.jsx)(n.code,{children:"taskToolchain"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"# Before\nprojectType=application && taskPlatform=node\n\n# After\nprojectLayer=application && taskToolchain=node\n"})}),"\n",(0,o.jsx)(n.h3,{id:"webhooks",children:"Webhooks"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Removed the ",(0,o.jsx)(n.code,{children:"tool.*"})," events. Use ",(0,o.jsx)(n.code,{children:"toolchain.*"})," events instead."]}),"\n",(0,o.jsxs)(n.li,{children:["Removed the ",(0,o.jsx)(n.code,{children:"runtime"})," field from ",(0,o.jsx)(n.code,{children:"dependencies.*"})," events. Use the ",(0,o.jsx)(n.code,{children:"toolchain"})," field instead."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},43023:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>c});var i=s(63696);const o={},d=i.createContext(o);function l(e){const n=i.useContext(d);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),i.createElement(d.Provider,{value:n},e.children)}}}]);