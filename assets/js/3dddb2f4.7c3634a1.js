"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[45444],{17092:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var o=t(25712),i=t(62540),s=t(43023);const r={slug:"moon-v1.39",title:"moon v1.39 - Improved task inputs, better proto integration, and project layers",authors:["milesj"],tags:["task","input","uri","object","proto","project","layer"],image:"./img/moon/v1.39.png"},l=void 0,a={image:t(89009).A,authorsImageUrls:[void 0]},c=[{value:"Improved task inputs",id:"improved-task-inputs",level:2},{value:"New formats",id:"new-formats",level:3},{value:"URIs",id:"uris",level:4},{value:"Objects",id:"objects",level:4},{value:"New parameters",id:"new-parameters",level:3},{value:"Files",id:"files",level:4},{value:"Globs",id:"globs",level:4},{value:"Better proto integration",id:"better-proto-integration",level:2},{value:"New <code>proto</code> setting",id:"new-proto-setting",level:3},{value:"Other changes",id:"other-changes",level:3},{value:"Project layers",id:"project-layers",level:2},{value:"Other changes",id:"other-changes-1",level:2},{value:"What&#39;s next?",id:"whats-next",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"This is a rather small release, but it does include some important changes to task inputs, and\nproto's integration."}),"\n",(0,i.jsx)(n.h2,{id:"improved-task-inputs",children:"Improved task inputs"}),"\n",(0,i.jsxs)(n.p,{children:["A few months ago we introduced an\n",(0,i.jsx)(n.a,{href:"https://github.com/moonrepo/moon/issues/1985",children:"RFC for improving task inputs"})," that introduces new\nsyntax, functionality, and input types. In this release, we have implemented a portion of the RFC\nfor testing before we implement the rest. Continue reading for more details!"]}),"\n",(0,i.jsx)(n.h3,{id:"new-formats",children:"New formats"}),"\n",(0,i.jsx)(n.p,{children:"To start, we are introducing 2 new formats for configuring task inputs, a URI format and an object\nformat, both of which support custom parameters."}),"\n",(0,i.jsx)(n.h4,{id:"uris",children:"URIs"}),"\n",(0,i.jsxs)(n.p,{children:["URIs should be rather familiar, as they are a string prefixed with a scheme (",(0,i.jsx)(n.code,{children:"://"}),"), followed by a\nvalue, and an optional list of query parameters (",(0,i.jsx)(n.code,{children:"?"}),"). Currently files can be specified using the\n",(0,i.jsxs)(n.a,{href:"/docs/config/project#file-paths",children:[(0,i.jsx)(n.code,{children:"file://"})," scheme"]}),", and globs with the\n",(0,i.jsxs)(n.a,{href:"/docs/config/project#glob-patterns",children:[(0,i.jsx)(n.code,{children:"glob://"})," scheme"]}),". Environment variables do not support URIs."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",metastring:'title="moon.yml"',children:"tasks:\n  build:\n    # ...\n    inputs:\n      - 'file:///*.config.js?optional'\n      - 'glob://src/**/*.ts'\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"Files and globs can still be configured using literal strings. The URI format can be used when\ncustomizing parameters!"})}),"\n",(0,i.jsx)(n.h4,{id:"objects",children:"Objects"}),"\n",(0,i.jsxs)(n.p,{children:["Objects provide an alternative to strings, allowing you to customize parameters in a standard and\nfamiliar format. Files can be specified using the ",(0,i.jsxs)(n.a,{href:"/docs/config/project#file-paths",children:[(0,i.jsx)(n.code,{children:"file"})," key"]}),", and\nglobs with the ",(0,i.jsxs)(n.a,{href:"/docs/config/project#glob-patterns",children:[(0,i.jsx)(n.code,{children:"glob"})," key"]}),". Environment variables do not\nsupport objects."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",metastring:'title="moon.yml"',children:"tasks:\n  build:\n    # ...\n    inputs:\n      - file: '/*.config.js'\n        optional: true\n      - glob: 'src/**/*.ts'\n"})}),"\n",(0,i.jsx)(n.h3,{id:"new-parameters",children:"New parameters"}),"\n",(0,i.jsx)(n.p,{children:"As mentioned above, file and glob inputs now support parameters, which can be customized using URI\nand object formats. The following parameters are available:"}),"\n",(0,i.jsx)(n.h4,{id:"files",children:"Files"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"content"})," (",(0,i.jsx)(n.code,{children:"string"}),") - When determining affected state, will match against the file's content\nusing the defined regex pattern, instead of relying on file existence."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"optional"})," (",(0,i.jsx)(n.code,{children:"boolean"}),") - When hashing and set to ",(0,i.jsx)(n.code,{children:"true"})," and the file is missing, will not log a\nwarning. When set to ",(0,i.jsx)(n.code,{children:"false"})," and the file is missing, will fail with an error. Defaults to logging\na warning."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"globs",children:"Globs"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cache"})," (",(0,i.jsx)(n.code,{children:"boolean"}),") - When gathering inputs for hashing, defines whether the glob results should\nbe cached for the duration of the moon process. Defaults to ",(0,i.jsx)(n.code,{children:"true"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"better-proto-integration",children:"Better proto integration"}),"\n",(0,i.jsxs)(n.p,{children:["In previous versions of moon, we would automatically install ",(0,i.jsx)(n.a,{href:"/proto",children:"proto"})," for you based on\ncertain conditions. This logic was applied to all ",(0,i.jsx)(n.code,{children:"moon"})," sub-commands, which was not necessary, as\nit was only required for task running related commands."]}),"\n",(0,i.jsxs)(n.p,{children:["To improve this, we have integrated proto into the action pipeline through a new action,\n",(0,i.jsx)(n.code,{children:"SetupProto"}),", which runs before any ",(0,i.jsx)(n.code,{children:"SetupToolchain"})," action. With this, proto is only installed when\nrequired by that specific toolchain, and not for every command."]}),"\n",(0,i.jsxs)(n.h3,{id:"new-proto-setting",children:["New ",(0,i.jsx)(n.code,{children:"proto"})," setting"]}),"\n",(0,i.jsxs)(n.p,{children:["Additionally, we are introducing a ",(0,i.jsx)(n.a,{href:"/docs/config/toolchain#proto",children:(0,i.jsx)(n.code,{children:"proto"})})," setting in\n",(0,i.jsx)(n.a,{href:"/docs/config/toolchain",children:(0,i.jsx)(n.code,{children:".moon/toolchain.yml"})}),", which can be used to control the integration of\nproto in moon. To start, you can now customize the proto version! This is extremely useful if you\nwant to test new proto features, or need to rollback to an older version."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",metastring:'title=".moon/toolchain.yml"',children:"proto:\n  version: '0.51.4'\n"})}),"\n",(0,i.jsx)(n.h3,{id:"other-changes",children:"Other changes"}),"\n",(0,i.jsxs)(n.p,{children:["Lastly, proto has been upgrade to ",(0,i.jsx)(n.a,{href:"https://github.com/moonrepo/proto/releases/tag/v0.51.0",children:"v0.51"}),',\nwhich includes 2 major features: lockfiles and custom registries. However, we have yet to test these\nfeatures thoroughly in moon, so they are not "officially" supported yet, but you can still use them\nif you wish. We will be adding support for these features in the future.']}),"\n",(0,i.jsx)(n.h2,{id:"project-layers",children:"Project layers"}),"\n",(0,i.jsxs)(n.p,{children:["Project layers may sound like a new feature, but they are simply a rename of the project type. Going\nforward, the ",(0,i.jsx)(n.code,{children:"type"})," setting in ",(0,i.jsx)(n.a,{href:"/docs/config/project",children:(0,i.jsx)(n.code,{children:"moon.yml"})})," has been renamed to\n",(0,i.jsx)(n.a,{href:"/docs/config/project#layer",children:(0,i.jsx)(n.code,{children:"layer"})}),", but backwards compatibility will be maintained until v2. Why\nthe rename?"]}),"\n",(0,i.jsxs)(n.p,{children:['The term "layer" better reflects the purpose and functionality of this concept, as it defines a\nlayer (the ',(0,i.jsx)(n.a,{href:"/docs/config/project#layer",children:(0,i.jsx)(n.code,{children:"layer"})})," setting) within the development stack (the\n",(0,i.jsx)(n.a,{href:"/docs/config/project#stack",children:(0,i.jsx)(n.code,{children:"stack"})})," setting), and helps to enforce proper relationships. This\nchange aims to improve clarity and consistency in our configuration."]}),"\n",(0,i.jsx)(n.p,{children:"For example, the following layers are available, from highest to lowest. Layers can then depend on\nlower layers, but not higher layers. Except for automations and applications, they can also depend\non themself."}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Layer"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"automation"})}),(0,i.jsx)(n.td,{children:"An automated testing suite, like E2E, integration, or visual tests."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"application"})}),(0,i.jsx)(n.td,{children:"An application of any kind."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"tool"})}),(0,i.jsx)(n.td,{children:"An internal tool, CLI, one-off script, etc."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"library"})}),(0,i.jsx)(n.td,{children:"A self-contained, shareable, and publishable set of code."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"scaffolding"})}),(0,i.jsx)(n.td,{children:"Templates or generators for scaffolding."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"configuration"})}),(0,i.jsx)(n.td,{children:"Configuration files or infrastructure."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"unknown"})}),(0,i.jsx)(n.td,{children:"When not configured."})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"Because of this rename, the following changes have been made:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"type"})," --\x3e ",(0,i.jsx)(n.code,{children:"layer"})," in ",(0,i.jsx)(n.code,{children:"moon.yml"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--type"})," --\x3e ",(0,i.jsx)(n.code,{children:"--layer"})," in ",(0,i.jsx)(n.code,{children:"moon query projects"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"projectType"})," --\x3e ",(0,i.jsx)(n.code,{children:"projectLayer"})," for MQL"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$projectType"})," --\x3e ",(0,i.jsx)(n.code,{children:"$projectLayer"})," for task tokens"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"enforceProjectTypeRelationships"})," --\x3e ",(0,i.jsx)(n.code,{children:"enforceLayerRelationships"})," in ",(0,i.jsx)(n.code,{children:".moon/workspace.yml"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"other-changes-1",children:"Other changes"}),"\n",(0,i.jsxs)(n.p,{children:["View the ",(0,i.jsx)(n.a,{href:"https://github.com/moonrepo/moon/releases/tag/v1.39.0",children:"official release"})," for a full list\nof changes."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Added unstable support for bubbling up logs from WASM plugins."}),"\n",(0,i.jsxs)(n.li,{children:["Updated the ",(0,i.jsx)(n.code,{children:"@moonrepo/cli"})," npm package to no longer rely on postinstall scripts."]}),"\n",(0,i.jsx)(n.li,{children:"Improved argument quoting for commands and scripts."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"whats-next",children:"What's next?"}),"\n",(0,i.jsx)(n.p,{children:"With toolchains plugins being stabilized more, we'd like to focus on some other areas."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Better command line argument parsing/joining (especially for task ",(0,i.jsx)(n.code,{children:"args"}),")"]}),"\n",(0,i.jsx)(n.li,{children:"Pkl configuration improvements"}),"\n",(0,i.jsx)(n.li,{children:"WASM toolchain documentation"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},25712:e=>{e.exports=JSON.parse('{"permalink":"/blog/moon-v1.39","editUrl":"https://github.com/moonrepo/moon/tree/master/website/blog/2025-07-24_moon-v1.39.mdx","source":"@site/blog/2025-07-24_moon-v1.39.mdx","title":"moon v1.39 - Improved task inputs, better proto integration, and project layers","description":"This is a rather small release, but it does include some important changes to task inputs, and","date":"2025-07-24T00:00:00.000Z","tags":[{"inline":true,"label":"task","permalink":"/blog/tags/task"},{"inline":true,"label":"input","permalink":"/blog/tags/input"},{"inline":true,"label":"uri","permalink":"/blog/tags/uri"},{"inline":true,"label":"object","permalink":"/blog/tags/object"},{"inline":true,"label":"proto","permalink":"/blog/tags/proto"},{"inline":true,"label":"project","permalink":"/blog/tags/project"},{"inline":true,"label":"layer","permalink":"/blog/tags/layer"}],"readingTime":4.39,"hasTruncateMarker":true,"authors":[{"name":"Miles Johnson","title":"Founder, developer","url":"https://github.com/milesj","imageURL":"/img/authors/miles.jpg","key":"milesj","page":null}],"frontMatter":{"slug":"moon-v1.39","title":"moon v1.39 - Improved task inputs, better proto integration, and project layers","authors":["milesj"],"tags":["task","input","uri","object","proto","project","layer"],"image":"./img/moon/v1.39.png"},"unlisted":false,"nextItem":{"title":"proto v0.51 - Unstable lockfiles and plugin registries","permalink":"/blog/proto-v0.51"}}')},43023:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>l});var o=t(63696);const i={},s=o.createContext(i);function r(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(s.Provider,{value:n},e.children)}},89009:(e,n,t)=>{t.d(n,{A:()=>o});const o=t.p+"assets/images/v1.39-c73214e6e1ad4ce981cd1b36f4574db5.png"}}]);