"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[16342],{15868:(e,t,n)=>{n.d(t,{A:()=>r});var s=n(65162),i=n(62540);function r(e){let{header:t,inline:n,updated:r,version:a}=e;return(0,i.jsx)(s.A,{text:`v${a}`,variant:r?"success":"info",className:t?"absolute right-0 top-1.5":n?"inline-block ml-1":"ml-2"})}},37863:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>c,default:()=>x,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"concepts/task","title":"Tasks","description":"Tasks are commands that are ran in the context of a project. Underneath the hood, a","source":"@site/docs/concepts/task.mdx","sourceDirName":"concepts","slug":"/concepts/task","permalink":"/docs/concepts/task","draft":false,"unlisted":false,"editUrl":"https://github.com/moonrepo/moon/tree/master/website/docs/concepts/task.mdx","tags":[],"version":"current","frontMatter":{"title":"Tasks"},"sidebar":"docs","previous":{"title":"Targets","permalink":"/docs/concepts/target"},"next":{"title":"Task inheritance","permalink":"/docs/concepts/task-inheritance"}}');var i=n(62540),r=n(43023),a=n(15868);const l={title:"Tasks"},c=void 0,o={},d=[{value:"IDs",id:"ids",level:2},{value:"Types",id:"types",level:2},{value:"Modes",id:"modes",level:2},{value:"Local only",id:"local-only",level:3},{value:"Internal only<VersionLabel></VersionLabel>",id:"internal-only",level:3},{value:"Interactive<VersionLabel></VersionLabel>",id:"interactive",level:3},{value:"Persistent<VersionLabel></VersionLabel>",id:"persistent",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Commands vs Scripts",id:"commands-vs-scripts",level:3},{value:"Inheritance",id:"inheritance",level:3}];function h(e){const t={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:["Tasks are commands that are ran in the context of a ",(0,i.jsx)(t.a,{href:"./project",children:"project"}),". Underneath the hood, a\ntask is simply a binary or system command that is ran as a child process."]}),"\n",(0,i.jsx)(t.h2,{id:"ids",children:"IDs"}),"\n",(0,i.jsxs)(t.p,{children:["A task identifier (or name) is a unique resource for locating a task ",(0,i.jsx)(t.em,{children:"within"})," a project. The ID is\nexplicitly configured as a key within the ",(0,i.jsx)(t.a,{href:"../config/project#tasks",children:(0,i.jsx)(t.code,{children:"tasks"})})," setting, and can be\nwritten in camel/kebab/snake case. IDs support alphabetic unicode characters, ",(0,i.jsx)(t.code,{children:"0-9"}),", ",(0,i.jsx)(t.code,{children:"_"}),", ",(0,i.jsx)(t.code,{children:"-"}),", ",(0,i.jsx)(t.code,{children:"/"}),",\n",(0,i.jsx)(t.code,{children:"."}),", and must start with a character."]}),"\n",(0,i.jsxs)(t.p,{children:["A task ID can be paired with a scope to create a ",(0,i.jsx)(t.a,{href:"./target",children:"target"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"types",children:"Types"}),"\n",(0,i.jsx)(t.p,{children:"Tasks are grouped into 1 of the following types based on their configured parameters."}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Build"})," - Task generates one or many artifacts, and is derived from the\n",(0,i.jsx)(t.a,{href:"../config/project#outputs",children:(0,i.jsx)(t.code,{children:"outputs"})})," setting."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Run"})," - Task runs a one-off, long-running, or never-ending process, and is derived from the\n",(0,i.jsx)(t.a,{href:"../config/project#local",children:(0,i.jsx)(t.code,{children:"local"})})," setting."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Test"})," - Task asserts code is correct and behaves as expected. This includes linting,\ntypechecking, unit tests, and any other form of testing. Is the default."]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"modes",children:"Modes"}),"\n",(0,i.jsx)(t.p,{children:"Alongside types, tasks can also grouped into a special mode that provides unique handling within the\naction graph and pipelines."}),"\n",(0,i.jsx)(t.h3,{id:"local-only",children:"Local only"}),"\n",(0,i.jsxs)(t.p,{children:["Tasks either run locally, in CI (continuous integration pipelines), or both. For tasks that should\n",(0,i.jsx)(t.em,{children:"only"})," be ran locally, for example, development servers and watchers, we provide a mechanism for\nmarking a task as local only. When enabled, caching is turned off, the task will not run in CI,\nterminal output is not captured, and the task is marked as ",(0,i.jsx)(t.a,{href:"#persistent",children:"persistent"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["To mark a task as local only, enable the ",(0,i.jsx)(t.a,{href:"../config/project#local",children:(0,i.jsx)(t.code,{children:"local"})})," setting."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"tasks:\n  dev:\n    command: 'start-dev-server'\n    local: true\n"})}),"\n",(0,i.jsxs)(t.h3,{id:"internal-only",children:["Internal only",(0,i.jsx)(a.A,{version:"1.23.0"})]}),"\n",(0,i.jsxs)(t.p,{children:["Internal tasks are tasks that are not meant to be ran explicitly by the user (via\n",(0,i.jsx)(t.a,{href:"../commands/check",children:(0,i.jsx)(t.code,{children:"moon check"})})," or ",(0,i.jsx)(t.a,{href:"../commands/run",children:(0,i.jsx)(t.code,{children:"moon run"})}),"), but are used internally as\ndependencies of other tasks. Additionally, internal tasks are not displayed in a project's tasks\nlist, but can be inspected with ",(0,i.jsx)(t.a,{href:"../commands/task",children:(0,i.jsx)(t.code,{children:"moon task"})}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["To mark a task as internal, enable the ",(0,i.jsx)(t.a,{href:"../config/project#internal",children:(0,i.jsx)(t.code,{children:"options.internal"})})," setting."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"tasks:\n  prepare:\n    command: 'intermediate-step'\n    options:\n      internal: true\n"})}),"\n",(0,i.jsxs)(t.h3,{id:"interactive",children:["Interactive",(0,i.jsx)(a.A,{version:"1.12.0"})]}),"\n",(0,i.jsx)(t.p,{children:"Tasks that need to interact with the user via terminal prompts are known as interactive tasks.\nBecause interactive tasks require stdin, and it's not possible to have multiple parallel running\ntasks interact with stdin, we isolate interactive tasks from other tasks in the action graph. This\nensures that only 1 interactive task is ran at a time."}),"\n",(0,i.jsxs)(t.p,{children:["To mark a task as interactive, enable the ",(0,i.jsx)(t.a,{href:"../config/project#interactive",children:(0,i.jsx)(t.code,{children:"options.interactive"})}),"\nsetting."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"tasks:\n  init:\n    command: 'init-app'\n    options:\n      interactive: true\n"})}),"\n",(0,i.jsxs)(t.h3,{id:"persistent",children:["Persistent",(0,i.jsx)(a.A,{version:"1.6.0"})]}),"\n",(0,i.jsx)(t.p,{children:"Tasks that never complete, like servers and watchers, are known as persistent tasks. Persistent\ntasks are typically problematic when it comes to dependency graphs, because if they run in the\nmiddle of the graph, subsequent tasks will never run because the persistent task never completes!"}),"\n",(0,i.jsxs)(t.p,{children:["However in moon, this is a non-issue, as we collect all persistent tasks within the action graph and\nrun them ",(0,i.jsx)(t.em,{children:"last as a batch"}),". This is perfect for a few reasons:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"All persistent tasks are ran in parallel, so they don't block each other."}),"\n",(0,i.jsx)(t.li,{children:"Running both the backend API and frontend webapp in parallel is a breeze."}),"\n",(0,i.jsx)(t.li,{children:"Dependencies of persistent tasks are guaranteed to have ran and completed."}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["To mark a task as persistent, enable the ",(0,i.jsx)(t.a,{href:"../config/project#local",children:(0,i.jsx)(t.code,{children:"local"})})," or\n",(0,i.jsx)(t.a,{href:"../config/project#persistent",children:(0,i.jsx)(t.code,{children:"options.persistent"})})," settings."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"tasks:\n  dev:\n    command: 'start-dev-server'\n    local: true\n    # OR\n    options:\n      persistent: true\n"})}),"\n",(0,i.jsx)(t.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsxs)(t.p,{children:["Tasks can be configured per project through ",(0,i.jsx)(t.a,{href:"../config/project",children:(0,i.jsx)(t.code,{children:"moon.yml"})}),", or for many projects\nthrough ",(0,i.jsx)(t.a,{href:"../config/tasks",children:(0,i.jsx)(t.code,{children:".moon/tasks.yml"})}),"."]}),"\n",(0,i.jsx)(t.h3,{id:"commands-vs-scripts",children:"Commands vs Scripts"}),"\n",(0,i.jsxs)(t.p,{children:["A task is either a command or script, but not both. So what's the difference exactly? In the context\nof a moon task, a command is a single binary execution with optional arguments, configured with the\n",(0,i.jsx)(t.a,{href:"../config/project#command",children:(0,i.jsx)(t.code,{children:"command"})})," and ",(0,i.jsx)(t.a,{href:"../config/project#args",children:(0,i.jsx)(t.code,{children:"args"})})," settings (which both\nsupport a string or array). While a script is one or many binary executions, with support for pipes\nand redirects, and configured with the ",(0,i.jsx)(t.a,{href:"../config/project#script",children:(0,i.jsx)(t.code,{children:"script"})})," setting (which is only a\nstring)."]}),"\n",(0,i.jsx)(t.p,{children:"A command also supports merging during task inheritance, while a script does not and will always\nreplace values. Refer to the table below for more differences between the 2."}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{style:{textAlign:"left"}}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Command"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Script"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Configured as"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"string, array"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"string"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Inheritance merging"}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:["\u2705 via ",(0,i.jsx)(t.code,{children:"mergeArgs"})," option"]}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"\u26a0\ufe0f always replaces"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Additional args"}),(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:["\u2705 via ",(0,i.jsx)(t.code,{children:"args"})," setting"]}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"\u274c"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Passthrough args (from CLI)"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"\u2705"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"\u274c"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:["Multiple commands (with ",(0,i.jsx)(t.code,{children:"&&"})," or ",(0,i.jsx)(t.code,{children:";"}),")"]}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"\u274c"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"\u2705"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Pipes, redirects, etc"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"\u274c"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"\u2705"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Always ran in a shell"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"\u274c"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"\u2705"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Custom platform/toolchain"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"\u2705"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"\u2705"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,i.jsx)(t.a,{href:"./token",children:"Token"})," functions and variables"]}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"\u2705"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"\u2705"})]})]})]}),"\n",(0,i.jsx)(t.h3,{id:"inheritance",children:"Inheritance"}),"\n",(0,i.jsxs)(t.p,{children:["View the official documentation on ",(0,i.jsx)(t.a,{href:"./task-inheritance",children:"task inheritance"}),"."]})]})}function x(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},43023:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>l});var s=n(63696);const i={},r=s.createContext(i);function a(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:t},e.children)}},65162:(e,t,n)=>{n.d(t,{A:()=>l});var s=n(11750),i=n(74599),r=n(62540);const a={failure:"bg-red-100 text-red-900",info:"bg-pink-100 text-pink-900",success:"bg-green-100 text-green-900",warning:"bg-orange-100 text-orange-900"};function l(e){let{className:t,icon:n,text:l,variant:c}=e;return(0,r.jsxs)("span",{className:(0,s.A)("inline-flex items-center px-1 py-0.5 rounded text-xs font-bold uppercase",c?a[c]:"bg-gray-100 text-gray-800",t),children:[n&&(0,r.jsx)(i.A,{icon:n,className:"mr-1"}),l]})}}}]);