"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[96490],{43023:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>l});var o=i(63696);const s={},t=o.createContext(s);function r(e){const n=o.useContext(t);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),o.createElement(t.Provider,{value:n},e.children)}},92927:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"permalink":"/blog/moon-v2.0","editUrl":"https://github.com/moonrepo/moon/tree/master/website/blog/2026-02-01_moon-v2.0.mdx","source":"@site/blog/2026-02-01_moon-v2.0.mdx","title":"moon v2.0 - Official \\"Phobos\\" release!","description":"TODO: This blog post is a work in progress!","date":"2026-02-01T00:00:00.000Z","tags":[],"readingTime":12.3,"hasTruncateMarker":true,"authors":[{"name":"Miles Johnson","title":"Founder, developer","url":"https://github.com/milesj","imageURL":"/img/authors/miles.jpg","key":"milesj","page":null}],"frontMatter":{"slug":"moon-v2.0","title":"moon v2.0 - Official \\"Phobos\\" release!","authors":["milesj"],"tags":[],"unlisted":true},"unlisted":true}');var s=i(62540),t=i(43023);const r={slug:"moon-v2.0",title:'moon v2.0 - Official "Phobos" release!',authors:["milesj"],tags:[],unlisted:!0},l=void 0,a={authorsImageUrls:[void 0]},c=[{value:"Breaking changes",id:"breaking-changes",level:2},{value:"CLI",id:"cli",level:2},{value:"New and improved commands",id:"new-and-improved-commands",level:3},{value:"New <code>exec</code> command",id:"new-exec-command",level:3},{value:"Updated <code>ci</code>, <code>check</code>, and <code>run</code> commands",id:"updated-ci-check-and-run-commands",level:3},{value:"Dynamic identifier &amp; target selection",id:"dynamic-identifier--target-selection",level:3},{value:"Stabilized <code>moonx</code>",id:"stabilized-moonx",level:3},{value:"Support for <code>.config</code>",id:"support-for-config",level:3},{value:"Configuration",id:"configuration",level:2},{value:"New file formats",id:"new-file-formats",level:3},{value:"Toolchains",id:"toolchains",level:2},{value:"Plugin based system",id:"plugin-based-system",level:3},{value:"Improved <code>PATH</code> handling",id:"improved-path-handling",level:3},{value:"Extensions",id:"extensions",level:2},{value:"Stand-alone configuration",id:"stand-alone-configuration",level:3},{value:"New plugin APIs",id:"new-plugin-apis",level:3},{value:"Management commands",id:"management-commands",level:3},{value:"Projects",id:"projects",level:2},{value:"Default project",id:"default-project",level:3},{value:"Path based IDs",id:"path-based-ids",level:3},{value:"Multiple aliases",id:"multiple-aliases",level:3},{value:"New <code>data</code> stack",id:"new-data-stack",level:3},{value:"Tasks",id:"tasks",level:2},{value:"Strict commands",id:"strict-commands",level:3},{value:"Inheritance via configuration",id:"inheritance-via-configuration",level:3},{value:"Toolchain merging",id:"toolchain-merging",level:3},{value:"Robust env files",id:"robust-env-files",level:3},{value:"New <code>utility</code> preset",id:"new-utility-preset",level:3},{value:"Docker",id:"docker",level:2},{value:"Defaults with overrides",id:"defaults-with-overrides",level:3},{value:"Dockerfile templates",id:"dockerfile-templates",level:3},{value:"VCS",id:"vcs",level:2},{value:"New implementation",id:"new-implementation",level:3},{value:"Worktree compatible hooks",id:"worktree-compatible-hooks",level:3},{value:"Other changes",id:"other-changes",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"TODO: This blog post is a work in progress!"}),"\n",(0,s.jsx)(n.h2,{id:"breaking-changes",children:"Breaking changes"}),"\n",(0,s.jsxs)(n.p,{children:["Since this is our first major release after v1, there are quite a few breaking changes, far too many\nto list here! Please refer to the ",(0,s.jsx)(n.a,{href:"/docs/migrate/2.0",children:"official migration guide"})," for a comprehensive\nlist of breaking changes and how to address them."]}),"\n",(0,s.jsx)(n.h2,{id:"cli",children:"CLI"}),"\n",(0,s.jsx)(n.h3,{id:"new-and-improved-commands",children:"New and improved commands"}),"\n",(0,s.jsx)(n.p,{children:"As part of this release, we went through every CLI command and made improvements to their usability,\nfunctionality, and rendered output. On top of this, we're also introducing a handful of new commands\nto fill some missing gaps. Here are some highlights:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"moon exec"})," - Low-level command for running tasks. Read more below!"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"moon extension"})," - Top-level command to ",(0,s.jsx)(n.a,{href:"#management-commands",children:"manage extensions"})," in the\nworkspace."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"moon hash"})," - Inspect a hash, or diff two hashes."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"moon projects"})," - Display a table of all projects."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"moon query affected"})," - Query affected status for projects and tasks."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"moon tasks"})," - Display a table of all tasks or for a specific project."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"moon template"})," - Display information about a template."]}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"new-exec-command",children:["New ",(0,s.jsx)(n.code,{children:"exec"})," command"]}),"\n",(0,s.jsxs)(n.p,{children:["To simplify running tasks and improve consistency across commands, we've introduced a new low-level\n",(0,s.jsx)(n.code,{children:"moon exec"})," command. This command is now used under the hood by ",(0,s.jsx)(n.code,{children:"moon check"}),", ",(0,s.jsx)(n.code,{children:"moon ci"}),", and\n",(0,s.jsx)(n.code,{children:"moon run"}),", with some arguments/options pre-filled. This allows us to have a single command that is\nresponsible for executing tasks, while still providing higher-level commands for specific use cases."]}),"\n",(0,s.jsxs)(n.p,{children:["This paves the way for future commands that can leverage ",(0,s.jsx)(n.code,{children:"moon exec"}),", such as a potential\n",(0,s.jsx)(n.code,{children:"moon deploy"})," or ",(0,s.jsx)(n.code,{children:"moon watch"})," command."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"$ moon exec app:build --dependents direct\n"})}),"\n",(0,s.jsx)(n.p,{children:"Additionally, it allows these other commands to inherit functionality they didn't support\npreviously, like job parallelization, affected filtering, and more."}),"\n",(0,s.jsxs)(n.h3,{id:"updated-ci-check-and-run-commands",children:["Updated ",(0,s.jsx)(n.code,{children:"ci"}),", ",(0,s.jsx)(n.code,{children:"check"}),", and ",(0,s.jsx)(n.code,{children:"run"})," commands"]}),"\n",(0,s.jsxs)(n.p,{children:["As mentioned previously, all of these commands have been reworked to use ",(0,s.jsx)(n.code,{children:"moon exec"})," under the hood.\nThis means that they now share the same core functionality and behavior, while still providing their\nown unique features and options."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"$ moon ci\n$ moon check app\n$ moon run app:dev --affected\n"})}),"\n",(0,s.jsx)(n.h3,{id:"dynamic-identifier--target-selection",children:"Dynamic identifier & target selection"}),"\n",(0,s.jsx)(n.p,{children:"For some commands that require a project, task, or template identifier/target, we've added an\ninteractive selection prompt if no value is provided. This makes it easier to explore and use the\nCLI without needing to know specific identifiers ahead of time. The following commands now support\nthis:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"moon check"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"moon ci"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"moon exec"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"moon generate"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"moon project"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"moon run"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"moon task"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"moon template"})}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["To demonstrate this, here we are running ",(0,s.jsx)(n.code,{children:"moon project"})," without an identifier:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"$ moon project\n\n\u2502 Which project to view?\n\u2502\n\u2502 \u276f report\n\u2502   runtime\n\u2502   types\n\u2502   visualizer\n\u2502   website - A static website.\n\u2502\n\u2502 \u23b5 select \u2043 \u2195 cycle \u2043 \u21b5 submit\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"stabilized-moonx",children:["Stabilized ",(0,s.jsx)(n.code,{children:"moonx"})]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"moonx"})," executable, sibling to ",(0,s.jsx)(n.code,{children:"moon"}),", has been stabilized, and is no longer a shim, but a\nproper standalone binary. This executable is simply a shorthand for ",(0,s.jsx)(n.code,{children:"moon exec"}),", and ",(0,s.jsx)(n.em,{children:"replaces"})," the\nshorthand syntax that previously existed with ",(0,s.jsx)(n.code,{children:"moon <target>"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# Before\n$ moon run app:build\n$ moon exec app:build\n$ moon app:build\n\n# After\n$ moonx app:build\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"support-for-config",children:["Support for ",(0,s.jsx)(n.code,{children:".config"})]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:".moon"})," directory denotes the root of the workspace, but if you don't like clutter, this may\nfeel overwhelming. To help with this, we've introduced support for the\n",(0,s.jsxs)(n.a,{href:"https://dot-config.github.io/",children:[(0,s.jsx)(n.code,{children:".config"})," directory pattern"]}),", allowing you to define your workspace\nconfiguration in a more organized manner."]}),"\n",(0,s.jsxs)(n.p,{children:["Simply use ",(0,s.jsx)(n.code,{children:".config/moon"})," instead of ",(0,s.jsx)(n.code,{children:".moon"}),"! The workspace root will now be the directory that\ncontains the ",(0,s.jsx)(n.code,{children:".config"})," directory."]}),"\n",(0,s.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsx)(n.h3,{id:"new-file-formats",children:"New file formats"}),"\n",(0,s.jsxs)(n.p,{children:["We've been pretty strict about only supporting YAML based configuration for quite some time, but we\nunderstand that people have different preferences (many of you hate YAML, which is fair). We've\nexperimented in the past a bit by adding support for ",(0,s.jsx)(n.a,{href:"https://pkl-lang.org/",children:"Pkl"}),", which is a\nprogrammable configuration, but it required a learning curve."]}),"\n",(0,s.jsx)(n.p,{children:"Over time, we've come to loosen our stance on YAML, and are now introducing support for not just\none, but many additional formats! The following file formats are now supported for all moon\nconfiguration files:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["JSON (",(0,s.jsx)(n.code,{children:".json"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["JSON with comments (",(0,s.jsx)(n.code,{children:".jsonc"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/hashicorp/hcl",children:"HCL"})," (",(0,s.jsx)(n.code,{children:".hcl"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://pkl-lang.org/",children:"Pkl"})," (",(0,s.jsx)(n.code,{children:".pkl"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://toml.io/en/",children:"TOML"})," (",(0,s.jsx)(n.code,{children:".toml"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["YAML (",(0,s.jsx)(n.code,{children:".yml"}),", ",(0,s.jsx)(n.code,{children:".yaml"}),")"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"toolchains",children:"Toolchains"}),"\n",(0,s.jsx)(n.h3,{id:"plugin-based-system",children:"Plugin based system"}),"\n",(0,s.jsx)(n.p,{children:"The new toolchain system replaces the legacy platform system and is the biggest change in moon v2.\nToolchains are now powered by WASM plugins, instead of hard-coded in core, allowing for more\nflexibility, extensibility, and the ability for the community to create their own toolchains!"}),"\n",(0,s.jsx)(n.p,{children:"Moving to a plugin based system enables us to support more languages, more features, deeper\nintegration, as well as more complex workflows. For example, in the future we can now easily support\nrelease workflows (changelogs, versioning, publishing) as part of a toolchain."}),"\n",(0,s.jsx)(n.p,{children:"Just to demonstrate how powerful the plugin system is, it currently supports all the following\nfeatures:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Extending the project graph with project dependencies and aliases"}),"\n",(0,s.jsx)(n.li,{children:"Extending task commands and scripts before they're executed"}),"\n",(0,s.jsx)(n.li,{children:"Integrates with our Docker flow for pruning and scaffolding"}),"\n",(0,s.jsx)(n.li,{children:"Runs operations during the project/workspace sync processes"}),"\n",(0,s.jsx)(n.li,{children:"Locates a root dependencies directory for package manager workspaces"}),"\n",(0,s.jsx)(n.li,{children:"Parses manifest and lock files to extract dependencies and metadata"}),"\n",(0,s.jsx)(n.li,{children:"Sets up the environment and auto-installs dependencies"}),"\n",(0,s.jsx)(n.li,{children:"Hook into the task hashing process"}),"\n",(0,s.jsx)(n.li,{children:"Manages downloading and installing tools (via proto)"}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"improved-path-handling",children:["Improved ",(0,s.jsx)(n.code,{children:"PATH"})," handling"]}),"\n",(0,s.jsxs)(n.p,{children:["Toolchain (and extension) plugins have the ability to modify the ",(0,s.jsx)(n.code,{children:"PATH"})," environment variable for\nmost child processes that occur during task execution, but the way we handled this has been improved\nsignificantly. Previously, there were some inconsistencies around when and how the ",(0,s.jsx)(n.code,{children:"PATH"})," was\nmodified, leading to unexpected behavior in certain scenarios. Going forward, we inherit paths using\na strict order of operations:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Inherit for all commands using ",(0,s.jsx)(n.code,{children:"extend_command"})," extension and toolchain calls"]}),"\n",(0,s.jsxs)(n.li,{children:["Inherit for task commands using ",(0,s.jsx)(n.code,{children:"extend_task_command"})," or ",(0,s.jsx)(n.code,{children:"extend_task_script"})," toolchain calls"]}),"\n",(0,s.jsx)(n.li,{children:"Inherit toolchain executable directories"}),"\n",(0,s.jsx)(n.li,{children:"Inherit proto shims and bins directories"}),"\n",(0,s.jsx)(n.li,{children:"Inherit proto and moon store directories"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"extensions",children:"Extensions"}),"\n",(0,s.jsx)(n.h3,{id:"stand-alone-configuration",children:"Stand-alone configuration"}),"\n",(0,s.jsxs)(n.p,{children:["Extensions are a WASM plugin based system that has existed for some time now, but they only\nsupported a single functionality: custom execution through the ",(0,s.jsx)(n.a,{href:"/docs/commands/ext",children:(0,s.jsx)(n.code,{children:"moon ext"})}),"\ncommand. With the introduction of toolchain plugins, we wanted to expand the extension system to\nallow for more flexibility and use cases."]}),"\n",(0,s.jsxs)(n.p,{children:["To start, we're intoducing a new ",(0,s.jsx)(n.code,{children:".moon/extensions.*"})," configuration file, that will contain all\nextensions, similar to how toolchains are configured in ",(0,s.jsx)(n.code,{children:".moon/toolchains.*"}),". Because of this\nchange, the ",(0,s.jsx)(n.code,{children:"extensions"})," setting has been removed from the workspace configuration."]}),"\n",(0,s.jsx)(n.h3,{id:"new-plugin-apis",children:"New plugin APIs"}),"\n",(0,s.jsx)(n.p,{children:"With extensions now being first-class citizens in moon, we've expanded the PDK API to allow for more\nfunctionality. Extensions can now utilize the following API functions, similar to toolchains:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"define_extension_config"})," - Define the configuration schema for the extension."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"initialize_extension"})," - Initialize the extension with user prompts."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"extend_project_graph"})," - Extend projects with aliases, dependencies, and tasks."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"extend_task_command"})," - Extend the task command before it's executed."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"extend_task_script"})," - Extend the task script before it's executed."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"sync_project"})," - Run operations during the project sync process."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"sync_workspace"})," - Run operations during the workspace sync process."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"management-commands",children:"Management commands"}),"\n",(0,s.jsxs)(n.p,{children:["To easily manage extensions, we've added new commands under the ",(0,s.jsx)(n.code,{children:"moon extension"})," namespace:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"moon extension add"})," - Add a new extension to the workspace."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"moon extension info"})," - Display information about an extension."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"$ moon extension info migrate-nx\n\nExtension \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  Migrate an Nx repository to moon by converting all nx.json and\n  project.json files into moon configuration files.\n\n  ID: migrate-nx\n  Title: Migrate Nx\n  Version: 0.0.11\n\nAPIs \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  \ud83d\udfe2 register_extension (required)\n  \u26ab\ufe0f define_extension_config\n  \u26ab\ufe0f initialize_extension\n  \ud83d\udfe2 execute_extension\n  \u26ab\ufe0f sync_project\n  \u26ab\ufe0f sync_workspace\n  \u26ab\ufe0f extend_project_graph\n  \u26ab\ufe0f extend_task_command\n  \u26ab\ufe0f extend_task_script\n"})}),"\n",(0,s.jsx)(n.h2,{id:"projects",children:"Projects"}),"\n",(0,s.jsx)(n.h3,{id:"default-project",children:"Default project"}),"\n",(0,s.jsxs)(n.p,{children:["By request from the community, we've added a new ",(0,s.jsx)(n.code,{children:"defaultProject"})," setting to the workspace\nconfiguration. This setting allows you to specify a default project that will be used when running\ntasks that require a project identifier, but none was provided. This is especially useful for\nworkspaces with a single project, or when you have a primary project that you work on most of the\ntime."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title=".moon/workspace.yml"',children:"defaultProject: 'app'\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# Before\n$ moon run app:build\n\n# After\n$ moon run build\n$ moonx build\n"})}),"\n",(0,s.jsx)(n.h3,{id:"path-based-ids",children:"Path based IDs"}),"\n",(0,s.jsxs)(n.p,{children:["When locating projects with globs via the ",(0,s.jsx)(n.code,{children:"projects"})," workspace configuration, we would historically\nuse the directory name as the project ID. While this works in most cases, it can lead to issues when\nthe directory name collides with another project, or is not descriptive enough. For example,\n",(0,s.jsx)(n.code,{children:"packages/server/utils"})," would become ",(0,s.jsx)(n.code,{children:"utils"}),". What if you also had ",(0,s.jsx)(n.code,{children:"packages/client/utils"}),"?"]}),"\n",(0,s.jsxs)(n.p,{children:["To solve this, we've introduced a new ",(0,s.jsx)(n.code,{children:"projects.globFormat"})," setting, which can be configured as\n",(0,s.jsx)(n.code,{children:"source-path"})," and will use the full relative source path as the project ID."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title=".moon/workspace.yml"',children:"projects:\n  globFormat: 'source-path'\n  globs:\n    - 'packages/**/moon.yml'\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Using the examples above, the resulting project IDs would now be ",(0,s.jsx)(n.code,{children:"packages/server/utils"})," and\n",(0,s.jsx)(n.code,{children:"packages/client/utils"}),", respectively."]}),"\n",(0,s.jsx)(n.h3,{id:"multiple-aliases",children:"Multiple aliases"}),"\n",(0,s.jsxs)(n.p,{children:["In addition to identifiers, projects also support aliases, which are toolchain specific names\nderived from manifest files, for example, the ",(0,s.jsx)(n.code,{children:"name"})," field in ",(0,s.jsx)(n.code,{children:"package.json"})," or ",(0,s.jsx)(n.code,{children:"Cargo.toml"}),". This\nallows you to refer to projects by their native names on the command line, in configuration, and\nmore."]}),"\n",(0,s.jsxs)(n.p,{children:["Previously, projects only supported a single alias, but now they support multiple aliases, one from\neach applicable toolchain. In addition, we have added a new ",(0,s.jsx)(n.code,{children:"$projectAliases"})," token, which is a\ncomma-separated list of all aliases. The existing ",(0,s.jsx)(n.code,{children:"$projectAlias"})," token now returns the first alias,\nif it exists."]}),"\n",(0,s.jsxs)(n.h3,{id:"new-data-stack",children:["New ",(0,s.jsx)(n.code,{children:"data"})," stack"]}),"\n",(0,s.jsxs)(n.p,{children:["Our stack system represents all aspects of a development stack, except one, the database/data layer!\nTo give you more control around categorization, we've added a new ",(0,s.jsx)(n.code,{children:"data"})," stack type, which can be\nused to represent projects that are primarily focused on data storage. This includes databases, ETL\npipelines, and other data-centric use cases."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"stack: 'data'\n"})}),"\n",(0,s.jsx)(n.h2,{id:"tasks",children:"Tasks"}),"\n",(0,s.jsx)(n.h3,{id:"strict-commands",children:"Strict commands"}),"\n",(0,s.jsxs)(n.p,{children:["We've reworked the task ",(0,s.jsx)(n.code,{children:"command"})," and ",(0,s.jsx)(n.code,{children:"args"})," parser, when a string is provided, to be more strict\nand accurate. Previously, we used a simple shell-like parser that would split on spaces, but this\nled to issues with quoted strings, escaped characters, and other edge cases."]}),"\n",(0,s.jsxs)(n.p,{children:["Related to this change, these fields will now ",(0,s.jsx)(n.em,{children:"only support"})," simple commands and arguments, and will\nnot support complex syntax like pipes, redirects, and conditionals. This is a breaking change, but\nyou can use ",(0,s.jsx)(n.code,{children:"script"})," instead for complex commands."]}),"\n",(0,s.jsx)(n.h3,{id:"inheritance-via-configuration",children:"Inheritance via configuration"}),"\n",(0,s.jsxs)(n.p,{children:["Our task inheritance system is quite powerful, and one of moon's most compelling features. However,\nit can be rather restrictive as inheritance is based entirely on file naming conventions. To provide\nmore flexibility, we've reworked task inheritance to be configuration based, by introducing a new\n",(0,s.jsx)(n.code,{children:"inheritedBy"})," setting for all ",(0,s.jsx)(n.code,{children:".moon/tasks/**/*"})," files."]}),"\n",(0,s.jsxs)(n.p,{children:["For example, if you had a tasks file named ",(0,s.jsx)(n.code,{children:".moon/tasks/node-frontend-library.yml"}),", it would now be\nconfigured like so:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title=".moon/tasks/node-frontend-library.yml"',children:"inheritedBy:\n  toolchain: 'node'\n  stack: 'frontend'\n  layer: 'library'\n"})}),"\n",(0,s.jsx)(n.p,{children:"This new system is very powerful, as you can now mix-and-match different criteria to control how\ntasks are inherited. The following conditions are supported out of the box, providing granular\ncontrol:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"files"})," (NEW) - Inherit for projects that contain specific files."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"languages"})," (NEW) - Inherit for projects that belong to specific ",(0,s.jsx)(n.code,{children:"language"}),"s."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"layers"})," - Inherit for projects that belong to specific ",(0,s.jsx)(n.code,{children:"layer"}),"s."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"stacks"})," - Inherit for projects that belong to specific ",(0,s.jsx)(n.code,{children:"stack"}),"s."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"tags"})," - Inherit for projects that have specific ",(0,s.jsx)(n.code,{children:"tags"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"toolchains"})," - Inherit for projects that belong to specific toolchains."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"inheritedBy:\n  # Project belongs to either javascript or typescript toolchain, but not the ruby toolchain\n  toolchains:\n    or: ['javascript', 'typescript']\n    not: ['ruby']\n  # And project is either a frontend or backend stack\n  stacks: ['frontend', 'backend']\n  # And project is either a library or tool layer\n  layers: ['library', 'tool']\n"})}),"\n",(0,s.jsx)(n.h3,{id:"toolchain-merging",children:"Toolchain merging"}),"\n",(0,s.jsxs)(n.p,{children:["A task can now be associated with multiple toolchains (javascript, node, npm), unlike the previous\nplatform system which only allowed for 1 platform (node). This change allows for more flexibility\nbut also requires more granular control over how toolchains are inherited. To accommodate this,\nwe've added a ",(0,s.jsx)(n.code,{children:"mergeToolchains"})," task option:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"tasks:\n  build:\n    # ...\n    toolchains: ['javascript']\n    options:\n      mergeToolchains: 'replace'\n"})}),"\n",(0,s.jsx)(n.h3,{id:"robust-env-files",children:"Robust env files"}),"\n",(0,s.jsxs)(n.p,{children:["Tasks have supported ",(0,s.jsx)(n.code,{children:".env"})," files for a while now, but the implementation has been somewhat limited.\nWe only supported the ",(0,s.jsx)(n.code,{children:".env"})," file with the ability for you to customize with an explicit list of\nfiles. This was cumbersome and didn't allow for much flexibility."]}),"\n",(0,s.jsxs)(n.p,{children:["Going forward, when using ",(0,s.jsx)(n.code,{children:"envFile: true"}),", moon will now automatically look for the following files\nin order, and load them if they exist:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"/.env"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"/.env.local"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:".env"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:".env.local"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:".env.<task_id>"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:".env.<task_id>.local"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Additionally, the following changes and improvements have been made."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Added support for ",(0,s.jsx)(n.code,{children:"*.local"})," files, which will only be loaded locally and not in CI environments."]}),"\n",(0,s.jsx)(n.li,{children:"Deferred loading of env files until task execution time, instead of during task creation (breaking\nchange)."}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"new-utility-preset",children:["New ",(0,s.jsx)(n.code,{children:"utility"})," preset"]}),"\n",(0,s.jsxs)(n.p,{children:["Task presets are helpful as the provide a set of default options and behaviors for common task\ntypes. However, we haven't fully utilized (pun intended) this feature yet, so are adding a new\npreset called ",(0,s.jsx)(n.code,{children:"utility"}),". This preset is designed for simple one-off tasks that primarily run\nlocally, like running a migration, or validating data."]}),"\n",(0,s.jsx)(n.p,{children:"This preset configures the following options:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"cache"})," disabled"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"interactive"})," enabled"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"persistent"})," disabled"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"outputStyle"})," as ",(0,s.jsx)(n.code,{children:"stream"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"runInCI"})," as ",(0,s.jsx)(n.code,{children:"skip"})]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"tasks:\n  validate-schema:\n    # ...\n    preset: 'utility'\n"})}),"\n",(0,s.jsx)(n.h2,{id:"docker",children:"Docker"}),"\n",(0,s.jsx)(n.h3,{id:"defaults-with-overrides",children:"Defaults with overrides"}),"\n",(0,s.jsxs)(n.p,{children:["To improve customizability of ",(0,s.jsx)(n.code,{children:"Dockerfile"})," generation, and to allow for more flexibility during the\nscaffolding process, we've updated the ",(0,s.jsx)(n.code,{children:"docker"})," settings in ",(0,s.jsx)(n.code,{children:".moon/workspace.*"})," to act as defaults,\nand the ",(0,s.jsx)(n.code,{children:"docker"})," settings in ",(0,s.jsx)(n.code,{children:"moon.*"})," to act as overrides on a per-project basis. Because of this,\nwe've also updated ",(0,s.jsx)(n.code,{children:"docker.file"})," and ",(0,s.jsx)(n.code,{children:"docker.scaffold"})," settings to be the same across both files."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title=".moon/workspace.yml"',children:"# Inherited by all projects\ndocker:\n  file:\n    buildTask: 'build'\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"# Overridden per project\ndocker:\n  file:\n    buildTask: 'compile'\n"})}),"\n",(0,s.jsx)(n.h3,{id:"dockerfile-templates",children:"Dockerfile templates"}),"\n",(0,s.jsxs)(n.p,{children:["To further expand the customizability of ",(0,s.jsx)(n.code,{children:"Dockerfile"})," generation, we've added support for custom\ntemplates to be used during the rendering process. The template can be provided with the\n",(0,s.jsx)(n.code,{children:"--template"})," option when running ",(0,s.jsx)(n.code,{children:"moon docker file"}),", or configured with the new\n",(0,s.jsx)(n.code,{children:"docker.file.template"})," setting. Template rendering is powered by\n",(0,s.jsx)(n.a,{href:"https://keats.github.io/tera/",children:"Tera"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"$ moon docker file app --template ./Dockerfile.tera\n"})}),"\n",(0,s.jsx)(n.h2,{id:"vcs",children:"VCS"}),"\n",(0,s.jsx)(n.h3,{id:"new-implementation",children:"New implementation"}),"\n",(0,s.jsxs)(n.p,{children:["In moon v1 we were running an experiment that utilizes a new Git implementation, which we dubbed Git\nv2. We've made this the default implementation and removed the legacy implementation. This new\nimplementation is faster, more reliable, and has better support for complex repositories (worktrees,\nsubmodules, etc). The ",(0,s.jsx)(n.code,{children:"experiments.gitV2"})," setting should now be removed."]}),"\n",(0,s.jsx)(n.h3,{id:"worktree-compatible-hooks",children:"Worktree compatible hooks"}),"\n",(0,s.jsxs)(n.p,{children:["We've rewritten our Git hooks system to be compatible with Git worktrees, and to better handle the\n",(0,s.jsx)(n.code,{children:"core.hooksPath"})," Git configuration. Previously hooks were written to ",(0,s.jsx)(n.code,{children:".git/hooks"})," at the repository\nroot, but we now don't write to ",(0,s.jsx)(n.code,{children:".git"})," at all, and entirely rely on ",(0,s.jsx)(n.code,{children:".moon/hooks"})," in each tree."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["You may need to enable the ",(0,s.jsx)(n.code,{children:"extensions.worktreeConfig"})," Git setting for this to work properly."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"other-changes",children:"Other changes"}),"\n",(0,s.jsxs)(n.p,{children:["View the ",(0,s.jsx)(n.a,{href:"https://github.com/moonrepo/moon/releases/tag/v2.0.0",children:"official release"})," for a full list of\nchanges."]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);