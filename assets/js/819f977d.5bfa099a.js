"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[31622],{98088:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>p,frontMatter:()=>l,metadata:()=>c,toc:()=>u});var a=t(24246),r=t(71670),s=(t(33337),t(39798),t(27915)),i=t(9634);const l={title:"Run a task"},o=void 0,c={id:"run-task",title:"Run a task",description:"Even though we've created a task, it's not useful unless we run it, which is done",source:"@site/docs/run-task.mdx",sourceDirName:".",slug:"/run-task",permalink:"/docs/run-task",draft:!1,unlisted:!1,editUrl:"https://github.com/moonrepo/moon/tree/master/website/docs/run-task.mdx",tags:[],version:"current",frontMatter:{title:"Run a task"},sidebar:"docs",previous:{title:"Create a task",permalink:"/docs/create-task"},next:{title:"Migrate to moon",permalink:"/docs/migrate-to-moon"}},d={},u=[{value:"Running dependents",id:"running-dependents",level:2},{value:"Running based on affected files only",id:"running-based-on-affected-files-only",level:2},{value:"Using remote changes",id:"using-remote-changes",level:3},{value:"Filtering based on change status",id:"filtering-based-on-change-status",level:3},{value:"Passing arguments to the underlying command",id:"passing-arguments-to-the-underlying-command",level:2},{value:"Advanced run targeting",id:"advanced-run-targeting",level:2},{value:"Next steps",id:"next-steps",level:2}];function h(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.Z,{text:"2 min"}),"\n",(0,a.jsxs)(n.p,{children:["Even though we've ",(0,a.jsx)(n.a,{href:"./create-task",children:"created a task"}),", it's not useful unless we ",(0,a.jsx)(n.em,{children:"run it"}),", which is done\nwith the ",(0,a.jsx)(n.a,{href:"./commands/run",children:(0,a.jsx)(n.code,{children:"moon run <target>"})})," command. This command requires a single argument, a\n",(0,a.jsx)(n.a,{href:"./concepts/target",children:"primary target"}),", which is the pairing of a scope and task name. In the example\nbelow, our project is ",(0,a.jsx)(n.code,{children:"app"}),", the task is ",(0,a.jsx)(n.code,{children:"build"}),", and the target is ",(0,a.jsx)(n.code,{children:"app:build"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:'$ moon run app:build\n\n# In v1.14+, "run" can be omitted\n$ moon app:build\n'})}),"\n",(0,a.jsx)(n.p,{children:"When this command is ran, it will do the following:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Generate a directed acyclic graph, known as the action (dependency) graph."}),"\n",(0,a.jsxs)(n.li,{children:["Insert ",(0,a.jsx)(n.a,{href:"./config/project#deps",children:(0,a.jsx)(n.code,{children:"deps"})})," as targets into the graph."]}),"\n",(0,a.jsx)(n.li,{children:"Insert the primary target into the graph."}),"\n",(0,a.jsx)(n.li,{children:"Run all tasks in the graph in parallel and in topological order (the dependency chain)."}),"\n",(0,a.jsxs)(n.li,{children:["For each task, calculate ",(0,a.jsx)(n.a,{href:"./concepts/cache",children:"hashes"})," and either:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"On cache hit, exit early and return the last run."}),"\n",(0,a.jsx)(n.li,{children:"On cache miss, run the task and generate a new cache."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"running-dependents",children:"Running dependents"}),"\n",(0,a.jsxs)(n.p,{children:["moon will ",(0,a.jsx)(n.em,{children:"always"})," run upstream dependencies (",(0,a.jsx)(n.a,{href:"./config/project#deps",children:(0,a.jsx)(n.code,{children:"deps"})}),") before running the\nprimary target, as their outputs may be required for the primary target to function correctly."]}),"\n",(0,a.jsxs)(n.p,{children:["However, if you're working on a project that is shared and consumed by other projects, you may want\nto verify that downstream dependents have not been indirectly broken by any changes. This can be\nachieved by passing the ",(0,a.jsx)(n.code,{children:"--dependents"})," option, which will run dependent targets (of the same task\nname) ",(0,a.jsx)(n.em,{children:"after"})," the primary target."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"$ moon run app:build --dependents\n"})}),"\n",(0,a.jsx)(n.h2,{id:"running-based-on-affected-files-only",children:"Running based on affected files only"}),"\n",(0,a.jsxs)(n.p,{children:["By default ",(0,a.jsx)(n.a,{href:"./commands/run",children:(0,a.jsx)(n.code,{children:"moon run"})})," will ",(0,a.jsx)(n.em,{children:"always"})," run the target, regardless if files have\nactually changed. However, this is typically fine because of our\n",(0,a.jsx)(n.a,{href:"./concepts/cache",children:"smart hashing & cache layer"}),". With that being said, if you'd like to ",(0,a.jsx)(n.em,{children:"only"})," run a\ntarget if files have changed, pass the ",(0,a.jsx)(n.code,{children:"--affected"})," flag."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"$ moon run app:build --affected\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Under the hood, we extract locally touched (created, modified, staged, etc) files from your\nconfigured ",(0,a.jsx)(n.a,{href:"./config/workspace#vcs",children:"VCS"}),", and exit early if no files intersect with the task's\n",(0,a.jsx)(n.a,{href:"./config/project#inputs",children:"inputs"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"using-remote-changes",children:"Using remote changes"}),"\n",(0,a.jsxs)(n.p,{children:["If you'd like to determine affected files based on remote changes instead of local changes, pass the\n",(0,a.jsx)(n.code,{children:"--remote"})," flag. This will extract touched files by comparing the current ",(0,a.jsx)(n.code,{children:"HEAD"})," against the\n",(0,a.jsx)(n.a,{href:"./config/workspace#defaultbranch",children:(0,a.jsx)(n.code,{children:"vcs.defaultBranch"})}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"$ moon run app:build --affected --remote\n"})}),"\n",(0,a.jsx)(n.h3,{id:"filtering-based-on-change-status",children:"Filtering based on change status"}),"\n",(0,a.jsxs)(n.p,{children:["We can take this a step further by filtering down affected files based on a change status, using the\n",(0,a.jsx)(n.code,{children:"--status"})," option. This option accepts the following values: ",(0,a.jsx)(n.code,{children:"added"}),", ",(0,a.jsx)(n.code,{children:"deleted"}),", ",(0,a.jsx)(n.code,{children:"modified"}),",\n",(0,a.jsx)(n.code,{children:"staged"}),", ",(0,a.jsx)(n.code,{children:"unstaged"}),", ",(0,a.jsx)(n.code,{children:"untracked"}),". If not provided, the option defaults to all."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"$ moon run app:build --affected --status deleted\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Multiple status can be provided by passing the ",(0,a.jsx)(n.code,{children:"--status"})," option multiple times."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"$ moon run app:build --affected --status deleted --status modified\n"})}),"\n",(0,a.jsx)(n.h2,{id:"passing-arguments-to-the-underlying-command",children:"Passing arguments to the underlying command"}),"\n",(0,a.jsxs)(n.p,{children:["If you'd like to pass arbitrary arguments to the underlying task command, in addition to the already\ndefined ",(0,a.jsx)(n.a,{href:"./config/project#args",children:(0,a.jsx)(n.code,{children:"args"})}),", you can pass them after ",(0,a.jsx)(n.code,{children:"--"}),". These arguments are ",(0,a.jsx)(n.em,{children:"appended\nas-is"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"$ moon run app:build -- --force\n"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"--"})," delimiter and any arguments ",(0,a.jsx)(n.em,{children:"must"})," be defined last on the command line."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"advanced-run-targeting",children:"Advanced run targeting"}),"\n",(0,a.jsx)(n.p,{children:"By this point you should have a basic understanding of how to run tasks, but with moon, we want to\nprovide support for advanced workflows and development scenarios. For example, running a target in\nall projects:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"$ moon run :build\n"})}),"\n",(0,a.jsx)(n.p,{children:"Or perhaps running a target based on a query:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:'$ moon run :build --query "language=[javascript, typescript]"\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Jump to the official ",(0,a.jsxs)(n.a,{href:"./commands/run",children:[(0,a.jsx)(n.code,{children:"moon run"})," documentation"]})," for more examples!"]}),"\n",(0,a.jsx)(n.h2,{id:"next-steps",children:"Next steps"}),"\n",(0,a.jsx)(i.Z,{links:[{icon:"moon",label:"Migrate to moon",url:"./migrate-to-moon"},{icon:"task",label:"Learn about tasks",url:"./concepts/task"},{icon:"run-task",label:(0,a.jsxs)(a.Fragment,{children:["Learn about ",(0,a.jsx)(n.code,{children:"moon run"})]}),url:"./commands/run"}]})]})}function p(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},39798:(e,n,t)=>{t.d(n,{Z:()=>i});t(27378);var a=t(40624);const r={tabItem:"tabItem_wHwb"};var s=t(24246);function i(e){let{children:n,hidden:t,className:i}=e;return(0,s.jsx)("div",{role:"tabpanel",className:(0,a.Z)(r.tabItem,i),hidden:t,children:n})}},33337:(e,n,t)=>{t.d(n,{Z:()=>p});var a=t(27378),r=t(40624),s=t(83457),i=t(35595),l=t(76457);const o={tabList:"tabList_J5MA",tabItem:"tabItem_l0OV"};var c=t(24246);function d(e){let{className:n,block:t,selectedValue:a,selectValue:i,tabValues:l}=e;const d=[],{blockElementScrollPositionUntilNextRender:u}=(0,s.o5)(),h=e=>{const n=e.currentTarget,t=d.indexOf(n),r=l[t].value;r!==a&&(u(n),i(r))},p=e=>{let n=null;switch(e.key){case"Enter":h(e);break;case"ArrowRight":{const t=d.indexOf(e.currentTarget)+1;n=d[t]??d[0];break}case"ArrowLeft":{const t=d.indexOf(e.currentTarget)-1;n=d[t]??d[d.length-1];break}}n?.focus()};return(0,c.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":t},n),children:l.map((e=>{let{value:n,label:t,attributes:s}=e;return(0,c.jsx)("li",{role:"tab",tabIndex:a===n?0:-1,"aria-selected":a===n,ref:e=>d.push(e),onKeyDown:p,onClick:h,...s,className:(0,r.Z)("tabs__item",o.tabItem,s?.className,{"tabs__item--active":a===n}),children:t??n},n)}))})}function u(e){let{lazy:n,children:t,selectedValue:r}=e;const s=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=s.find((e=>e.props.value===r));return e?(0,a.cloneElement)(e,{className:"margin-top--md"}):null}return(0,c.jsx)("div",{className:"margin-top--md",children:s.map(((e,n)=>(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==r})))})}function h(e){const n=(0,i.Y)(e);return(0,c.jsxs)("div",{className:(0,r.Z)("tabs-container",o.tabList),children:[(0,c.jsx)(d,{...e,...n}),(0,c.jsx)(u,{...e,...n})]})}function p(e){const n=(0,l.Z)();return(0,c.jsx)(h,{...e,children:(0,i.h)(e.children)},String(n))}},35595:(e,n,t)=>{t.d(n,{Y:()=>p,h:()=>c});var a=t(27378),r=t(3620),s=t(9834),i=t(30654),l=t(70784),o=t(71819);function c(e){return a.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function d(e){const{values:n,children:t}=e;return(0,a.useMemo)((()=>{const e=n??function(e){return c(e).map((e=>{let{props:{value:n,label:t,attributes:a,default:r}}=e;return{value:n,label:t,attributes:a,default:r}}))}(t);return function(e){const n=(0,l.l)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function u(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function h(e){let{queryString:n=!1,groupId:t}=e;const s=(0,r.k6)(),l=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,i._X)(l),(0,a.useCallback)((e=>{if(!l)return;const n=new URLSearchParams(s.location.search);n.set(l,e),s.replace({...s.location,search:n.toString()})}),[l,s])]}function p(e){const{defaultValue:n,queryString:t=!1,groupId:r}=e,i=d(e),[l,c]=(0,a.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!u({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const a=t.find((e=>e.default))??t[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:n,tabValues:i}))),[p,g]=h({queryString:t,groupId:r}),[m,f]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[r,s]=(0,o.Nk)(t);return[r,(0,a.useCallback)((e=>{t&&s.set(e)}),[t,s])]}({groupId:r}),x=(()=>{const e=p??m;return u({value:e,tabValues:i})?e:null})();(0,s.Z)((()=>{x&&c(x)}),[x]);return{selectedValue:l,selectValue:(0,a.useCallback)((e=>{if(!u({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);c(e),g(e),f(e)}),[g,f,i]),tabValues:i}}},27915:(e,n,t)=>{t.d(n,{Z:()=>i});var a=t(83469),r=t(9619),s=t(24246);function i(e){let{text:n}=e;return(0,s.jsx)(r.Z,{text:n,icon:a.SZw,variant:"success",className:"absolute right-0 top-1.5"})}},9634:(e,n,t)=>{t.d(n,{Z:()=>d});var a=t(81884),r=t(9928),s=t(83469),i=t(31792),l=t(24246);const o={discord:r.omb,github:r.zhw,moon:s.Gp0,"new-project":s.g6h,"new-task":s.EQ8,project:s.pL1,"project-config":s.dhu,"project-config-global":s.YdP,"project-graph":s.Bkj,"run-task":s.sl_,task:s.diR,"task-config":s.o$R,token:s.BwA,toolchain:s.AlB,"toolchain-config":s.eDR,twitter:r.mdU,workspace:s.emM,"workspace-config":s.cRF};function c(e){let{name:n,...t}=e;return(0,l.jsx)(i.Z,{...t,icon:o[n]})}function d(e){let{links:n}=e;return(0,l.jsx)("div",{className:"grid grid-cols-1 gap-2 sm:grid-cols-2",children:n.map((e=>(0,l.jsx)(a.default,{href:e.url,className:"focus:outline-none",children:(0,l.jsxs)("div",{className:"relative rounded-lg px-3 py-3 flex items-center space-x-2 border-solid border border-t-0 border-b-2 bg-gray-50 hover:bg-gray-100/90 border-gray-200/75 dark:bg-slate-700 dark:hover:bg-slate-600 dark:border-slate-900/75",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)(c,{size:"lg",name:e.icon})}),(0,l.jsx)("div",{className:"flex-1 min-w-0 text-gray-900 dark:text-gray-100",children:e.label})]})},e.url)))})}},9619:(e,n,t)=>{t.d(n,{Z:()=>l});var a=t(40624),r=t(31792),s=t(24246);const i={failure:"bg-red-100 text-red-900",info:"bg-pink-100 text-pink-900",success:"bg-green-100 text-green-900",warning:"bg-orange-100 text-orange-900"};function l(e){let{className:n,icon:t,text:l,variant:o}=e;return(0,s.jsxs)("span",{className:(0,a.Z)("inline-flex items-center px-1 py-0.5 rounded text-xs font-bold uppercase",o?i[o]:"bg-gray-100 text-gray-800",n),children:[t&&(0,s.jsx)(r.Z,{icon:t,className:"mr-1"}),l]})}},71670:(e,n,t)=>{t.d(n,{Z:()=>l,a:()=>i});var a=t(27378);const r={},s=a.createContext(r);function i(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);