"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1622],{5318:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(7378);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=a.createContext({}),c=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(i.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,i=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(n),m=r,h=d["".concat(i,".").concat(m)]||d[m]||u[m]||l;return n?a.createElement(h,o(o({ref:t},p),{},{components:n})):a.createElement(h,o({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,o=new Array(l);o[0]=d;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var c=2;c<l;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},9798:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(7378),r=n(8944);const l="tabItem_wHwb";function o(e){let{children:t,hidden:n,className:o}=e;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(l,o),hidden:n},t)}},3337:(e,t,n)=>{n.d(t,{Z:()=>m});var a=n(5773),r=n(7378),l=n(8944),o=n(6457),s=n(784),i=n(9947),c=n(3457);const p="tabList_J5MA",u="tabItem_l0OV";function d(e){var t,n;const{lazy:o,block:d,defaultValue:m,values:h,groupId:g,className:f}=e,k=r.Children.map(e.children,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),b=null!=h?h:k.map((e=>{let{props:{value:t,label:n,attributes:a}}=e;return{value:t,label:n,attributes:a}})),y=(0,s.l)(b,((e,t)=>e.value===t.value));if(y.length>0)throw new Error('Docusaurus error: Duplicate values "'+y.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.');const v=null===m?m:null!=(t=null!=m?m:null==(n=k.find((e=>e.props.default)))?void 0:n.props.value)?t:k[0].props.value;if(null!==v&&!b.some((e=>e.value===v)))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+v+'" but none of its children has the corresponding value. Available values are: '+b.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");const{tabGroupChoices:N,setTabGroupChoices:w}=(0,i.U)(),[x,E]=(0,r.useState)(v),C=[],{blockElementScrollPositionUntilNextRender:O}=(0,c.o5)();if(null!=g){const e=N[g];null!=e&&e!==x&&b.some((t=>t.value===e))&&E(e)}const j=e=>{const t=e.currentTarget,n=C.indexOf(t),a=b[n].value;a!==x&&(O(t),E(a),null!=g&&w(g,String(a)))},T=e=>{var t;let n=null;switch(e.key){case"ArrowRight":{var a;const t=C.indexOf(e.currentTarget)+1;n=null!=(a=C[t])?a:C[0];break}case"ArrowLeft":{var r;const t=C.indexOf(e.currentTarget)-1;n=null!=(r=C[t])?r:C[C.length-1];break}}null==(t=n)||t.focus()};return r.createElement("div",{className:(0,l.Z)("tabs-container",p)},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":d},f)},b.map((e=>{let{value:t,label:n,attributes:o}=e;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:x===t?0:-1,"aria-selected":x===t,key:t,ref:e=>C.push(e),onKeyDown:T,onFocus:j,onClick:j},o,{className:(0,l.Z)("tabs__item",u,null==o?void 0:o.className,{"tabs__item--active":x===t})}),null!=n?n:t)}))),o?(0,r.cloneElement)(k.filter((e=>e.props.value===x))[0],{className:"margin-top--md"}):r.createElement("div",{className:"margin-top--md"},k.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==x})))))}function m(e){const t=(0,o.Z)();return r.createElement(d,(0,a.Z)({key:String(t)},e))}},7915:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(7378),r=n(3469),l=n(9619);function o(e){let{text:t}=e;return a.createElement(l.Z,{text:t,icon:r.SZw,variant:"success",className:"absolute right-0 top-1.5"})}},9634:(e,t,n)=>{n.d(t,{Z:()=>u});var a=n(7378),r=n(1884),l=n(5773),o=n(9928),s=n(3469),i=n(1792);const c={discord:o.omb,github:o.zhw,moon:s.Gp0,"new-project":s.g6h,"new-task":s.EQ8,project:s.pL1,"project-config":s.dhu,"project-config-global":s.YdP,"project-graph":s.Bkj,"run-task":s.sl_,task:s.diR,"task-config":s.o$R,token:s.BwA,toolchain:s.AlB,twitter:o.mdU,workspace:s.emM,"workspace-config":s.cRF};function p(e){let{name:t,...n}=e;return a.createElement(i.Z,(0,l.Z)({},n,{icon:c[t]}))}function u(e){let{links:t}=e;return a.createElement("div",{className:"grid grid-cols-1 gap-2 sm:grid-cols-2"},t.map((e=>a.createElement(r.default,{key:e.url,href:e.url,className:"focus:outline-none"},a.createElement("div",{className:"relative rounded-lg px-3 py-3 flex items-center space-x-2 border-solid border border-t-0 border-b-2 bg-gray-50 hover:bg-gray-100/90 border-gray-200/75 dark:bg-slate-700 dark:hover:bg-slate-600 dark:border-slate-900/75"},a.createElement("div",{className:"flex-shrink-0"},a.createElement(p,{size:"lg",name:e.icon})),a.createElement("div",{className:"flex-1 min-w-0 text-gray-900 dark:text-gray-100"},e.label))))))}},9619:(e,t,n)=>{n.d(t,{Z:()=>s});var a=n(7378),r=n(8944),l=n(1792);const o={failure:"bg-red-100 text-red-900",info:"bg-pink-100 text-pink-900",success:"bg-green-100 text-green-900",warning:"bg-orange-100 text-orange-900"};function s(e){let{className:t,icon:n,text:s,variant:i}=e;return a.createElement("span",{className:(0,r.Z)("inline-flex items-center px-1 py-0.5 rounded text-xs font-bold uppercase",i?o[i]:"bg-gray-100 text-gray-800",t)},n&&a.createElement(l.Z,{icon:n,className:"mr-1"}),s)}},4102:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>m,frontMatter:()=>s,metadata:()=>c,toc:()=>u});var a=n(5773),r=(n(7378),n(5318)),l=(n(3337),n(9798),n(7915)),o=n(9634);const s={title:"Run a task"},i=void 0,c={unversionedId:"run-task",id:"run-task",title:"Run a task",description:"Even though we've created a task, it's not useful unless we run it, which is done",source:"@site/docs/run-task.mdx",sourceDirName:".",slug:"/run-task",permalink:"/docs/run-task",draft:!1,editUrl:"https://github.com/moonrepo/moon/tree/master/website/docs/run-task.mdx",tags:[],version:"current",frontMatter:{title:"Run a task"},sidebar:"docs",previous:{title:"Create a task",permalink:"/docs/create-task"},next:{title:"Migrate to moon",permalink:"/docs/migrate-to-moon"}},p={},u=[{value:"Running dependents",id:"running-dependents",level:2},{value:"Running based on affected files only",id:"running-based-on-affected-files-only",level:2},{value:"Using upstream changes",id:"using-upstream-changes",level:3},{value:"Filtering based on change status",id:"filtering-based-on-change-status",level:3},{value:"Passing arguments to the underlying command",id:"passing-arguments-to-the-underlying-command",level:2},{value:"Next steps",id:"next-steps",level:2}],d={toc:u};function m(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)(l.Z,{text:"1 min",mdxType:"HeaderLabel"}),(0,r.kt)("p",null,"Even though we've ",(0,r.kt)("a",{parentName:"p",href:"./create-task"},"created a task"),", it's not useful unless we ",(0,r.kt)("em",{parentName:"p"},"run it"),", which is done\nwith the ",(0,r.kt)("a",{parentName:"p",href:"./commands/run"},(0,r.kt)("inlineCode",{parentName:"a"},"moon run <target>"))," command. This command requires a single argument, a\n",(0,r.kt)("a",{parentName:"p",href:"./concepts/target"},"primary target"),", which is the pairing of a project name and task name. In the\nexample below, our project is ",(0,r.kt)("inlineCode",{parentName:"p"},"app"),", the task is ",(0,r.kt)("inlineCode",{parentName:"p"},"typecheck"),", and the target is ",(0,r.kt)("inlineCode",{parentName:"p"},"app:typecheck"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"$ moon run app:typecheck\n")),(0,r.kt)("p",null,"When this command is ran, it will do the following:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Generate a directed acyclic graph, known as the dependency graph."),(0,r.kt)("li",{parentName:"ul"},"Insert ",(0,r.kt)("a",{parentName:"li",href:"./config/project#deps"},(0,r.kt)("inlineCode",{parentName:"a"},"deps"))," as targets into the graph."),(0,r.kt)("li",{parentName:"ul"},"Insert the primary target into the graph."),(0,r.kt)("li",{parentName:"ul"},"Run all tasks in the graph in parallel and in topological order (the dependency chain)."),(0,r.kt)("li",{parentName:"ul"},"For each task, calculate ",(0,r.kt)("a",{parentName:"li",href:"./concepts/cache"},"hashes")," and either:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"On cache hit, exit early and return the last run."),(0,r.kt)("li",{parentName:"ul"},"On cache miss, run the task and generate a new cache.")))),(0,r.kt)("h2",{id:"running-dependents"},"Running dependents"),(0,r.kt)("p",null,"moon will ",(0,r.kt)("em",{parentName:"p"},"always")," run upstream dependencies (",(0,r.kt)("a",{parentName:"p",href:"./config/project#deps"},(0,r.kt)("inlineCode",{parentName:"a"},"deps")),") before running the\nprimary target, as their outputs may be required for the primary target to function correctly."),(0,r.kt)("p",null,"However, if you're working on a project that is shared and consumed by other projects, you may want\nto verify that downstream dependents have not been indirectly broken by any changes. This can be\nachieved by passing the ",(0,r.kt)("inlineCode",{parentName:"p"},"--dependents")," option, which will run dependent targets (of the same task\nname) ",(0,r.kt)("em",{parentName:"p"},"after")," the primary target."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"$ moon run app:typecheck --dependents\n")),(0,r.kt)("h2",{id:"running-based-on-affected-files-only"},"Running based on affected files only"),(0,r.kt)("p",null,"By default ",(0,r.kt)("a",{parentName:"p",href:"./commands/run"},(0,r.kt)("inlineCode",{parentName:"a"},"moon run"))," will ",(0,r.kt)("em",{parentName:"p"},"always")," run the target, regardless if files have\nactually changed. However, this is typically fine because of our\n",(0,r.kt)("a",{parentName:"p",href:"./concepts/cache"},"smart hashing & cache layer"),". With that being said, if you'd like to ",(0,r.kt)("em",{parentName:"p"},"only")," run a\ntarget if files have changed, pass the ",(0,r.kt)("inlineCode",{parentName:"p"},"--affected")," flag."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"$ moon run app:typecheck --affected\n")),(0,r.kt)("p",null,"Under the hood, we extract locally touched (created, modified, staged, etc) files from your\nconfigured ",(0,r.kt)("a",{parentName:"p",href:"./config/workspace#vcs"},"VCS"),", and exit early if no files intersect with the task's\n",(0,r.kt)("a",{parentName:"p",href:"./config/project#inputs"},"inputs"),"."),(0,r.kt)("h3",{id:"using-upstream-changes"},"Using upstream changes"),(0,r.kt)("p",null,"If you'd like to determine affected files based on upstream changes instead of local changes, pass\nthe ",(0,r.kt)("inlineCode",{parentName:"p"},"--upstream")," flag. This will extract touched files by comparing the current ",(0,r.kt)("inlineCode",{parentName:"p"},"HEAD")," against the\n",(0,r.kt)("a",{parentName:"p",href:"./config/workspace#defaultbranch"},(0,r.kt)("inlineCode",{parentName:"a"},"vcs.defaultBranch")),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"$ moon run app:typecheck --affected --upstream\n")),(0,r.kt)("h3",{id:"filtering-based-on-change-status"},"Filtering based on change status"),(0,r.kt)("p",null,"We can take this a step further by filtering down affected files based on a change status, using the\n",(0,r.kt)("inlineCode",{parentName:"p"},"--status")," option. This option accepts the following values: ",(0,r.kt)("inlineCode",{parentName:"p"},"added"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"deleted"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"modified"),",\n",(0,r.kt)("inlineCode",{parentName:"p"},"staged"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"unstaged"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"untracked"),". If not provided, the option defaults to all."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"$ moon run app:typecheck --affected --status deleted\n")),(0,r.kt)("h2",{id:"passing-arguments-to-the-underlying-command"},"Passing arguments to the underlying command"),(0,r.kt)("p",null,"If you'd like to pass arbitrary arguments to the underlying task command, in addition to the already\ndefined ",(0,r.kt)("a",{parentName:"p",href:"./config/project#args"},(0,r.kt)("inlineCode",{parentName:"a"},"args")),", you can pass them after ",(0,r.kt)("inlineCode",{parentName:"p"},"--"),". These arguments are ",(0,r.kt)("em",{parentName:"p"},"appended\nas-is"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"$ moon run app:typecheck -- --force\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"--")," delimiter and any arguments ",(0,r.kt)("em",{parentName:"p"},"must")," be defined last on the command line.")),(0,r.kt)("h2",{id:"next-steps"},"Next steps"),(0,r.kt)(o.Z,{links:[{icon:"moon",label:"Migrate to moon",url:"./migrate-to-moon"},{icon:"task",label:"Learn about tasks",url:"./concepts/task"}],mdxType:"NextSteps"}))}m.isMDXComponent=!0}}]);