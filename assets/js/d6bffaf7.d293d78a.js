"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[17947],{15857:(e,n,o)=>{o.d(n,{A:()=>a});const a=o.p+"assets/images/v1.40-58b521085a5bdb8ae952921d7977d457.png"},20394:e=>{e.exports=JSON.parse('{"permalink":"/blog/moon-v1.40","editUrl":"https://github.com/moonrepo/moon/tree/master/website/blog/2025-09-01_moon-v1.40.mdx","source":"@site/blog/2025-09-01_moon-v1.40.mdx","title":"moon v1.40 - JavaScript ecosystem WASM toolchains and more","description":"It\'s been a while since our last release, as we\'ve been busy working on new JavaScript ecosystem","date":"2025-09-01T00:00:00.000Z","tags":[{"inline":true,"label":"toolchain","permalink":"/blog/tags/toolchain"},{"inline":true,"label":"wasm","permalink":"/blog/tags/wasm"},{"inline":true,"label":"javascript","permalink":"/blog/tags/javascript"},{"inline":true,"label":"bun","permalink":"/blog/tags/bun"},{"inline":true,"label":"node","permalink":"/blog/tags/node"},{"inline":true,"label":"npm","permalink":"/blog/tags/npm"},{"inline":true,"label":"pnpm","permalink":"/blog/tags/pnpm"},{"inline":true,"label":"yarn","permalink":"/blog/tags/yarn"}],"readingTime":6.8,"hasTruncateMarker":true,"authors":[{"name":"Miles Johnson","title":"Founder, developer","url":"https://github.com/milesj","imageURL":"/img/authors/miles.jpg","key":"milesj","page":null}],"frontMatter":{"slug":"moon-v1.40","title":"moon v1.40 - JavaScript ecosystem WASM toolchains and more","authors":["milesj"],"tags":["toolchain","wasm","javascript","bun","node","npm","pnpm","yarn"],"image":"./img/moon/v1.40.png"},"unlisted":false,"prevItem":{"title":"proto v0.53 - New exec command and backend configuration","permalink":"/blog/proto-v0.53"},"nextItem":{"title":"proto v0.52 - Custom backend plugins","permalink":"/blog/proto-v0.52"}}')},34043:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>r,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>a,toc:()=>c});var a=o(20394),s=o(62540),i=o(43023);const t={slug:"moon-v1.40",title:"moon v1.40 - JavaScript ecosystem WASM toolchains and more",authors:["milesj"],tags:["toolchain","wasm","javascript","bun","node","npm","pnpm","yarn"],image:"./img/moon/v1.40.png"},l=void 0,r={image:o(15857).A,authorsImageUrls:[void 0]},c=[{value:"New JavaScript ecosystem toolchains powered by WASM",id:"new-javascript-ecosystem-toolchains-powered-by-wasm",level:2},{value:"Shared core: <code>unstable_javascript</code>",id:"shared-core-unstable_javascript",level:3},{value:"Runtimes: <code>unstable_bun</code> and <code>unstable_node</code>",id:"runtimes-unstable_bun-and-unstable_node",level:3},{value:"Package managers: <code>unstable_npm</code>, <code>unstable_pnpm</code>, and <code>unstable_yarn</code>",id:"package-managers-unstable_npm-unstable_pnpm-and-unstable_yarn",level:3},{value:"Migrating from legacy toolchains",id:"migrating-from-legacy-toolchains",level:3},{value:"Backwards incompatibility and caveats",id:"backwards-incompatibility-and-caveats",level:3},{value:"New task caching options",id:"new-task-caching-options",level:2},{value:"New local read-only mode for remote cache",id:"new-local-read-only-mode-for-remote-cache",level:2},{value:"Other changes",id:"other-changes",level:2},{value:"What&#39;s next?",id:"whats-next",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"It's been a while since our last release, as we've been busy working on new JavaScript ecosystem\nWASM toolchains, which are now available!"}),"\n",(0,s.jsx)(n.h2,{id:"new-javascript-ecosystem-toolchains-powered-by-wasm",children:"New JavaScript ecosystem toolchains powered by WASM"}),"\n",(0,s.jsx)(n.p,{children:"Porting the legacy Bun and Node.js toolchains to WASM has been a non-trivial amount of work, as the\nJavaScript ecosystem is quite convoluted compared to other languages. The paradigms required by\nJavaScript simply don't exist in other languages, and as such, we've had to build custom\nfunctionality into our toolchain plugin system to support it properly."}),"\n",(0,s.jsxs)(n.p,{children:["On top of that, Bun and Node.js share ",(0,s.jsx)(n.em,{children:"a lot"})," of functionality, and if you've been using both legacy\ntoolchains in parallel, you may have noticed a handful of issues because of this, such as\noverlapping dependency installs, conflicting alias/task extraction, or over-reading of\n",(0,s.jsx)(n.code,{children:"package.json"})," files. Additionally, this doesn't even take Deno into account, which has its own set\nof problems to solve for interoperability."]}),"\n",(0,s.jsx)(n.p,{children:"To solve these problems, we've reimagined how JavaScript toolchains work in moon with the following\ngoals in mind:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Share as much functionality across Node, Bun, and Deno without duplication."}),"\n",(0,s.jsx)(n.li,{children:"Support any number of runtimes and package managers with clean interoperability."}),"\n",(0,s.jsx)(n.li,{children:"Allow each runtime and package manager to implement their own tier 1-3 features."}),"\n",(0,s.jsx)(n.li,{children:"Minimize the complexity of the toolchain configurations."}),"\n",(0,s.jsx)(n.li,{children:"Allow users to depend on these toolchains if necessary."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"And the result of this rework is 6 new toolchains! Continue reading for more details."}),"\n",(0,s.jsxs)(n.h3,{id:"shared-core-unstable_javascript",children:["Shared core: ",(0,s.jsx)(n.code,{children:"unstable_javascript"})]}),"\n",(0,s.jsxs)(n.p,{children:["A new JavaScript toolchain has been introduced, called ",(0,s.jsx)(n.code,{children:"unstable_javascript"}),". This toolchain serves\nas the foundation for all other JavaScript-related toolchains, providing a shared core of\nfunctionality and settings. It implements ",(0,s.jsx)(n.a,{href:"/docs/how-it-works/languages",children:"tier 1 and tier 2"})," features, and is in charge of\nthe following:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Defines which package manager (and runtime) to use."}),"\n",(0,s.jsxs)(n.li,{children:["Extends projects and tasks with ",(0,s.jsx)(n.code,{children:"package.json"})," and ",(0,s.jsx)(n.code,{children:"node_modules"})," information."]}),"\n",(0,s.jsxs)(n.li,{children:["Locates the dependencies root (",(0,s.jsx)(n.code,{children:"package.json"})," workspaces)."]}),"\n",(0,s.jsx)(n.li,{children:"Installs and dedupes dependencies for the defined package manager."}),"\n",(0,s.jsx)(n.li,{children:"Parses manifests and lockfiles for relevant information."}),"\n",(0,s.jsx)(n.li,{children:"Handles project and workspace syncing operations."}),"\n",(0,s.jsx)(n.li,{children:"And anything else that is shared across the JavaScript ecosystem."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title=".moon/toolchain.yml"',children:"unstable_javascript:\n  packageManager: 'yarn'\n  inferTasksFromScripts: false\n  syncPackageManagerField: true\n  syncProjectWorkspaceDependencies: true\n"})}),"\n",(0,s.jsx)(n.p,{children:"If you're familar with the legacy Bun or Node.js toolchains, this should feel very familiar, as this\nis a combination of their functionality. Learn more about its settings:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/config/toolchain#unstable_javascript",children:(0,s.jsx)(n.code,{children:"unstable_javascript"})})}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"runtimes-unstable_bun-and-unstable_node",children:["Runtimes: ",(0,s.jsx)(n.code,{children:"unstable_bun"})," and ",(0,s.jsx)(n.code,{children:"unstable_node"})]}),"\n",(0,s.jsxs)(n.p,{children:["JavaScript is a unique language in that it has multiple runtimes, primarily Node.js, Bun, and Deno.\nWe support Node.js through the new ",(0,s.jsx)(n.code,{children:"unstable_node"})," toolchain, and Bun through the ",(0,s.jsx)(n.code,{children:"unstable_bun"}),"\ntoolchain, with Deno support coming soon. These toolchains only implement ",(0,s.jsx)(n.a,{href:"/docs/how-it-works/languages",children:"tier 1 and tier 3"}),"\nfeatures, as tier 2 is handled by the core ",(0,s.jsx)(n.code,{children:"unstable_javascript"})," toolchain."]}),"\n",(0,s.jsxs)(n.p,{children:["Their primary role is to provide settings for runtime execution (task child processes), and for\ndownloading and installing the runtime tool into the proto toolchain (when the ",(0,s.jsx)(n.code,{children:"version"})," setting is\ndefined)."]}),"\n",(0,s.jsxs)(n.p,{children:["The runtime that will be utilized in the action graph is defined by the new\n",(0,s.jsx)(n.code,{children:"unstable_javascript.packageManager"})," setting (bun = bun, npm/pnpm/yarn = node), but that doesn't\nstop you from using multiple runtimes in parallel."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title=".moon/toolchain.yml"',children:"unstable_node:\n  version: '24.0.0'\n  executeArgs: ['--preserve-symlinks']\n"})}),"\n",(0,s.jsx)(n.p,{children:"Learn more about their settings:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/config/toolchain#unstable_bun",children:(0,s.jsx)(n.code,{children:"unstable_bun"})})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/config/toolchain#unstable_node",children:(0,s.jsx)(n.code,{children:"unstable_node"})})}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"package-managers-unstable_npm-unstable_pnpm-and-unstable_yarn",children:["Package managers: ",(0,s.jsx)(n.code,{children:"unstable_npm"}),", ",(0,s.jsx)(n.code,{children:"unstable_pnpm"}),", and ",(0,s.jsx)(n.code,{children:"unstable_yarn"})]}),"\n",(0,s.jsxs)(n.p,{children:["All JavaScript package managers (including Bun) are now their own toolchain, with their own\nconfiguration, and are ",(0,s.jsx)(n.em,{children:"no longer"})," nested within the Node.js toolchain. These toolchains only\nimplement ",(0,s.jsx)(n.a,{href:"/docs/how-it-works/languages",children:"tier 1 and tier 3"})," features, as tier 2 is handled by the core\n",(0,s.jsx)(n.code,{children:"unstable_javascript"})," toolchain."]}),"\n",(0,s.jsxs)(n.p,{children:["Their primary role is to provide settings for the ",(0,s.jsx)(n.code,{children:"unstable_javascript"})," toolchain when installing\nand syncing dependencies, and for downloading and installing the package manager tool into the proto\ntoolchain (when the ",(0,s.jsx)(n.code,{children:"version"})," setting is defined)."]}),"\n",(0,s.jsxs)(n.p,{children:["Since there are multiple package managers, which do you need to configure? Only the one associated\nwith the new ",(0,s.jsx)(n.code,{children:"unstable_javascript.packageManager"})," setting!"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title=".moon/toolchain.yml"',children:"unstable_pnpm:\n  version: '10.15.0'\n  installArgs: ['--frozen-lockfile']\n"})}),"\n",(0,s.jsx)(n.p,{children:"Learn more about their settings:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/config/toolchain#unstable_bun",children:(0,s.jsx)(n.code,{children:"unstable_bun"})})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/config/toolchain#unstable_npm",children:(0,s.jsx)(n.code,{children:"unstable_npm"})})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/config/toolchain#unstable_pnpm",children:(0,s.jsx)(n.code,{children:"unstable_pnpm"})})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/config/toolchain#unstable_yarn",children:(0,s.jsx)(n.code,{children:"unstable_yarn"})})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"migrating-from-legacy-toolchains",children:"Migrating from legacy toolchains"}),"\n",(0,s.jsx)(n.p,{children:"Migrating from the legacy toolchains to these new modern WASM toolchains is rather straightforward,\nas most of the existing settings have been ported over. Follow these steps:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Move the ",(0,s.jsx)(n.code,{children:"node.npm"}),", ",(0,s.jsx)(n.code,{children:"node.pnpm"}),", and ",(0,s.jsx)(n.code,{children:"node.yarn"})," configuration to its own top-level ",(0,s.jsx)(n.code,{children:"unstable_"}),"\ntoolchain."]}),"\n",(0,s.jsxs)(n.li,{children:["Move the ",(0,s.jsx)(n.code,{children:"bun.version"})," or ",(0,s.jsx)(n.code,{children:"node.version"})," setting to an ",(0,s.jsx)(n.code,{children:"unstable_bun"})," or ",(0,s.jsx)(n.code,{children:"unstable_node"})," toolchain\nrespectively. If not using ",(0,s.jsx)(n.code,{children:"version"}),", set an empty object."]}),"\n",(0,s.jsxs)(n.li,{children:["Remove the ",(0,s.jsx)(n.code,{children:"node.addEnginesConstraint"})," setting."]}),"\n",(0,s.jsxs)(n.li,{children:["Rename the ",(0,s.jsx)(n.code,{children:"node"})," or ",(0,s.jsx)(n.code,{children:"bun"})," toolchain to ",(0,s.jsx)(n.code,{children:"unstable_javascript"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Rename the ",(0,s.jsx)(n.code,{children:"node.binExecArgs"})," setting to ",(0,s.jsx)(n.code,{children:"unstable_node.executeArgs"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Rename the ",(0,s.jsx)(n.code,{children:"node.rootPackageOnly"})," setting to ",(0,s.jsx)(n.code,{children:"unstable_javascript.rootPackageDependenciesOnly"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"As an example, here's a before and after of our repository."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title=".moon/toolchain.yml"',children:"# Before\nnode:\n  version: '22.14.0'\n  packageManager: 'yarn'\n  yarn:\n    version: '4.8.0'\n  inferTasksFromScripts: false\n  syncPackageManagerField: true\n  syncProjectWorkspaceDependencies: true\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title=".moon/toolchain.yml"',children:"# After\nunstable_javascript:\n  packageManager: 'yarn'\n  inferTasksFromScripts: false\n  syncPackageManagerField: true\n  syncProjectWorkspaceDependencies: true\n\nunstable_node:\n  version: '22.14.0'\n\nunstable_yarn:\n  version: '4.8.0'\n"})}),"\n",(0,s.jsx)(n.h3,{id:"backwards-incompatibility-and-caveats",children:"Backwards incompatibility and caveats"}),"\n",(0,s.jsx)(n.p,{children:"Because these new toolchains are built around a plugin system, and not hard-coded into core like the\nlegacy toolchains, there are some backwards incompatibilities, changes, and caveats to be aware of:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Because the old ",(0,s.jsx)(n.code,{children:"node"}),"/",(0,s.jsx)(n.code,{children:"bun"})," toolchains are now spread across multiple new toolchains, instead of\n1 toolchain, any configuration of the task ",(0,s.jsxs)(n.a,{href:"/docs/config/project#toolchain",children:[(0,s.jsx)(n.code,{children:"toolchain"})," setting"]}),"\nmay now be inaccurate, as this setting ",(0,s.jsx)(n.em,{children:"overrides"})," all detected/inherited toolchains. We suggest\nomitting this field unless you want full control and understand what you are doing."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"# Invalid\ntasks:\n  build:\n    # ...\n    toolchain: 'node'\n\n# Valid\ntasks:\n  build:\n    # ...\n    toolchain: ['unstable_javascript', 'unstable_node', 'unstable_npm']\n    # Or simply\n    toolchain: ['javascript', 'node', 'npm']\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsxs)(n.li,{children:["Additionally, task inheritance ",(0,s.jsx)(n.em,{children:"may"})," not function the same, based on what toolchains are now\nautomatically detected. Ensure that projects and tasks inherit the correct toolchains by\nutilizing ",(0,s.jsx)(n.a,{href:"/docs/commands/project",children:(0,s.jsx)(n.code,{children:"moon project"})})," and ",(0,s.jsx)(n.a,{href:"/docs/commands/task",children:(0,s.jsx)(n.code,{children:"moon task"})}),"\ncommands."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"If either of these issues, or other unexpected issues arise, please report it so we can fix it, or\nprovide a work around!"}),"\n",(0,s.jsx)(n.h2,{id:"new-task-caching-options",children:"New task caching options"}),"\n",(0,s.jsxs)(n.p,{children:["Tasks have always supported a ",(0,s.jsxs)(n.a,{href:"/docs/config/project#cache",children:[(0,s.jsx)(n.code,{children:"cache"})," option"]})," for toggling caching on\nand off. With the introduction of remote cache, we're expanding these options to provide more\nflexibility and control. Instead of supporting only a simple boolean flag, we're introducing new\n",(0,s.jsx)(n.code,{children:"local"})," and ",(0,s.jsx)(n.code,{children:"remote"})," values, which will only cache locally or remotely, respectively."]}),"\n",(0,s.jsx)(n.p,{children:"This is useful for tasks that need caching, but should not persist in the remote cache, and vice\nversa."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"tasks:\n  build:\n    # ...\n    options:\n      cache: 'local'\n"})}),"\n",(0,s.jsx)(n.h2,{id:"new-local-read-only-mode-for-remote-cache",children:"New local read-only mode for remote cache"}),"\n",(0,s.jsxs)(n.p,{children:["Adoption of our new ",(0,s.jsx)(n.a,{href:"/docs/guides/remote-cache",children:"remote cache"})," solution has been going great, and\nwe've heard positive feedback from users about its performance and reliability. However, it's not\nperfect and can always be improved!"]}),"\n",(0,s.jsxs)(n.p,{children:["And as such, we're introducing a new\n",(0,s.jsx)(n.a,{href:"/docs/config/workspace#localreadonly",children:(0,s.jsx)(n.code,{children:"unstable_remote.cache.localReadOnly"})})," setting, which will\nonly read (download) outputs from the remote cache when in local development, but will ",(0,s.jsx)(n.em,{children:"not"})," write\n(upload) outputs. This is useful for teams that want to share cache between CI and local, but don't\nwant the overhead of uploading in-development outputs."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title=".moon/workspace.yml"',children:"unstable_remote:\n  cache:\n    localReadOnly: true\n"})}),"\n",(0,s.jsx)(n.h2,{id:"other-changes",children:"Other changes"}),"\n",(0,s.jsxs)(n.p,{children:["View the ",(0,s.jsx)(n.a,{href:"https://github.com/moonrepo/moon/releases/tag/v1.40.0",children:"official release"})," for a full list\nof changes."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Updated ",(0,s.jsx)(n.code,{children:"moon query touched-files"})," to default to comparing against remote branches when in CI, and\nlocal when not in CI. This aligns with the other ",(0,s.jsx)(n.code,{children:"moon query"})," commands."]}),"\n",(0,s.jsxs)(n.li,{children:["Updated task commands (child processes) to utilize toolchain executables directly, instead of\nrelying entirely on proto shims. It achieves this by locating the executables, and prepending\ntheir directory onto ",(0,s.jsx)(n.code,{children:"PATH"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["When running a task, we now set a ",(0,s.jsx)(n.code,{children:"MOON_TASK_HASH"})," environment variable for the current hash,\nwhich can be read from child processes."]}),"\n",(0,s.jsxs)(n.li,{children:["Published the moon VSCode extension to Open VSX:\n",(0,s.jsx)(n.a,{href:"https://open-vsx.org/extension/moonrepo/moon-console",children:"https://open-vsx.org/extension/moonrepo/moon-console"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"whats-next",children:"What's next?"}),"\n",(0,s.jsx)(n.p,{children:"With toolchains plugins being stabilized more, we'd like to focus on some other areas."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Implement more of the task inputs RFC: ",(0,s.jsx)(n.a,{href:"https://github.com/moonrepo/moon/issues/1985",children:"https://github.com/moonrepo/moon/issues/1985"})]}),"\n",(0,s.jsxs)(n.li,{children:["Investigate a new ",(0,s.jsx)(n.code,{children:"unstable_deno"})," toolchain"]}),"\n",(0,s.jsxs)(n.li,{children:["Investigate better task inheritance: ",(0,s.jsx)(n.a,{href:"https://github.com/moonrepo/moon/issues/2023",children:"https://github.com/moonrepo/moon/issues/2023"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},43023:(e,n,o)=>{o.d(n,{R:()=>t,x:()=>l});var a=o(63696);const s={},i=a.createContext(s);function t(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);