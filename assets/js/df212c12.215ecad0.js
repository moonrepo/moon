"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[94938],{6212:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>c,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"concepts/task-inheritance","title":"Task inheritance","description":"Unlike other task runners that require the same tasks to be repeatedly defined for every project,","source":"@site/docs/concepts/task-inheritance.mdx","sourceDirName":"concepts","slug":"/concepts/task-inheritance","permalink":"/docs/concepts/task-inheritance","draft":false,"unlisted":false,"editUrl":"https://github.com/moonrepo/moon/tree/master/website/docs/concepts/task-inheritance.mdx","tags":[],"version":"current","frontMatter":{"title":"Task inheritance"},"sidebar":"docs","previous":{"title":"Tasks","permalink":"/docs/concepts/task"},"next":{"title":"Tokens","permalink":"/docs/concepts/token"}}');var t=s(62540),i=s(43023),o=s(15868);const c={title:"Task inheritance"},a=void 0,l={},d=[{value:"Conditional inheritance",id:"conditional-inheritance",level:2},{value:"Clauses",id:"clauses",level:3},{value:"Merge strategies",id:"merge-strategies",level:2}];function h(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["Unlike other task runners that require the same tasks to be repeatedly defined for ",(0,t.jsx)(n.em,{children:"every"})," project,\nmoon uses an inheritance model where tasks can be defined once at the workspace-level, and are then\ninherited by ",(0,t.jsx)(n.em,{children:"many or all"})," projects."]}),"\n",(0,t.jsxs)(n.p,{children:["Workspace-level tasks (also known as global tasks) are defined in ",(0,t.jsx)(n.a,{href:"../config/tasks",children:(0,t.jsx)(n.code,{children:".moon/tasks/**/*"})}),", and\nare inherited by based on conditions. However, projects are able to include, exclude, or rename\ninherited tasks using the ",(0,t.jsx)(n.a,{href:"../config/project#inheritedtasks",children:(0,t.jsx)(n.code,{children:"workspace.inheritedTasks"})})," in\n",(0,t.jsx)(n.a,{href:"../config/project",children:(0,t.jsx)(n.code,{children:"moon.*"})}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"conditional-inheritance",children:"Conditional inheritance"}),"\n",(0,t.jsxs)(n.p,{children:["Task inheritance is powered by the ",(0,t.jsx)(n.a,{href:"../config/tasks#inheritedby",children:(0,t.jsx)(n.code,{children:"inheritedBy"})})," setting in global\ntask configurations (those in ",(0,t.jsx)(n.a,{href:"../config/tasks",children:(0,t.jsx)(n.code,{children:".moon/tasks/**/*"})}),"). This setting defines conditions that a\nproject must meet in order for inheritance to occur. If the setting is not defined, or no conditions\nare defined, the configuration is inherited by ",(0,t.jsx)(n.em,{children:"all"})," projects."]}),"\n",(0,t.jsx)(n.p,{children:"The following conditions are supported:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"file"}),", ",(0,t.jsx)(n.code,{children:"files"})," - Inherit for projects that contain specific files (does not support globs)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"language"}),", ",(0,t.jsx)(n.code,{children:"languages"})," - Inherit for projects that belong to specific\n",(0,t.jsx)(n.a,{href:"../config/project#language",children:(0,t.jsx)(n.code,{children:"language"})}),"s."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"layer"}),", ",(0,t.jsx)(n.code,{children:"layers"})," - Inherit for projects that belong to specific\n",(0,t.jsx)(n.a,{href:"../config/project#layer",children:(0,t.jsx)(n.code,{children:"layer"})}),"s."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"stack"}),", ",(0,t.jsx)(n.code,{children:"stacks"})," - Inherit for projects that belong to specific\n",(0,t.jsx)(n.a,{href:"../config/project#stack",children:(0,t.jsx)(n.code,{children:"stack"})}),"s."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"tag"}),", ",(0,t.jsx)(n.code,{children:"tags"})," - Inherit for projects that have specific ",(0,t.jsx)(n.a,{href:"../config/project#tags",children:(0,t.jsx)(n.code,{children:"tags"})}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"toolchain"}),", ",(0,t.jsx)(n.code,{children:"toolchains"})," - Inherit for projects that belong to specific\n",(0,t.jsx)(n.a,{href:"../config/project#toolchains",children:(0,t.jsx)(n.code,{children:"toolchains"})}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"One or many conditions can be defined, and all conditions must be met for inheritance to occur. For\nexample, the following configuration will only be inherited by Node.js frontend libraries."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title=".moon/tasks/node-frontend-library.yml"',children:"inheritedBy:\n  toolchain: 'node'\n  stack: 'frontend'\n  layer: 'library'\n"})}),"\n",(0,t.jsx)(n.p,{children:"Each condition supports a single value or an array of values. For example, the previous example\ncould be rewritten to inherit for both Node.js or Deno frontend libraries."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title=".moon/tasks/js-frontend-library.yml"',children:"inheritedBy:\n  toolchains: ['node', 'deno']\n  stack: 'frontend'\n  layer: 'library'\n"})}),"\n",(0,t.jsx)(n.h3,{id:"clauses",children:"Clauses"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"tags"})," and ",(0,t.jsx)(n.code,{children:"toolchains"})," conditions support special clauses ",(0,t.jsx)(n.code,{children:"and"}),", ",(0,t.jsx)(n.code,{children:"or"})," (the default), and ",(0,t.jsx)(n.code,{children:"not"}),"\nfor matching more complex scenarios."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"inheritedBy:\n  toolchains:\n    or: ['javascript', 'typescript']\n    not: ['ruby']\n  layer: 'library'\n"})}),"\n",(0,t.jsx)(n.h2,{id:"merge-strategies",children:"Merge strategies"}),"\n",(0,t.jsxs)(n.p,{children:["When a ",(0,t.jsx)(n.a,{href:"../config/tasks#tasks",children:"global task"})," and ",(0,t.jsx)(n.a,{href:"../config/project#tasks",children:"local task"})," of the same\nname exist, they are merged into a single task. To accomplish this, one of many\n",(0,t.jsx)(n.a,{href:"../config/project#options",children:"merge strategies"})," can be used."]}),"\n",(0,t.jsxs)(n.p,{children:["Merging is applied to the parameters ",(0,t.jsx)(n.a,{href:"../config/project#args",children:(0,t.jsx)(n.code,{children:"args"})}),",\n",(0,t.jsx)(n.a,{href:"../config/project#deps",children:(0,t.jsx)(n.code,{children:"deps"})}),", ",(0,t.jsx)(n.a,{href:"../config/project#env-1",children:(0,t.jsx)(n.code,{children:"env"})}),",\n",(0,t.jsx)(n.a,{href:"../config/project#inputs",children:(0,t.jsx)(n.code,{children:"inputs"})}),", ",(0,t.jsx)(n.a,{href:"../config/project#outputs",children:(0,t.jsx)(n.code,{children:"outputs"})}),", and\n",(0,t.jsx)(n.a,{href:"../config/project#toolchains",children:(0,t.jsx)(n.code,{children:"toolchains"})}),", using the ",(0,t.jsx)(n.a,{href:"../config/project#merge",children:(0,t.jsx)(n.code,{children:"merge"})}),",\n",(0,t.jsx)(n.a,{href:"../config/project#mergeargs",children:(0,t.jsx)(n.code,{children:"mergeArgs"})}),", ",(0,t.jsx)(n.a,{href:"../config/project#mergedeps",children:(0,t.jsx)(n.code,{children:"mergeDeps"})}),",\n",(0,t.jsx)(n.a,{href:"../config/project#mergeenv",children:(0,t.jsx)(n.code,{children:"mergeEnv"})}),", ",(0,t.jsx)(n.a,{href:"../config/project#mergeinputs",children:(0,t.jsx)(n.code,{children:"mergeInputs"})}),",\n",(0,t.jsx)(n.a,{href:"../config/project#mergeoutputs",children:(0,t.jsx)(n.code,{children:"mergeOutputs"})})," and\n",(0,t.jsx)(n.a,{href:"../config/project#mergetoolchains",children:(0,t.jsx)(n.code,{children:"mergeToolchains"})})," options respectively. Each of these options\nsupport one of the following strategy values."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"append"})," (default) - Values found in the local task are merged ",(0,t.jsx)(n.em,{children:"after"})," the values found in the\nglobal task. For example, this strategy is useful for toggling flag arguments."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"prepend"})," - Values found in the local task are merged ",(0,t.jsx)(n.em,{children:"before"})," the values found in the global\ntask. For example, this strategy is useful for applying option arguments that must come before\npositional arguments."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"preserve"})," - Preserve the original global task values. This should rarely be used, but exists for\nsituations where an inheritance chain is super long and complex, but we simply want to the base\nvalues. ",(0,t.jsx)(o.A,{version:"1.29.0"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"replace"})," - Values found in the local task entirely ",(0,t.jsx)(n.em,{children:"replaces"})," the values in the global task. This\nstrategy is useful when you need full control."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"All 3 of these strategies are demonstrated below, with a somewhat contrived example, but you get the\npoint."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# Global\ntasks:\n  build:\n    command:\n      - 'webpack'\n      - '--mode'\n      - 'production'\n      - '--color'\n    deps:\n      - 'designSystem:build'\n    inputs:\n      - '/webpack.config.js'\n    outputs:\n      - 'build/'\n\n# Local\ntasks:\n  build:\n    args: '--no-color --no-stats'\n    deps:\n      - 'reactHooks:build'\n    inputs:\n      - 'webpack.config.js'\n    options:\n      mergeArgs: 'append'\n      mergeDeps: 'prepend'\n      mergeInputs: 'replace'\n\n# Merged result\ntasks:\n  build:\n    command:\n      - 'webpack'\n      - '--mode'\n      - 'production'\n      - '--color'\n      - '--no-color'\n      - '--no-stats'\n    deps:\n      - 'reactHooks:build'\n      - 'designSystem:build'\n    inputs:\n      - 'webpack.config.js'\n    outputs:\n      - 'build/'\n    options:\n      mergeArgs: 'append'\n      mergeDeps: 'prepend'\n      mergeInputs: 'replace'\n"})})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},15868:(e,n,s)=>{s.d(n,{A:()=>i});var r=s(65162),t=s(62540);function i({header:e,inline:n,updated:s,version:i}){return(0,t.jsx)(r.A,{text:`v${i}`,variant:s?"success":"info",className:e?"absolute right-0 top-1.5":n?"inline-block ml-1":"ml-2"})}},43023:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>c});var r=s(63696);const t={},i=r.createContext(t);function o(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(i.Provider,{value:n},e.children)}},65162:(e,n,s)=>{s.d(n,{A:()=>c});var r=s(11750),t=s(74599),i=s(62540);const o={failure:"bg-red-100 text-red-900",info:"bg-pink-100 text-pink-900",success:"bg-green-100 text-green-900",warning:"bg-orange-100 text-orange-900"};function c({className:e,icon:n,text:s,variant:c}){return(0,i.jsxs)("span",{className:(0,r.A)("inline-flex items-center px-1 py-0.5 rounded text-xs font-bold uppercase",c?o[c]:"bg-gray-100 text-gray-800",e),children:[n&&(0,i.jsx)(t.A,{icon:n,className:"mr-1"}),s]})}}}]);