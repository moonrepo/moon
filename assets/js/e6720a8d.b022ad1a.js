"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[65880],{18979:(e,o,t)=>{t.d(o,{A:()=>n});const n=t.p+"assets/images/v0.51-c22de34d33ef9ddc2665d79f45f6f3b7.png"},36659:e=>{e.exports=JSON.parse('{"permalink":"/blog/proto-v0.51","editUrl":"https://github.com/moonrepo/moon/tree/master/website/blog/2025-07-17_proto-v0.51.mdx","source":"@site/blog/2025-07-17_proto-v0.51.mdx","title":"proto v0.51 - Unstable lockfiles and plugin registries","description":"With this release, we\'re excited to introduce two major features that pave the way for proto\'s","date":"2025-07-17T00:00:00.000Z","tags":[{"inline":true,"label":"lockfile","permalink":"/blog/tags/lockfile"},{"inline":true,"label":"record","permalink":"/blog/tags/record"},{"inline":true,"label":"registry","permalink":"/blog/tags/registry"},{"inline":true,"label":"oci","permalink":"/blog/tags/oci"},{"inline":true,"label":"plugin","permalink":"/blog/tags/plugin"},{"inline":true,"label":"locator","permalink":"/blog/tags/locator"}],"readingTime":4.5,"hasTruncateMarker":true,"authors":[{"name":"Miles Johnson","title":"Founder, developer","url":"https://github.com/milesj","imageURL":"/img/authors/miles.jpg","key":"milesj","page":null}],"frontMatter":{"slug":"proto-v0.51","title":"proto v0.51 - Unstable lockfiles and plugin registries","authors":["milesj"],"tags":["lockfile","record","registry","oci","plugin","locator"],"image":"./img/proto/v0.51.png"},"unlisted":false,"prevItem":{"title":"moon v1.39 - Improved task inputs, better proto integration, and project layers","permalink":"/blog/moon-v1.39"},"nextItem":{"title":"moon v1.38 - Go WASM toolchain, MCP tools, terminal notifications, and more!","permalink":"/blog/moon-v1.38"}}')},43023:(e,o,t)=>{t.d(o,{R:()=>s,x:()=>l});var n=t(63696);const i={},r=n.createContext(i);function s(e){const o=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function l(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),n.createElement(r.Provider,{value:o},e.children)}},83198:(e,o,t)=>{t.r(o),t.d(o,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>n,toc:()=>c});var n=t(36659),i=t(62540),r=t(43023);const s={slug:"proto-v0.51",title:"proto v0.51 - Unstable lockfiles and plugin registries",authors:["milesj"],tags:["lockfile","record","registry","oci","plugin","locator"],image:"./img/proto/v0.51.png"},l=void 0,a={image:t(18979).A,authorsImageUrls:[void 0]},c=[{value:"Unstable lockfile support",id:"unstable-lockfile-support",level:2},{value:"Updated workflows",id:"updated-workflows",level:3},{value:"Still a work in progress",id:"still-a-work-in-progress",level:3},{value:"Unstable OCI registries for plugin storage",id:"unstable-oci-registries-for-plugin-storage",level:2},{value:"How it works",id:"how-it-works",level:3},{value:"Official registry?",id:"official-registry",level:3},{value:"Other changes",id:"other-changes",level:2},{value:"Looking for contributors",id:"looking-for-contributors",level:2}];function d(e){const o={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.p,{children:"With this release, we're excited to introduce two major features that pave the way for proto's\nfuture!"}),"\n",(0,i.jsx)(o.h2,{id:"unstable-lockfile-support",children:"Unstable lockfile support"}),"\n",(0,i.jsx)(o.p,{children:"Lockfiles have been requested by the community since proto's inception, but adopting them has been a\nnon-trivial task, as it requires touching almost every aspect of proto. With that said, we've been\nslowly reworking the internals to support lockfiles, and with this release, we're introducing\nunstable support for them!"}),"\n",(0,i.jsx)(o.p,{children:"If you're unaware of what lockfiles are, they allow you to pin the exact version (and checksum) of a\ntool that is installed, ensuring that your development environment is consistent and reproducible.\nIf you've used package managers like npm, Cargo, or uv, you're likely familiar with this concept."}),"\n",(0,i.jsxs)(o.p,{children:["In proto, the concept of lockfiles is mostly the same, but the manner in which they are created and\nupdated may differ based on other tools. To start, lockfiles in proto are ",(0,i.jsx)(o.em,{children:"opt-in"})," and can be\nenabled with the new ",(0,i.jsx)(o.a,{href:"/docs/proto/config#unstable-lockfile",children:(0,i.jsx)(o.code,{children:"settings.unstable-lockfile"})})," setting in\n",(0,i.jsx)(o.code,{children:".prototools"}),"."]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-toml",metastring:'title=".prototools"',children:"[settings]\nunstable-lockfile = true\n"})}),"\n",(0,i.jsxs)(o.p,{children:["This will create a ",(0,i.jsx)(o.code,{children:".protolock"})," file in the current directory, relative to the ",(0,i.jsx)(o.code,{children:".prototools"})," file.\nIn effect, this locks that directory and all of its subdirectories. As a side-effect, nested\nlockfiles are not supported."]}),"\n",(0,i.jsxs)(o.p,{children:["To demonstrate how lockfiles work, installing the following tools with ",(0,i.jsx)(o.code,{children:"proto install"}),"..."]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-toml",metastring:'title=".prototools"',children:'bun = "1.2.0"\ndeno = "2.4.0"\nnode = "22.17.0"\n\n[settings]\nunstable-lockfile = true\n'})}),"\n",(0,i.jsxs)(o.p,{children:["... would generate the following ",(0,i.jsx)(o.code,{children:".protolock"})," file:"]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-toml",metastring:'title=".protolock"',children:'# Generated by proto. Do not modify!\n\n[[tools.bun]]\nspec = "1.2.0"\nversion = "1.2.0"\nchecksum = "sha256:fa72173cb2220d00e2d2650fefdc0b5b37bfd8bb33d8d671b50efb409c2f5745"\n\n[[tools.deno]]\nspec = "2.4.0"\nversion = "2.4.0"\nchecksum = "sha256:c913d018d64c48dcc5b7b90d844efb6d017595a7c1e237f89141df1b3ef8b962"\n\n[[tools.node]]\nspec = "22.17.0"\nversion = "22.17.0"\nchecksum = "sha256:cc9cc294eaf782dd93c8c51f460da610cc35753c6a9947411731524d16e97914"\n'})}),"\n",(0,i.jsx)(o.h3,{id:"updated-workflows",children:"Updated workflows"}),"\n",(0,i.jsxs)(o.p,{children:["The ",(0,i.jsx)(o.a,{href:"/docs/proto/commands/run",children:(0,i.jsx)(o.code,{children:"proto run"})})," (shims),\n",(0,i.jsx)(o.a,{href:"/docs/proto/commands/install",children:(0,i.jsx)(o.code,{children:"proto install"})}),", and\n",(0,i.jsx)(o.a,{href:"/docs/proto/commands/uninstall",children:(0,i.jsx)(o.code,{children:"proto uninstall"})})," commands have been updated to support lockfiles."]}),"\n",(0,i.jsxs)(o.p,{children:["When running or installing tools and a matching specification exists in the lockfile, the locked\nversion will be inherited even if there's a newer version upstream, and the tool's checksum will be\nvalidated when available. These checks can be bypassed with the new ",(0,i.jsx)(o.code,{children:"--update-lockfile"})," flag\n(install only)."]}),"\n",(0,i.jsx)(o.p,{children:"Inversely, when uninstalling tools, the lockfile will be updated to remove any matching\nspecification records."}),"\n",(0,i.jsx)(o.h3,{id:"still-a-work-in-progress",children:"Still a work in progress"}),"\n",(0,i.jsxs)(o.p,{children:["We are marking lockfiles as unstable as they have not been fully implemented or thoroughly tested.\nThere are other commands like ",(0,i.jsx)(o.a,{href:"/docs/proto/commands/outdated",children:(0,i.jsx)(o.code,{children:"proto outdated"})})," and\n",(0,i.jsx)(o.a,{href:"/docs/proto/commands/status",children:(0,i.jsx)(o.code,{children:"proto status"})})," that are not lockfile aware yet, but will be in the\nfuture."]}),"\n",(0,i.jsx)(o.p,{children:"But please, give them a whirl and let us know what you think!"}),"\n",(0,i.jsx)(o.h2,{id:"unstable-oci-registries-for-plugin-storage",children:"Unstable OCI registries for plugin storage"}),"\n",(0,i.jsxs)(o.p,{children:["Another important feature that is necessary for proto's success is support for an official plugin\nregistry. Before we get to that, we need to lay the groundwork for how plugins are stored and\ndistributed. With this release, we're introducing unstable support for\n",(0,i.jsx)(o.a,{href:"https://opencontainers.org/",children:"OCI registries"})," as a storage mechanism for plugins. If you're\nunfamiliar with OCI registries, they are a standard for storing and distributing container images\n(Docker), but can also be used to store other types of\n",(0,i.jsx)(o.a,{href:"https://oras.land/docs/concepts/artifact",children:"artifacts"}),", in this case, WASM plugins."]}),"\n",(0,i.jsxs)(o.p,{children:["To support registries, we have introduced a new\n",(0,i.jsx)(o.a,{href:"/docs/proto/config#unstable-registries",children:(0,i.jsx)(o.code,{children:"settings.unstable-registries"})})," setting in ",(0,i.jsx)(o.code,{children:".prototools"}),",\nwhich allows you to configure a list of registries to query for applicable plugins. For example:"]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-toml",metastring:'title=".prototools"',children:'[settings]\nunstable-registries = [\n  { registry: "ghcr.io", namespace: "moonrepo" }\n]\n'})}),"\n",(0,i.jsxs)(o.p,{children:["Additionally, we are introducing a new ",(0,i.jsx)(o.code,{children:"registry://"})," plugin locator, which allows you to configure a\nplugin by its OCI reference."]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-toml",metastring:'title=".prototools"',children:'[plugins]\n# Longform with tag\nbun = "registry://ghcr.io/moonrepo/bun_tool:v1.2.3"\n# Longform without tag\nbun = "registry://ghcr.io/moonrepo/bun_tool"\n# Shortform with tag\nbun = "registry://bun_tool:v1.2.3"\n# Shortform without tag\nbun = "registry://bun_tool"\n'})}),"\n",(0,i.jsx)(o.h3,{id:"how-it-works",children:"How it works"}),"\n",(0,i.jsx)(o.p,{children:"Using a container registry to store plugins seems odd at first, but it actually allows us to\nleverage existing specifications, infrastructure, and tools to manage and distribute plugins. We\ndon't want to re-invent the wheel here, so why not use something that most of the industry is\nalready using?"}),"\n",(0,i.jsxs)(o.p,{children:["With that said, how does this work in proto? Since we are not a container image, we use the\n",(0,i.jsx)(o.a,{href:"https://oras.land/docs/concepts/artifact",children:"artifact portion of the specification"})," instead.\nPrimarily, plugins are stored in layers! The blob/content of WASM, TOML, JSON, and YAML plugins are\nstored in CAS, and referenced in layers by a sha256 digest."]}),"\n",(0,i.jsxs)(o.p,{children:["As for annotations, we support the\n",(0,i.jsx)(o.a,{href:"https://github.com/opencontainers/image-spec/blob/main/annotations.md",children:"OCI standard annotations"}),",\nbut will also support moonrepo-specific annotations in the future."]}),"\n",(0,i.jsx)(o.admonition,{type:"info",children:(0,i.jsx)(o.p,{children:"At this time, we do not provide a mechanism for uploading plugins to a registry. You'll need to do\nthat manually."})}),"\n",(0,i.jsx)(o.h3,{id:"official-registry",children:"Official registry?"}),"\n",(0,i.jsx)(o.p,{children:"We do have plans to support an official moonrepo plugin registry, for both proto and moon. We are in\nthe process of investigating solutions to this and will provide more details soon."}),"\n",(0,i.jsx)(o.h2,{id:"other-changes",children:"Other changes"}),"\n",(0,i.jsxs)(o.p,{children:["View the ",(0,i.jsx)(o.a,{href:"https://github.com/moonrepo/proto/releases/tag/v0.51.0",children:"official release"})," for a full list\nof changes."]}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["Removed ",(0,i.jsx)(o.code,{children:"--canary"})," from ",(0,i.jsx)(o.code,{children:"proto install"}),", just use ",(0,i.jsx)(o.code,{children:"canary"})," as the version specifier instead."]}),"\n"]}),"\n",(0,i.jsx)(o.h2,{id:"looking-for-contributors",children:"Looking for contributors"}),"\n",(0,i.jsx)(o.p,{children:"We have a lot of cool stuff planned for proto, like backend plugins, more official tools, improved\nworkflows, an official registry, and more! So if you're interested in Rust or WASM, we would love\nand appreciate your help. Feel free to ping us on Discord!"})]})}function h(e={}){const{wrapper:o}={...(0,r.R)(),...e.components};return o?(0,i.jsx)(o,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);