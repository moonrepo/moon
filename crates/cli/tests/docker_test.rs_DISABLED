use moon_app::commands::docker::DockerManifest;
use moon_common::Id;
use moon_test_utils::{create_sandbox_with_config, get_projects_fixture_configs};
use rustc_hash::FxHashSet;
use starbase_utils::json;
use std::{fs, path::Path};


#[cfg(windows)]
mod prune {
    use super::*;

    #[test]
    fn errors_missing_manifest() {
        let (workspace_config, toolchain_config, tasks_config) = get_node_fixture_configs();

        let sandbox = create_sandbox_with_config(
            "node",
            Some(workspace_config),
            Some(toolchain_config),
            Some(tasks_config),
        );

        let assert = sandbox.run_moon(|cmd| {
            cmd.arg("docker").arg("prune");
        });

        assert!(
            predicate::str::contains("Unable to continue, docker manifest missing.")
                .eval(&assert.output())
        );
    }
}

#[cfg(windows)]
mod setup {
    use super::*;

    #[test]
    fn errors_missing_manifest() {
        let (workspace_config, toolchain_config, tasks_config) = get_node_fixture_configs();

        let sandbox = create_sandbox_with_config(
            "node",
            Some(workspace_config),
            Some(toolchain_config),
            Some(tasks_config),
        );

        let assert = sandbox.run_moon(|cmd| {
            cmd.arg("docker").arg("setup");
        });

        assert!(
            predicate::str::contains("Unable to continue, docker manifest missing.")
                .eval(&assert.output())
        );
    }
}
