<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-proto/wasm-plugin">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">WASM plugin | moonrepo</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://moonrepo.dev/docs/proto/wasm-plugin"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="moon, repo, moonrepo, task, runner, build, system, ci, times, devx, developer, experience, tooling, tools, monorepo, polyrepo, productivity, platform, proto, toolchain"><meta data-rh="true" name="og:image" content="https://moonrepo.dev/img/hero/slate-bg.jpg"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="WASM plugin | moonrepo"><meta data-rh="true" name="description" content="Plugins can be written in WebAssembly (WASM), a portable binary format."><meta data-rh="true" property="og:description" content="Plugins can be written in WebAssembly (WASM), a portable binary format."><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://moonrepo.dev/docs/proto/wasm-plugin"><link data-rh="true" rel="alternate" href="https://moonrepo.dev/docs/proto/wasm-plugin" hreflang="en"><link data-rh="true" rel="alternate" href="https://moonrepo.dev/docs/proto/wasm-plugin" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://400S075OEM-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="moonrepo RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="moonrepo Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LB233GTZD3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-LB233GTZD3",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="moonrepo" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.13722164.css">
<link rel="preload" href="/assets/js/runtime~main.bf8956cd.js" as="script">
<link rel="preload" href="/assets/js/main.6c6bb799.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_oPtH" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="moon" class="themedImage_BQGR themedImage--light_HAxW"><img src="/img/logo.svg" alt="moon" class="themedImage_BQGR themedImage--dark_bGx0"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Products</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/moon"><strong class="block mr-2">moon</strong><div class="opacity-60">System for managing codebases</div></a></li><li><a class="dropdown__link" href="/moonbase"><strong class="block mr-2">moonbase</strong><div class="opacity-60">Service for scaling CI pipelines</div></a></li><li><a class="dropdown__link" href="/proto"><strong class="block mr-2">proto</strong><div class="opacity-60">Multi-language toolchain manager</div></a></li><li><a href="https://espresso.build" target="_blank" rel="noopener noreferrer" class="dropdown__link"><strong class="block mr-2">espresso</strong><div class="opacity-60">Next-gen JavaScript package system</div></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs"><strong>moon</strong></a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/proto"><strong>proto</strong></a></li></ul></div><a class="navbar__item navbar__link" href="/docs/guides/ci">Guides</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a href="https://github.com/moonrepo" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a></div><div class="navbar__items navbar__items--right"><a href="https://moonrepo.app" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Sign in</a><div class="toggle_ki11 colorModeToggle_Hewu"><button class="clean-btn toggleButton_MMFG toggleButtonDisabled_Uw7m" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_lgto"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_U96C"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_WqAV"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_MB5r docsWrapper_ct1J"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_iEvu" type="button"></button><div class="docPage_KLoz"><aside class="theme-doc-sidebar-container docSidebarContainer_y0RQ"><div class="sidebarViewport_EJ1r"><div class="sidebar_CUen"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_jmj1"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/proto">What is proto?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/proto/install">Install proto</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/proto/detection">Version detection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/proto/config">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/proto/tools">Supported tools</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/proto/plugins">Plugins</a><button aria-label="Toggle the collapsible sidebar category &#x27;Plugins&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/proto/toml-plugin">TOML</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/proto/wasm-plugin">WASM</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/proto/commands/add-plugin">Commands</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/proto/faq">FAQ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://github.com/moonrepo/proto/releases" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_BiEj">Changelog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPrP"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></nav></div></div></aside><main class="docMainContainer_sTIZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_Qr34"><div class="docItemContainer_tjFy"><article><span class="float-right ml-2"></span><nav class="flex pl-1 mb-2" aria-label="Breadcrumb"><ol role="list" class="list-none p-0 m-0 flex items-center space-x-2" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li><a class="cursor-pointer text-base text-gray-700 hover:text-gray-800 dark:text-gray-600 dark:hover:text-gray-500 font-normal" href="/"><span class="inline-block flex-shrink-0" aria-hidden="true"><svg aria-hidden="true" focusable="false" data-prefix="far" data-icon="house-blank" class="svg-inline--fa fa-house-blank" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M303.5 5.7c-9-7.6-22.1-7.6-31.1 0l-264 224c-10.1 8.6-11.3 23.7-2.8 33.8s23.7 11.3 33.8 2.8L64 245.5V432c0 44.2 35.8 80 80 80H432c44.2 0 80-35.8 80-80V245.5l24.5 20.8c10.1 8.6 25.3 7.3 33.8-2.8s7.3-25.3-2.8-33.8l-264-224zM464 204.8V432c0 17.7-14.3 32-32 32H144c-17.7 0-32-14.3-32-32V204.8L288 55.5 464 204.8z"></path></svg></span><span class="sr-only">Home</span></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem"><div class="flex items-center"><span class="inline-block flex-shrink-0 text-gray-600 mr-2" aria-hidden="true"><svg aria-hidden="true" focusable="false" data-prefix="far" data-icon="angle-right" class="svg-inline--fa fa-angle-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M273 239c9.4 9.4 9.4 24.6 0 33.9L113 433c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l143-143L79 113c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0L273 239z"></path></svg></span><a class="cursor-pointer text-sm text-gray-700 hover:text-gray-800 dark:text-gray-600 dark:hover:text-gray-500 font-medium" itemprop="item" href="/docs/proto/plugins"><span itemprop="name">Plugins</span></a><meta itemprop="position" content="1"></div></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem"><div class="flex items-center"><span class="inline-block flex-shrink-0 text-gray-600 mr-2" aria-hidden="true"><svg aria-hidden="true" focusable="false" data-prefix="far" data-icon="angle-right" class="svg-inline--fa fa-angle-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M273 239c9.4 9.4 9.4 24.6 0 33.9L113 433c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l143-143L79 113c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0L273 239z"></path></svg></span><a class="cursor-pointer text-sm text-gray-700 hover:text-gray-800 dark:text-gray-600 dark:hover:text-gray-500 font-medium" aria-current="page" itemprop="item" href="/docs/proto/wasm-plugin"><span itemprop="name">WASM</span></a><meta itemprop="position" content="2"></div></li></ol></nav><div class="tocCollapsible_wXna theme-doc-toc-mobile tocMobile_Ojys"><button type="button" class="clean-btn tocCollapsibleButton_iI2p">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>WASM plugin</h1></header><p>Plugins can be written in <a href="https://webassembly.org/" target="_blank" rel="noopener noreferrer">WebAssembly (WASM)</a>, a portable binary format.
This means that plugins can be written in any language that compiles to WASM, like Rust, C, C++, Go,
TypeScript, and more. Because WASM based plugins are powered by a programming language, they
implicitly support complex business logic and behavior, have access to a sandboxed file system (via
WASI), can execute child processes, and much more.</p><div class="theme-admonition theme-admonition-danger alert alert--danger admonition_uH4V"><div class="admonitionHeading_P5_N"><span class="admonitionIcon_MF44"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_yySL"><p>Since our WASM plugin implementation is still experimental, expect breaking changes to occur in
non-major releases.</p></div></div><h2 class="anchor anchorWithStickyNavbar_JmGV" id="concepts">Concepts<a href="#concepts" class="hash-link" aria-label="Direct link to Concepts" title="Direct link to Concepts">​</a></h2><p>Before we begin, let&#x27;s talk about a few concepts that are critical to WASM and our plugin system.</p><h3 class="anchor anchorWithStickyNavbar_JmGV" id="virtual-paths">Virtual paths<a href="#virtual-paths" class="hash-link" aria-label="Direct link to Virtual paths" title="Direct link to Virtual paths">​</a></h3><p>WASM by default does not have access to the host file system, but through <a href="https://wasi.dev/" target="_blank" rel="noopener noreferrer">WASI</a>,
we can provide sandboxed access to a pre-defined list of allowed directories. We call this
<a href="https://docs.rs/proto_pdk/latest/proto_pdk/enum.VirtualPath.html" target="_blank" rel="noopener noreferrer">virtual paths</a>, and all paths
provided via function input or context use them.</p><p>Virtual paths are implemented by mapping a real path (host machine) to a virtual path (guest
runtime) using file path prefixes. The following prefixes are currently supported:</p><table><thead><tr><th>Real path</th><th>Virtual path</th></tr></thead><tbody><tr><td><code>~</code></td><td><code>/home</code></td></tr><tr><td><code>~/.proto</code></td><td><code>/proto</code></td></tr><tr><td>CWD</td><td><code>/workspace</code></td></tr></tbody></table><p>For example, from the context of WASM, you may have a virtual path of <code>/proto/tools/node/1.2.3</code>,
which simply maps back to <code>~/.proto/tools/node/1.2.3</code> on the host machine. However, this should
almost always be transparent to you, the developer, and to end users.</p><p>However, there may be a few cases where you need access to the real path from WASM, for example,
logging or executing commands. For this, the real path can be accessed with the
<a href="https://docs.rs/proto_pdk/latest/proto_pdk/enum.VirtualPath.html#method.real_path" target="_blank" rel="noopener noreferrer"><code>real_path</code></a>
function on the <code>VirtualPath</code> enum (this is a Rust only feature).</p><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token plain">input</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">tool_dir</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">real_path</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_JmGV" id="host-environment">Host environment<a href="#host-environment" class="hash-link" aria-label="Direct link to Host environment" title="Direct link to Host environment">​</a></h3><p>Since WASM executes in its own runtime, it <em>does not</em> have access to the current host operating
system, architecture, so on and so forth. To bridge this gap, we provide the
<a href="https://docs.rs/proto_pdk/latest/proto_pdk/fn.get_proto_environment.html" target="_blank" rel="noopener noreferrer"><code>get_proto_environment</code></a>
function.
<a href="https://docs.rs/proto_pdk/latest/proto_pdk/struct.HostEnvironment.html" target="_blank" rel="noopener noreferrer">Learn more about this type</a>.</p><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token keyword" style="color:#b7a9f9">let</span><span class="token plain"> env </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> </span><span class="token function" style="color:#ff94ff;font-weight:bold">get_proto_environment</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token operator" style="color:#b7a9f9">?</span><span class="token punctuation" style="color:#cad4e2">;</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The host operating system and architecture can be accessed with <code>os</code> and <code>arch</code> fields respectively.
Both fields are an enum in Rust, or a string in other languages.</p><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token keyword" style="color:#b7a9f9">if</span><span class="token plain"> env</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">os </span><span class="token operator" style="color:#b7a9f9">==</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HostOS</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Windows</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token comment" style="color:#97a1af;font-style:italic">// Windows only</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token keyword" style="color:#b7a9f9">if</span><span class="token plain"> env</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">arch </span><span class="token operator" style="color:#b7a9f9">==</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HostArch</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Arm64</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token comment" style="color:#97a1af;font-style:italic">// aarch64 only</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">}</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Furthermore, the user&#x27;s home directory (<code>~</code>) and proto&#x27;s root directory (<code>~/.proto</code>) can be accessed
with the <code>home_dir</code> and <code>proto_dir</code> fields, both of which are <a href="#virtual-paths">virtual paths</a>.</p><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token keyword" style="color:#b7a9f9">if</span><span class="token plain"> env</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">home_dir</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">join</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">some_path</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">exists</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token comment" style="color:#97a1af;font-style:italic">// Do something</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">}</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_JmGV" id="host-functions">Host functions<a href="#host-functions" class="hash-link" aria-label="Direct link to Host functions" title="Direct link to Host functions">​</a></h3><p>WASM is pretty powerful but it can&#x27;t do everything since it&#x27;s sandboxed. To work around this, we
provide a mechanism known as host functions, which are functions that are implemented on the host
(in Rust), and can be executed from WASM. The following host functions are currently available:</p><ul><li><a href="https://docs.rs/proto_pdk/latest/proto_pdk/macro.exec_command.html" target="_blank" rel="noopener noreferrer"><code>exec_command</code></a> - Execute a
system command on the host machine, with a provided list of arguments or environment variables.</li><li><a href="https://docs.rs/proto_pdk/latest/proto_pdk/macro.host_log.html" target="_blank" rel="noopener noreferrer"><code>host_log</code></a> - Log a message to
the host&#x27;s stderr. This acts like tracing logs, and is not a general purpose stdout logger.</li></ul><p>To use host functions, you&#x27;ll need to make them available by registering them at the top of your
Rust file (only add the functions you want to use).</p><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token attribute attr-name" style="color:#fde047">#[host_fn]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token keyword" style="color:#b7a9f9">extern</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;ExtismHost&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token keyword" style="color:#b7a9f9">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#ff94ff;font-weight:bold">exec_command</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">input</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">ExecCommandInput</span><span class="token operator" style="color:#b7a9f9">&gt;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">ExecCommandOutput</span><span class="token operator" style="color:#b7a9f9">&gt;</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token keyword" style="color:#b7a9f9">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#ff94ff;font-weight:bold">host_log</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">input</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HostLogInput</span><span class="token operator" style="color:#b7a9f9">&gt;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">}</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And then calling the provided <code>exec_command!</code> or <code>host_log!</code> macros. Each macro supports shorthand
variants, and an explicit variant that accepts the input struct.</p><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token macro property" style="color:#b7a9f9">exec_command!</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;which&quot;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">[</span><span class="token string" style="color:#c9e166">&quot;node&quot;</span><span class="token punctuation" style="color:#cad4e2">]</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token macro property" style="color:#b7a9f9">exec_command!</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">pipe</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;npm&quot;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">[</span><span class="token string" style="color:#c9e166">&quot;install&quot;</span><span class="token punctuation" style="color:#cad4e2">]</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"> </span><span class="token comment" style="color:#97a1af;font-style:italic">// Pipe stdout/stderr</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token macro property" style="color:#b7a9f9">exec_command!</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">inherit</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;npm&quot;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">[</span><span class="token string" style="color:#c9e166">&quot;install&quot;</span><span class="token punctuation" style="color:#cad4e2">]</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"> </span><span class="token comment" style="color:#97a1af;font-style:italic">// Inherit stdout/stderr</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token macro property" style="color:#b7a9f9">exec_command!</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">ExecCommandInput</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    command</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;npm&quot;</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">into</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    args</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token macro property" style="color:#b7a9f9">vec!</span><span class="token punctuation" style="color:#cad4e2">[</span><span class="token string" style="color:#c9e166">&quot;install&quot;</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">into</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">]</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    env_vars</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HashMap</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token function" style="color:#ff94ff;font-weight:bold">new</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    stream</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token boolean" style="color:#94dded">false</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token macro property" style="color:#b7a9f9">host_log!</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;Some message&quot;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token macro property" style="color:#b7a9f9">host_log!</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;Some message with {}&quot;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;args&quot;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token macro property" style="color:#b7a9f9">host_log!</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HostLogInput</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Fields</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    message</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;Some message with data&quot;</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">into</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    data</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HashMap</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token function" style="color:#ff94ff;font-weight:bold">from_iter</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;data&quot;</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">into</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token namespace" style="color:#b7a9f9">serde_json</span><span class="token namespace punctuation" style="color:#cad4e2">::</span><span class="token function" style="color:#ff94ff;font-weight:bold">to_value</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token operator" style="color:#b7a9f9">?</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token punctuation" style="color:#cad4e2">]</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_JmGV" id="tool-id-and-context">Tool ID and context<a href="#tool-id-and-context" class="hash-link" aria-label="Direct link to Tool ID and context" title="Direct link to Tool ID and context">​</a></h3><p>When implementing plugin functions, you&#x27;ll need to access information about the current tool. To get
the current tool ID (the key the plugin was configured with), use the
<a href="https://docs.rs/proto_pdk/latest/proto_pdk/fn.get_tool_id.html" target="_blank" rel="noopener noreferrer"><code>get_tool_id</code></a> function.</p><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token keyword" style="color:#b7a9f9">let</span><span class="token plain"> id </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> </span><span class="token function" style="color:#ff94ff;font-weight:bold">get_tool_id</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Additionally, we also provide what we call the tool context, which is information that is constantly
changing depending on the current step or state of proto&#x27;s execution. The context cannot be accessed
with a stand-alone function, and is instead passed as a <code>context</code> field in the input of many plugin
functions.</p><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token attribute attr-name" style="color:#fde047">#[plugin_fn]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token keyword" style="color:#b7a9f9">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#ff94ff;font-weight:bold">download_prebuilt</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">input</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">DownloadPrebuiltInput</span><span class="token operator" style="color:#b7a9f9">&gt;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">FnResult</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">DownloadPrebuiltOutput</span><span class="token operator" style="color:#b7a9f9">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token keyword" style="color:#b7a9f9">let</span><span class="token plain"> version </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> input</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">context</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">version</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token comment" style="color:#97a1af;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">}</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The following fields are available on the
<a href="https://docs.rs/proto_pdk/latest/proto_pdk/struct.ToolContext.html" target="_blank" rel="noopener noreferrer">context object</a>:</p><ul><li><code>env_vars</code> - A map of environment variables requested by the
<a href="#registering-metadata"><code>register_tool</code></a> function.</li><li><code>tool_dir</code> - A virtual path to the tool&#x27;s directory for the current version.</li><li><code>version</code> - The current version or alias. If not resolved, will be &quot;latest&quot;.</li></ul><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_uH4V"><div class="admonitionHeading_P5_N"><span class="admonitionIcon_MF44"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_yySL"><p>The <code>version</code> field is either a fully-qualified semantic version (1.2.3), an alias (&quot;latest&quot;,
&quot;stable&quot;), or canary (&quot;canary&quot;). Be sure to account for all these variations when implementing
plugin functions!</p></div></div><h2 class="anchor anchorWithStickyNavbar_JmGV" id="create-a-plugin">Create a plugin<a href="#create-a-plugin" class="hash-link" aria-label="Direct link to Create a plugin" title="Direct link to Create a plugin">​</a></h2><div class="theme-admonition theme-admonition-info alert alert--info admonition_uH4V"><div class="admonitionHeading_P5_N"><span class="admonitionIcon_MF44"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_yySL"><p>Although plugins can be written in any language that compiles to WASM, we&#x27;ve only tested Rust. The
rest of this article assume you&#x27;re using Rust and Cargo! Refer to <a href="https://extism.org/" target="_blank" rel="noopener noreferrer">Extism</a>&#x27;s
documentation or our official <a href="https://github.com/moonrepo/node-plugin" target="_blank" rel="noopener noreferrer">Node.js plugin</a> for other
examples.</p></div></div><p>To start, create a new crate with Cargo:</p><div class="language-shell codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-shell codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token plain">cargo new plugin --lib</span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token builtin class-name" style="color:#ff94ff;font-weight:bold">cd</span><span class="token plain"> plugin</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And set the lib type to <code>cdylib</code>, and other settings.</p><div class="language-toml codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockTitle_x_ju">Cargo.toml</div><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-toml codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token punctuation" style="color:#cad4e2">[</span><span class="token table class-name" style="color:#ff94ff;font-weight:bold">lib</span><span class="token punctuation" style="color:#cad4e2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token key property" style="color:#b7a9f9">crate-type</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">[</span><span class="token string" style="color:#c9e166">&#x27;cdylib&#x27;</span><span class="token punctuation" style="color:#cad4e2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">[</span><span class="token table class-name" style="color:#ff94ff;font-weight:bold">profile.release</span><span class="token punctuation" style="color:#cad4e2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token key property" style="color:#b7a9f9">codegen-units</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">=</span><span class="token plain"> </span><span class="token number" style="color:#94dded">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token key property" style="color:#b7a9f9">lto</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">=</span><span class="token plain"> </span><span class="token boolean" style="color:#94dded">true</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Our Rust plugins are powered by <a href="https://extism.org/" target="_blank" rel="noopener noreferrer">Extism</a>, so lets add their PDK and ours as a
dependency.</p><div class="language-shell codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-shell codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token plain">cargo </span><span class="token function" style="color:#ff94ff;font-weight:bold">add</span><span class="token plain"> extism-pdk proto_pdk</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In all Rust files, we can import both PDKs with the following:</p><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockTitle_x_ju">src/lib.rs</div><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token keyword" style="color:#b7a9f9">use</span><span class="token plain"> </span><span class="token namespace" style="color:#b7a9f9">extism_pdk</span><span class="token namespace punctuation" style="color:#cad4e2">::</span><span class="token operator" style="color:#b7a9f9">*</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token keyword" style="color:#b7a9f9">use</span><span class="token plain"> </span><span class="token namespace" style="color:#b7a9f9">proto_pdk</span><span class="token namespace punctuation" style="color:#cad4e2">::</span><span class="token operator" style="color:#b7a9f9">*</span><span class="token punctuation" style="color:#cad4e2">;</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can then build the WASM binary. The file will be available at
<code>target/wasm32-wasi/debug/&lt;name&gt;.wasm</code>.</p><div class="language-shell codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-shell codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token plain">cargo </span><span class="token function" style="color:#ff94ff;font-weight:bold">install</span><span class="token plain"> cargo-wasi</span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">cargo wasi build</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_JmGV" id="implementing-plugin-functions">Implementing plugin functions<a href="#implementing-plugin-functions" class="hash-link" aria-label="Direct link to Implementing plugin functions" title="Direct link to Implementing plugin functions">​</a></h2><p>Plugins are powered by a set of functions that are called from the host, and are annotated with
<code>#[plugin_fn]</code>.</p><h3 class="anchor anchorWithStickyNavbar_JmGV" id="registering-metadata">Registering metadata<a href="#registering-metadata" class="hash-link" aria-label="Direct link to Registering metadata" title="Direct link to Registering metadata">​</a></h3><p>The first step in a plugin&#x27;s life-cycle is to register metadata about the plugin with the
<code>register_tool</code> function. This function is called immediately after a plugin is loaded at runtime,
and must return a human-readable name and plugin type.</p><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token attribute attr-name" style="color:#fde047">#[plugin_fn]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token keyword" style="color:#b7a9f9">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#ff94ff;font-weight:bold">register_tool</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">_</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">FnResult</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">ToolMetadataOutput</span><span class="token operator" style="color:#b7a9f9">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Ok</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">ToolMetadataOutput</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        name</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;Node.js&quot;</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">into</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        type_of</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">PluginType</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Language</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        plugin_version</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Some</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token macro property" style="color:#b7a9f9">env!</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;CARGO_PKG_VERSION&quot;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">into</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token punctuation" style="color:#cad4e2">..</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">ToolMetadataOutput</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token function" style="color:#ff94ff;font-weight:bold">default</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">}</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This function also receives the plugin ID as input, allowing for conditional logic based on the ID.
The ID is the <a href="#enabling-plugins">key the plugin was configured with</a>, and what is passed to <code>proto</code>
commands (e.g. <code>proto install &lt;id&gt;</code>).</p><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token attribute attr-name" style="color:#fde047">#[plugin_fn]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token keyword" style="color:#b7a9f9">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#ff94ff;font-weight:bold">register_tool</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">input</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">ToolMetadataInput</span><span class="token operator" style="color:#b7a9f9">&gt;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">FnResult</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">ToolMetadataOutput</span><span class="token operator" style="color:#b7a9f9">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">  input</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">  </span><span class="token comment" style="color:#97a1af;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">}</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_JmGV" id="downloading-pre-builts">Downloading pre-builts<a href="#downloading-pre-builts" class="hash-link" aria-label="Direct link to Downloading pre-builts" title="Direct link to Downloading pre-builts">​</a></h3><p>Our plugin layer <em>only</em> supports downloading pre-built tools, typically as an archive, and does
<em>not</em> support building from source. The <code>download_prebuilt</code> function <em>must</em> be defined, whichs
configures how the tool should be downloaded and installed.</p><p>The following fields are available:</p><ul><li><code>archive_prefix</code> - If the tool is distributed as an archive (zip, tar, etc), this is the name of
the direct folder within the archive that contains the tool, and will be removed when unpacking
the archive. If there is no prefix folder within the archive, this setting can be omitted.</li><li><code>download_url</code> (required) - A secure URL to download the tool/archive.</li><li><code>download_name</code> - File name of the archive to download. If not provided, will attempt to extract
it from the URL.</li><li><code>checksum_url</code> - A secure URL to download the checksum file for verification. If the tool does not
support checksum verification, this setting can be omitted.</li></ul><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token attribute attr-name" style="color:#fde047">#[plugin_fn]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token keyword" style="color:#b7a9f9">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#ff94ff;font-weight:bold">download_prebuilt</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">input</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">DownloadPrebuiltInput</span><span class="token operator" style="color:#b7a9f9">&gt;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">FnResult</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">DownloadPrebuiltOutput</span><span class="token operator" style="color:#b7a9f9">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">     </span><span class="token keyword" style="color:#b7a9f9">let</span><span class="token plain"> env </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> </span><span class="token function" style="color:#ff94ff;font-weight:bold">get_proto_environment</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token operator" style="color:#b7a9f9">?</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token function" style="color:#ff94ff;font-weight:bold">check_supported_os_and_arch</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token constant" style="color:#ff94ff;font-weight:bold">NAME</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token operator" style="color:#b7a9f9">&amp;</span><span class="token plain">env</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token macro property" style="color:#b7a9f9">permutations!</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">            </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HostOS</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Linux</span><span class="token plain"> </span><span class="token operator" style="color:#b7a9f9">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">[</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HostArch</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token constant" style="color:#ff94ff;font-weight:bold">X64</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HostArch</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Arm64</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HostArch</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Arm</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HostArch</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Powerpc64</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HostArch</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">S390x</span><span class="token punctuation" style="color:#cad4e2">]</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">            </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HostOS</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">MacOS</span><span class="token plain"> </span><span class="token operator" style="color:#b7a9f9">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">[</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HostArch</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token constant" style="color:#ff94ff;font-weight:bold">X64</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HostArch</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Arm64</span><span class="token punctuation" style="color:#cad4e2">]</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">            </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HostOS</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Windows</span><span class="token plain"> </span><span class="token operator" style="color:#b7a9f9">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">[</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HostArch</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token constant" style="color:#ff94ff;font-weight:bold">X64</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HostArch</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token constant" style="color:#ff94ff;font-weight:bold">X86</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HostArch</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Arm64</span><span class="token punctuation" style="color:#cad4e2">]</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token punctuation" style="color:#cad4e2">]</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token operator" style="color:#b7a9f9">?</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token keyword" style="color:#b7a9f9">let</span><span class="token plain"> version </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> input</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">context</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">version</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token keyword" style="color:#b7a9f9">let</span><span class="token plain"> arch </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> env</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">arch</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token keyword" style="color:#b7a9f9">let</span><span class="token plain"> os </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> env</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">os</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token keyword" style="color:#b7a9f9">let</span><span class="token plain"> prefix </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">match</span><span class="token plain"> os </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HostOS</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Linux</span><span class="token plain"> </span><span class="token operator" style="color:#b7a9f9">=&gt;</span><span class="token plain"> </span><span class="token macro property" style="color:#b7a9f9">format!</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;node-v{version}-linux-{arch}&quot;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HostOS</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">MacOS</span><span class="token plain"> </span><span class="token operator" style="color:#b7a9f9">=&gt;</span><span class="token plain"> </span><span class="token macro property" style="color:#b7a9f9">format!</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;node-v{version}-darwin-{arch}&quot;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HostOS</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Windows</span><span class="token plain"> </span><span class="token operator" style="color:#b7a9f9">=&gt;</span><span class="token plain"> </span><span class="token macro property" style="color:#b7a9f9">format!</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;node-v{version}-win-{arch}&quot;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        other </span><span class="token operator" style="color:#b7a9f9">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">            </span><span class="token keyword" style="color:#b7a9f9">return</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Err</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">PluginError</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">UnsupportedPlatform</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;Node.js&quot;</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">into</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> other</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">into</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token operator" style="color:#b7a9f9">?</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token keyword" style="color:#b7a9f9">let</span><span class="token plain"> filename </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">if</span><span class="token plain"> os </span><span class="token operator" style="color:#b7a9f9">==</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HostOS</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Windows</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token macro property" style="color:#b7a9f9">format!</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;{prefix}.zip&quot;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token macro property" style="color:#b7a9f9">format!</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;{prefix}.tar.xz&quot;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Ok</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">DownloadPrebuiltOutput</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        archive_prefix</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Some</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">prefix</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        download_url</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token macro property" style="color:#b7a9f9">format!</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;https://nodejs.org/dist/v{version}/{filename}&quot;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        download_name</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Some</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">filename</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        checksum_url</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Some</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token macro property" style="color:#b7a9f9">format!</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;https://nodejs.org/dist/v{version}/SHASUMS256.txt&quot;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token punctuation" style="color:#cad4e2">..</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">DownloadPrebuiltOutput</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token function" style="color:#ff94ff;font-weight:bold">default</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">}</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_JmGV" id="unpacking-an-archive">Unpacking an archive<a href="#unpacking-an-archive" class="hash-link" aria-label="Direct link to Unpacking an archive" title="Direct link to Unpacking an archive">​</a></h4><p>Our plugin layer will do its best to detect file extensions, unpack the downloaded file (if an
archive), and install the tool to the correct directory. However, we&#x27;re unable to account for <em>all</em>
edge cases, so for situations where the install params above are not sufficient, you may define an
<code>unpack_archive</code> function.</p><p>This function receives an input with the following fields:</p><ul><li><code>input_file</code> - Virtual path to the downloaded file. Maps to <code>~/.proto/temp/&lt;id&gt;/&lt;file&gt;</code>.</li><li><code>output_dir</code> - Virtual directory to unpack the archive into, or copy the binary to. Maps to
<code>~/.proto/tools/&lt;id&gt;/&lt;version&gt;</code>.</li></ul><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token attribute attr-name" style="color:#fde047">#[plugin_fn]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token keyword" style="color:#b7a9f9">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#ff94ff;font-weight:bold">unpack_archive</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">input</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">UnpackArchiveInput</span><span class="token operator" style="color:#b7a9f9">&gt;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">FnResult</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token operator" style="color:#b7a9f9">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token function" style="color:#ff94ff;font-weight:bold">untar</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">input</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">input_file</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> input</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">output_dir</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token operator" style="color:#b7a9f9">?</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Ok</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">}</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_JmGV" id="locating-binaries">Locating binaries<a href="#locating-binaries" class="hash-link" aria-label="Direct link to Locating binaries" title="Direct link to Locating binaries">​</a></h3><p>Even though a tool has been installed, we must inform proto of where to find the binary to execute.
This can be achieved with the optional <code>locate_bins</code> function. If this function is not defined,
proto will assume the binary is named <code>&lt;id&gt;</code> (<code>&lt;id&gt;.exe</code> on Windows), relative from the installation
directory.</p><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token attribute attr-name" style="color:#fde047">#[plugin_fn]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token keyword" style="color:#b7a9f9">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#ff94ff;font-weight:bold">locate_bins</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">_</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">LocateBinsInput</span><span class="token operator" style="color:#b7a9f9">&gt;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">FnResult</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">LocateBinsOutput</span><span class="token operator" style="color:#b7a9f9">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token keyword" style="color:#b7a9f9">let</span><span class="token plain"> env </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> </span><span class="token function" style="color:#ff94ff;font-weight:bold">get_proto_environment</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token operator" style="color:#b7a9f9">?</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Ok</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">LocateBinsOutput</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        bin_path</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Some</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token keyword" style="color:#b7a9f9">if</span><span class="token plain"> env</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">os </span><span class="token operator" style="color:#b7a9f9">==</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HostOS</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Windows</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">            </span><span class="token string" style="color:#c9e166">&quot;node.exe&quot;</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">into</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">            </span><span class="token string" style="color:#c9e166">&quot;bin/node&quot;</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">into</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token punctuation" style="color:#cad4e2">..</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">LocateBinsOutput</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token function" style="color:#ff94ff;font-weight:bold">default</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">}</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Furthermore, the <code>locate_bins</code> function can define a list of lookups for the globals installation
directory. proto will loop through each lookup, and return the first directory that exists on the
current file system. proto will also expand environment variables in the format of <code>$VAR_NAME</code>. If a
variable is not defined, or has an empty value, the lookup will be skipped. To demonstrate this,
we&#x27;ll use <a href="https://deno.land/manual@v1.35.0/tools/script_installer" target="_blank" rel="noopener noreferrer">Deno</a>.</p><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token attribute attr-name" style="color:#fde047">#[plugin_fn]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token keyword" style="color:#b7a9f9">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#ff94ff;font-weight:bold">locate_bins</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">_</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">LocateBinsInput</span><span class="token operator" style="color:#b7a9f9">&gt;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">FnResult</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">LocateBinsOutput</span><span class="token operator" style="color:#b7a9f9">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Ok</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">LocateBinsOutput</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        fallback_last_globals_dir</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token boolean" style="color:#94dded">true</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        globals_lookup_dirs</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token macro property" style="color:#b7a9f9">vec!</span><span class="token punctuation" style="color:#cad4e2">[</span><span class="token string" style="color:#c9e166">&quot;$DENO_INSTALL_ROOT/bin&quot;</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">into</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;$HOME/.deno/bin&quot;</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">into</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">]</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token punctuation" style="color:#cad4e2">..</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">LocateBinsOutput</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token function" style="color:#ff94ff;font-weight:bold">default</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">}</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_JmGV" id="loading-and-resolving-versions">Loading and resolving versions<a href="#loading-and-resolving-versions" class="hash-link" aria-label="Direct link to Loading and resolving versions" title="Direct link to Loading and resolving versions">​</a></h3><p>Now that the tool can be downloaded and installed, we must configure how to resolve available
versions to actually be installed. To provide a list of versions and language specific aliases, the
<code>load_versions</code> function must be defined.</p><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token attribute attr-name" style="color:#fde047">#[plugin_fn]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token keyword" style="color:#b7a9f9">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#ff94ff;font-weight:bold">load_versions</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">_</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">LoadVersionsInput</span><span class="token operator" style="color:#b7a9f9">&gt;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">FnResult</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">LoadVersionsOutput</span><span class="token operator" style="color:#b7a9f9">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token keyword" style="color:#b7a9f9">let</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">mut</span><span class="token plain"> output </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">LoadVersionsOutput</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token function" style="color:#ff94ff;font-weight:bold">default</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token keyword" style="color:#b7a9f9">let</span><span class="token plain"> response</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Vec</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">NodeDistVersion</span><span class="token operator" style="color:#b7a9f9">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> </span><span class="token function" style="color:#ff94ff;font-weight:bold">fetch_url</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;https://nodejs.org/dist/index.json&quot;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token operator" style="color:#b7a9f9">?</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token keyword" style="color:#b7a9f9">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">index</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> item</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">in</span><span class="token plain"> response</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">iter</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">enumerate</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token keyword" style="color:#b7a9f9">let</span><span class="token plain"> version </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Version</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token function" style="color:#ff94ff;font-weight:bold">parse</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token operator" style="color:#b7a9f9">&amp;</span><span class="token plain">item</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">version</span><span class="token punctuation" style="color:#cad4e2">[</span><span class="token number" style="color:#94dded">1</span><span class="token punctuation" style="color:#cad4e2">..</span><span class="token punctuation" style="color:#cad4e2">]</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token operator" style="color:#b7a9f9">?</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"> </span><span class="token comment" style="color:#97a1af;font-style:italic">// Starts with v</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token keyword" style="color:#b7a9f9">if</span><span class="token plain"> index </span><span class="token operator" style="color:#b7a9f9">==</span><span class="token plain"> </span><span class="token number" style="color:#94dded">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">            output</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">latest </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Some</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">version</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">clone</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        output</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">versions</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">push</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">version</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Ok</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">output</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">}</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Furthermore, we support an optional function named <code>resolve_version</code>, that can be defined to
intercept the version resolution process. This function receives an input with an initial candidate,
either an alias or version, and can replace it with a new candidate. The candidate must be a valid
alias or version as defined in <code>load_versions</code>.</p><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token attribute attr-name" style="color:#fde047">#[plugin_fn]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token keyword" style="color:#b7a9f9">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#ff94ff;font-weight:bold">resolve_version</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">input</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">ResolveVersionInput</span><span class="token operator" style="color:#b7a9f9">&gt;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">FnResult</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">ResolveVersionOutput</span><span class="token operator" style="color:#b7a9f9">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token keyword" style="color:#b7a9f9">let</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">mut</span><span class="token plain"> output </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">ResolveVersionOutput</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token function" style="color:#ff94ff;font-weight:bold">default</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token keyword" style="color:#b7a9f9">if</span><span class="token plain"> input</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">initial </span><span class="token operator" style="color:#b7a9f9">==</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;node&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        output</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">candidate </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Some</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;latest&quot;</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">into</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">else</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">if</span><span class="token plain"> input</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">initial </span><span class="token operator" style="color:#b7a9f9">==</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;lts-*&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#b7a9f9">||</span><span class="token plain"> input</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">initial </span><span class="token operator" style="color:#b7a9f9">==</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;lts/*&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        output</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">candidate </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Some</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;stable&quot;</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">into</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">else</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">if</span><span class="token plain"> input</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">initial</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">starts_with</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;lts-&quot;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"> </span><span class="token operator" style="color:#b7a9f9">||</span><span class="token plain"> input</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">initial</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">starts_with</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;lts/&quot;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        output</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">candidate </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Some</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">input</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">initial</span><span class="token punctuation" style="color:#cad4e2">[</span><span class="token number" style="color:#94dded">4</span><span class="token punctuation" style="color:#cad4e2">..</span><span class="token punctuation" style="color:#cad4e2">]</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">to_owned</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Ok</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">output</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">}</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_JmGV" id="detecting-versions">Detecting versions<a href="#detecting-versions" class="hash-link" aria-label="Direct link to Detecting versions" title="Direct link to Detecting versions">​</a></h3><p>And lastly, we can configure how to <a href="/docs/proto/detection">detect a version</a> contextually at runtime, using
the <code>detect_version_files</code> function and optional <code>parse_version_file</code> function. The
<code>detect_version_files</code> function can return a list of files to locate within a directory.</p><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token attribute attr-name" style="color:#fde047">#[plugin_fn]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token keyword" style="color:#b7a9f9">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#ff94ff;font-weight:bold">detect_version_files</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">_</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">FnResult</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">DetectVersionOutput</span><span class="token operator" style="color:#b7a9f9">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Ok</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">DetectVersionOutput</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        files</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token macro property" style="color:#b7a9f9">vec!</span><span class="token punctuation" style="color:#cad4e2">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">            </span><span class="token string" style="color:#c9e166">&quot;.nvmrc&quot;</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">into</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">            </span><span class="token string" style="color:#c9e166">&quot;.node-version&quot;</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">into</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">            </span><span class="token string" style="color:#c9e166">&quot;package.json&quot;</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">into</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token punctuation" style="color:#cad4e2">]</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">}</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>By default our plugin layer will assume the version file&#x27;s contents contain the literal version, and
nothing else, like &quot;1.2.3&quot;. If any of the files in the <code>detect_version_files</code> list require custom
parsing (for example, <code>package.json</code> above), you can define the <code>parse_version_file</code> function.</p><p>This function receives the file name and contents as input, and must return the parsed version (if
applicable).</p><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token attribute attr-name" style="color:#fde047">#[plugin_fn]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token keyword" style="color:#b7a9f9">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#ff94ff;font-weight:bold">parse_version_file</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">input</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">ParseVersionFileInput</span><span class="token operator" style="color:#b7a9f9">&gt;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">FnResult</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">ParseVersionFileOutput</span><span class="token operator" style="color:#b7a9f9">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token keyword" style="color:#b7a9f9">let</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">mut</span><span class="token plain"> version </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">None</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token keyword" style="color:#b7a9f9">if</span><span class="token plain"> input</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">file </span><span class="token operator" style="color:#b7a9f9">==</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;package.json&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token keyword" style="color:#b7a9f9">let</span><span class="token plain"> json</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">PackageJson</span><span class="token plain"> </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> </span><span class="token namespace" style="color:#b7a9f9">serde_json</span><span class="token namespace punctuation" style="color:#cad4e2">::</span><span class="token function" style="color:#ff94ff;font-weight:bold">from_str</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token operator" style="color:#b7a9f9">&amp;</span><span class="token plain">input</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">content</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token operator" style="color:#b7a9f9">?</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token keyword" style="color:#b7a9f9">if</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">let</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Some</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">engines</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"> </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">engines </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">            </span><span class="token keyword" style="color:#b7a9f9">if</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">let</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Some</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">constraint</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"> </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> engines</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">get</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;node&quot;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">                version </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Some</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">constraint</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">to_owned</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">            </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        version </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Some</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">input</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">content</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">trim</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">to_owned</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Ok</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">ParseVersionFileOutput</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"> version </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">}</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_JmGV" id="creating-shims">Creating shims<a href="#creating-shims" class="hash-link" aria-label="Direct link to Creating shims" title="Direct link to Creating shims">​</a></h3><p>Tools within proto wouldn&#x27;t function without shims, and as such, plugins can register their own
shims to be created. By default, proto <em>will always</em> create a global shim of the plugin at
<code>~/.proto/bin/&lt;id&gt;</code>, but you can also register additional shims with the <code>create_shims</code> function.</p><h4 class="anchor anchorWithStickyNavbar_JmGV" id="global-shims">Global shims<a href="#global-shims" class="hash-link" aria-label="Direct link to Global shims" title="Direct link to Global shims">​</a></h4><p>Global shims are optional scripts that are available on <code>PATH</code> as they are generated in the
<code>~/.proto/bin</code> directory, and can be defined with the <code>global_shims</code> parameter. This param is a hash
map, where the key is the shim file name, and the value is a configuration object.</p><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token attribute attr-name" style="color:#fde047">#[plugin_fn]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token keyword" style="color:#b7a9f9">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#ff94ff;font-weight:bold">create_shims</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">_</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">CreateShimsInput</span><span class="token operator" style="color:#b7a9f9">&gt;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">FnResult</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">CreateShimsOutput</span><span class="token operator" style="color:#b7a9f9">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token keyword" style="color:#b7a9f9">let</span><span class="token plain"> env </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> </span><span class="token function" style="color:#ff94ff;font-weight:bold">get_proto_environment</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token operator" style="color:#b7a9f9">?</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token keyword" style="color:#b7a9f9">let</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">mut</span><span class="token plain"> global_shims </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HashMap</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token function" style="color:#ff94ff;font-weight:bold">new</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    global_shims</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">insert</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token string" style="color:#c9e166">&quot;npx&quot;</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">into</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">ShimConfig</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token function" style="color:#ff94ff;font-weight:bold">global_with_alt_bin</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token keyword" style="color:#b7a9f9">if</span><span class="token plain"> env</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">os </span><span class="token operator" style="color:#b7a9f9">==</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">HostOS</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Windows</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">            </span><span class="token string" style="color:#c9e166">&quot;npx.cmd&quot;</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">into</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">            </span><span class="token string" style="color:#c9e166">&quot;bin/npx&quot;</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">into</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Ok</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">CreateShimsOutput</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        global_shims</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token punctuation" style="color:#cad4e2">..</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">CreateShimsOutput</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token function" style="color:#ff94ff;font-weight:bold">default</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">}</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Furthermore, if you&#x27;d prefer to <em>not</em> create a primary global shim at all, enable the
<code>no_primary_global</code> field.</p><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token attribute attr-name" style="color:#fde047">#[plugin_fn]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token keyword" style="color:#b7a9f9">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#ff94ff;font-weight:bold">create_shims</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">_</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">CreateShimsInput</span><span class="token operator" style="color:#b7a9f9">&gt;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">FnResult</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">CreateShimsOutput</span><span class="token operator" style="color:#b7a9f9">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Ok</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">CreateShimsOutput</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        no_primary_global</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token boolean" style="color:#94dded">true</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token punctuation" style="color:#cad4e2">..</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">CreateShimsOutput</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token function" style="color:#ff94ff;font-weight:bold">default</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">}</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_JmGV" id="installing-and-uninstalling-globals">Installing and uninstalling globals<a href="#installing-and-uninstalling-globals" class="hash-link" aria-label="Direct link to Installing and uninstalling globals" title="Direct link to Installing and uninstalling globals">​</a></h3><p>Most languages support the concept of installing packages/dependencies globally, and making them
available on <code>PATH</code>. proto supports this with the
<a href="/docs/proto/commands/install-global"><code>proto install-global</code></a> and
<a href="/docs/proto/commands/uninstall-global"><code>proto uninstall-global</code></a> commands, which are simple convenience
wrappers around the native binary.</p><p>From the context of the plugin, how globals are installed and uninstalled is implemented with the
<code>install_global</code> and <code>uninstall_global</code> functions respectively. Both functions receive the
<code>dependency</code> to install as input.</p><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token attribute attr-name" style="color:#fde047">#[plugin_fn]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token keyword" style="color:#b7a9f9">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#ff94ff;font-weight:bold">install_global</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">input</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">InstallGlobalInput</span><span class="token operator" style="color:#b7a9f9">&gt;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">FnResult</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">InstallGlobalOutput</span><span class="token operator" style="color:#b7a9f9">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token keyword" style="color:#b7a9f9">let</span><span class="token plain"> result </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> </span><span class="token macro property" style="color:#b7a9f9">exec_command!</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">inherit</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;npm&quot;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">[</span><span class="token string" style="color:#c9e166">&quot;install&quot;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;--global&quot;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token operator" style="color:#b7a9f9">&amp;</span><span class="token plain">input</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">dependency</span><span class="token punctuation" style="color:#cad4e2">]</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Ok</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">InstallGlobalOutput</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token function" style="color:#ff94ff;font-weight:bold">from_exec_command</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token attribute attr-name" style="color:#fde047">#[plugin_fn]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token keyword" style="color:#b7a9f9">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#b7a9f9">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#ff94ff;font-weight:bold">uninstall_global</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">input</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">UninstallGlobalInput</span><span class="token operator" style="color:#b7a9f9">&gt;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">FnResult</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">UninstallGlobalOutput</span><span class="token operator" style="color:#b7a9f9">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token keyword" style="color:#b7a9f9">let</span><span class="token plain"> result </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> </span><span class="token macro property" style="color:#b7a9f9">exec_command!</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">inherit</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;npm&quot;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">[</span><span class="token string" style="color:#c9e166">&quot;uninstall&quot;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;--global&quot;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token operator" style="color:#b7a9f9">&amp;</span><span class="token plain">input</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token plain">dependency</span><span class="token punctuation" style="color:#cad4e2">]</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Ok</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">Json</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">UninstallGlobalOutput</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token function" style="color:#ff94ff;font-weight:bold">from_exec_command</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">}</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_JmGV" id="testing">Testing<a href="#testing" class="hash-link" aria-label="Direct link to Testing" title="Direct link to Testing">​</a></h2><p>The best way to test the plugin is to execute it through <code>proto</code> directly. To do this, you&#x27;ll need
to configure a <code>.prototools</code> file at the root of your plugin&#x27;s repository that maps the plugin to a
debug build:</p><div class="language-toml codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-toml codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token punctuation" style="color:#cad4e2">[</span><span class="token table class-name" style="color:#ff94ff;font-weight:bold">plugins</span><span class="token punctuation" style="color:#cad4e2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">&lt;id&gt; </span><span class="token punctuation" style="color:#cad4e2">=</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;source:target/wasm32-wasi/debug/&lt;name&gt;.wasm&quot;</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And everytime you make a change to the plugin, you&#x27;ll need to rebuild it with:</p><div class="language-shell codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-shell codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token plain">cargo wasi build</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>With these 2 pieces in place, you can now execute <code>proto</code> commands. Be sure you&#x27;re running them from
the directory with the <code>.prototools</code> file, and that you&#x27;re passing <code>--log trace</code>. Logs are extremely
helpful for figuring out what&#x27;s going on.</p><div class="language-shell codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-shell codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token plain">proto --log trace </span><span class="token function" style="color:#ff94ff;font-weight:bold">install</span><span class="token plain"> </span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token plain">id</span><span class="token operator" style="color:#b7a9f9">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">proto --log trace list-remote </span><span class="token operator" style="color:#b7a9f9">&lt;</span><span class="token plain">id</span><span class="token operator" style="color:#b7a9f9">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_JmGV" id="unit-tests">Unit tests<a href="#unit-tests" class="hash-link" aria-label="Direct link to Unit tests" title="Direct link to Unit tests">​</a></h3><p>Testing WASM plugins is a bit tricky, but we&#x27;ve taken it upon ourselves to streamline this process
as much as possible with built-in test utilities, and Rust macros for generating common test cases.
To begin, install all necessary development dependencies:</p><div class="language-shell codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-shell codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token plain">cargo </span><span class="token function" style="color:#ff94ff;font-weight:bold">add</span><span class="token plain"> --dev proto_pdk_test_utils starbase_sandbox tokio</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And as mentioned above, everytime you make a change to the plugin, you&#x27;ll need to rebuild it with:</p><div class="language-shell codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-shell codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token plain">cargo wasi build</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_JmGV" id="testing-plugin-functions">Testing plugin functions<a href="#testing-plugin-functions" class="hash-link" aria-label="Direct link to Testing plugin functions" title="Direct link to Testing plugin functions">​</a></h4><p>The common test case is simply calling plugin functions with a provided input and asserting the
output is correct. This can be achieved by creating a plugin instance with <code>create_plugin</code> and
calling the appropriate method.</p><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token keyword" style="color:#b7a9f9">use</span><span class="token plain"> </span><span class="token namespace" style="color:#b7a9f9">proto_pdk_test_utils</span><span class="token namespace punctuation" style="color:#cad4e2">::</span><span class="token operator" style="color:#b7a9f9">*</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token keyword" style="color:#b7a9f9">use</span><span class="token plain"> </span><span class="token namespace" style="color:#b7a9f9">starbase_sandbox</span><span class="token namespace punctuation" style="color:#cad4e2">::</span><span class="token plain">create_empty_sandbox</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token attribute attr-name" style="color:#fde047">#[test]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token keyword" style="color:#b7a9f9">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#ff94ff;font-weight:bold">registers_metadata</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token keyword" style="color:#b7a9f9">let</span><span class="token plain"> sandbox </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> </span><span class="token function" style="color:#ff94ff;font-weight:bold">create_empty_sandbox</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token keyword" style="color:#b7a9f9">let</span><span class="token plain"> plugin </span><span class="token operator" style="color:#b7a9f9">=</span><span class="token plain"> </span><span class="token function" style="color:#ff94ff;font-weight:bold">create_plugin</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;id&quot;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> sandbox</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">path</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token macro property" style="color:#b7a9f9">assert_eq!</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        plugin</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">register_tool</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">ToolMetadataInput</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token function" style="color:#ff94ff;font-weight:bold">default</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token class-name" style="color:#ff94ff;font-weight:bold">ToolMetadataOutput</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">            name</span><span class="token punctuation" style="color:#cad4e2">:</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;Name&quot;</span><span class="token punctuation" style="color:#cad4e2">.</span><span class="token function" style="color:#ff94ff;font-weight:bold">into</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">            </span><span class="token punctuation" style="color:#cad4e2">..</span><span class="token class-name" style="color:#ff94ff;font-weight:bold">ToolMetadataOutput</span><span class="token punctuation" style="color:#cad4e2">::</span><span class="token function" style="color:#ff94ff;font-weight:bold">default</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">        </span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">}</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-info alert alert--info admonition_uH4V"><div class="admonitionHeading_P5_N"><span class="admonitionIcon_MF44"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_yySL"><p>We suggest using this pattern for static functions that return a deterministic output from a
provided input, and not for dynamic functions that make HTTP requests or execute host commands.</p></div></div><h4 class="anchor anchorWithStickyNavbar_JmGV" id="generating-cases-from-macros">Generating cases from macros<a href="#generating-cases-from-macros" class="hash-link" aria-label="Direct link to Generating cases from macros" title="Direct link to Generating cases from macros">​</a></h4><p>To reduce the burden of writing custom tests for common flows, like downloading a pre-built,
resolving versions, and generating shims, we provide a set of Rust decl macros that will generate
the tests for you.</p><p>To test downloading and installing, use <code>generate_download_install_tests!</code>. This macro requires a
plugin ID and a real version to test with.</p><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token keyword" style="color:#b7a9f9">use</span><span class="token plain"> </span><span class="token namespace" style="color:#b7a9f9">proto_pdk_test_utils</span><span class="token namespace punctuation" style="color:#cad4e2">::</span><span class="token operator" style="color:#b7a9f9">*</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token macro property" style="color:#b7a9f9">generate_download_install_tests!</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;id&quot;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;1.2.3&quot;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To test version resolving, use <code>generate_resolve_versions_tests!</code>. This macro requires a plugin ID,
and a mapping of version/aliases assertions to expectations.</p><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token macro property" style="color:#b7a9f9">generate_resolve_versions_tests!</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;id&quot;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token string" style="color:#c9e166">&quot;0.4&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#b7a9f9">=&gt;</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;0.4.12&quot;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token string" style="color:#c9e166">&quot;0.5.1&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#b7a9f9">=&gt;</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;0.5.1&quot;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain">    </span><span class="token string" style="color:#c9e166">&quot;stable&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#b7a9f9">=&gt;</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;1.0.0&quot;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token punctuation" style="color:#cad4e2">}</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To test installing and uninstalling globals, use <code>generate_globals_test!</code>. This macro requires a
plugin ID, the dependency to install, and an optional environment variable to the globals directory.</p><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token comment" style="color:#97a1af;font-style:italic">// Doesn&#x27;t support all use cases! If this doesn&#x27;t work, implement a test case manually.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token macro property" style="color:#b7a9f9">generate_globals_test!</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;id&quot;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;dependency&quot;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;GLOBAL_INSTALL_ROOT&quot;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And lastly, to test shims, use <code>generate_global_shims_test!</code> or <code>generate_local_shims_test!</code>. Both
macros require a plugin ID, but also support additional arguments when creating more than 1 shim.
These macros generate snapshots using <a href="https://insta.rs/" target="_blank" rel="noopener noreferrer">Insta</a>.</p><div class="language-rust codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-rust codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token comment" style="color:#97a1af;font-style:italic">// Only the single binary</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token macro property" style="color:#b7a9f9">generate_global_shims_test!</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;id&quot;</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token comment" style="color:#97a1af;font-style:italic">// When creating alternate/additional globals</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token macro property" style="color:#b7a9f9">generate_global_shims_test!</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;id&quot;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">[</span><span class="token string" style="color:#c9e166">&quot;other&quot;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;another&quot;</span><span class="token punctuation" style="color:#cad4e2">]</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token comment" style="color:#97a1af;font-style:italic">// When creating local shims, each file required in the list</span><span class="token plain"></span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token macro property" style="color:#b7a9f9">generate_local_shims_test!</span><span class="token punctuation" style="color:#cad4e2">(</span><span class="token string" style="color:#c9e166">&quot;id&quot;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#cad4e2">[</span><span class="token string" style="color:#c9e166">&quot;a&quot;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;b&quot;</span><span class="token punctuation" style="color:#cad4e2">,</span><span class="token plain"> </span><span class="token string" style="color:#c9e166">&quot;c&quot;</span><span class="token punctuation" style="color:#cad4e2">]</span><span class="token punctuation" style="color:#cad4e2">)</span><span class="token punctuation" style="color:#cad4e2">;</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_JmGV" id="building-and-publishing">Building and publishing<a href="#building-and-publishing" class="hash-link" aria-label="Direct link to Building and publishing" title="Direct link to Building and publishing">​</a></h2><p>At this point, you should have a fully working WASM plugin, but to make it available to downstream
proto users, you&#x27;ll still need to build and make the <code>.wasm</code> file available. The easiest solution is
to publish a GitHub release and include the <code>.wasm</code> file as an asset.</p><h3 class="anchor anchorWithStickyNavbar_JmGV" id="manually-create-releases">Manually create releases<a href="#manually-create-releases" class="hash-link" aria-label="Direct link to Manually create releases" title="Direct link to Manually create releases">​</a></h3><p>When your plugin is ready to be published, you can create a release on GitHub using the following
steps.</p><ol><li>Tag the release and push to GitHub.</li></ol><div class="language-shell codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-shell codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token function" style="color:#ff94ff;font-weight:bold">git</span><span class="token plain"> tag v0.0.1</span><br></span><span class="token-line" style="color:#e5e9f1"><span class="token plain"></span><span class="token function" style="color:#ff94ff;font-weight:bold">git</span><span class="token plain"> push --tags</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Build a release version of the plugin. The file will be available at
<code>target/wasm32-wasi/release/&lt;name&gt;.wasm</code>.</li></ol><div class="language-shell codeBlockContainer_mQmQ theme-code-block" style="--prism-background-color:#00080f;--prism-color:#e5e9f1"><div class="codeBlockContent_D5yF"><pre tabindex="0" class="prism-code language-shell codeBlock_RMoD thin-scrollbar"><code class="codeBlockLines_AclH"><span class="token-line" style="color:#e5e9f1"><span class="token plain">cargo wasi build --release</span><br></span></code></pre><div class="buttonGroup_aaMX"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_z5j7" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_FoOz"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_L0B6"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>In GitHub, navigate to the tags page, find the new tag, create a new release, and attach the
built file as an asset.</li></ol><h3 class="anchor anchorWithStickyNavbar_JmGV" id="automate-releases">Automate releases<a href="#automate-releases" class="hash-link" aria-label="Direct link to Automate releases" title="Direct link to Automate releases">​</a></h3><p>Coming soon!</p><h2 class="anchor anchorWithStickyNavbar_JmGV" id="resources">Resources<a href="#resources" class="hash-link" aria-label="Direct link to Resources" title="Direct link to Resources">​</a></h2><p>Some helpful resources for learning about and building plugins.</p><ul><li>Official proto WASM plugins<ul><li><a href="https://github.com/moonrepo/bun-plugin" target="_blank" rel="noopener noreferrer">Bun</a></li><li><a href="https://github.com/moonrepo/deno-plugin" target="_blank" rel="noopener noreferrer">Deno</a></li><li><a href="https://github.com/moonrepo/go-plugin" target="_blank" rel="noopener noreferrer">Go</a></li><li><a href="https://github.com/moonrepo/node-plugin" target="_blank" rel="noopener noreferrer">Node</a></li><li><a href="https://github.com/moonrepo/node-plugin" target="_blank" rel="noopener noreferrer">npm, pnpm, yarn</a></li><li><a href="https://github.com/moonrepo/python-plugin" target="_blank" rel="noopener noreferrer">Python</a></li><li><a href="https://github.com/moonrepo/rust-plugin" target="_blank" rel="noopener noreferrer">Rust</a></li><li><a href="https://github.com/moonrepo/schema-plugin" target="_blank" rel="noopener noreferrer">Schema</a></li></ul></li><li>Plugin development kit<ul><li><a href="https://docs.rs/proto_pdk/" target="_blank" rel="noopener noreferrer"><code>proto_pdk</code> docs</a></li><li><a href="https://docs.rs/proto_pdk_test_utils/" target="_blank" rel="noopener noreferrer"><code>proto_pdk_test_utils</code> docs</a></li></ul></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/moonrepo/moon/tree/master/website/docs/proto/wasm-plugin.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_bHB7" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_pbO5"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><div class="flex-1 text-left"><a class="cursor-pointer text-base text-blurple-300 hover:text-blurple-500 dark:text-purple-400 dark:hover:text-purple-200 font-bold" href="/docs/proto/toml-plugin"><span class="inline-block mr-1 icon-previous" aria-hidden="true"><svg aria-hidden="true" focusable="false" data-prefix="far" data-icon="chevron-left" class="svg-inline--fa fa-chevron-left" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M15 239c-9.4 9.4-9.4 24.6 0 33.9L207 465c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9L65.9 256 241 81c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0L15 239z"></path></svg></span>TOML</a></div><div class="flex-1 text-right"><a class="cursor-pointer text-base text-blurple-300 hover:text-blurple-500 dark:text-purple-400 dark:hover:text-purple-200 font-bold" href="/docs/proto/commands/add-plugin">add-plugin<span class="inline-block ml-1 icon-next" aria-hidden="true"><svg aria-hidden="true" focusable="false" data-prefix="far" data-icon="chevron-right" class="svg-inline--fa fa-chevron-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M305 239c9.4 9.4 9.4 24.6 0 33.9L113 465c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l175-175L79 81c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0L305 239z"></path></svg></span></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_XG6w thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#concepts" class="table-of-contents__link toc-highlight">Concepts</a><ul><li><a href="#virtual-paths" class="table-of-contents__link toc-highlight">Virtual paths</a></li><li><a href="#host-environment" class="table-of-contents__link toc-highlight">Host environment</a></li><li><a href="#host-functions" class="table-of-contents__link toc-highlight">Host functions</a></li><li><a href="#tool-id-and-context" class="table-of-contents__link toc-highlight">Tool ID and context</a></li></ul></li><li><a href="#create-a-plugin" class="table-of-contents__link toc-highlight">Create a plugin</a></li><li><a href="#implementing-plugin-functions" class="table-of-contents__link toc-highlight">Implementing plugin functions</a><ul><li><a href="#registering-metadata" class="table-of-contents__link toc-highlight">Registering metadata</a></li><li><a href="#downloading-pre-builts" class="table-of-contents__link toc-highlight">Downloading pre-builts</a><ul><li><a href="#unpacking-an-archive" class="table-of-contents__link toc-highlight">Unpacking an archive</a></li></ul></li><li><a href="#locating-binaries" class="table-of-contents__link toc-highlight">Locating binaries</a></li><li><a href="#loading-and-resolving-versions" class="table-of-contents__link toc-highlight">Loading and resolving versions</a></li><li><a href="#detecting-versions" class="table-of-contents__link toc-highlight">Detecting versions</a></li><li><a href="#creating-shims" class="table-of-contents__link toc-highlight">Creating shims</a><ul><li><a href="#global-shims" class="table-of-contents__link toc-highlight">Global shims</a></li></ul></li><li><a href="#installing-and-uninstalling-globals" class="table-of-contents__link toc-highlight">Installing and uninstalling globals</a></li></ul></li><li><a href="#testing" class="table-of-contents__link toc-highlight">Testing</a><ul><li><a href="#unit-tests" class="table-of-contents__link toc-highlight">Unit tests</a><ul><li><a href="#testing-plugin-functions" class="table-of-contents__link toc-highlight">Testing plugin functions</a></li><li><a href="#generating-cases-from-macros" class="table-of-contents__link toc-highlight">Generating cases from macros</a></li></ul></li></ul></li><li><a href="#building-and-publishing" class="table-of-contents__link toc-highlight">Building and publishing</a><ul><li><a href="#manually-create-releases" class="table-of-contents__link toc-highlight">Manually create releases</a></li><li><a href="#automate-releases" class="table-of-contents__link toc-highlight">Automate releases</a></li></ul></li><li><a href="#resources" class="table-of-contents__link toc-highlight">Resources</a></li></ul></div></div></div></div></main></div></div><footer class="bg-gray-100 dark:bg-slate-600" aria-labelledby="footer-heading"><h2 id="footer-heading" class="sr-only">Footer</h2><div class="max-w-7xl mx-auto py-3 px-2 sm:px-3 md:py-4 md:px-4 lg:px-6"><div class="lg:grid lg:grid-cols-5 lg:gap-3"><div class="grid grid-cols-3 gap-3 lg:col-span-3"><div><h6 class="m-0 text-base font-semibold uppercase">Learn</h6><ul role="list" class="m-0 mt-2 p-0 space-y-1 list-none"><li><a class="cursor-pointer text-base text-blurple-300 hover:text-blurple-500 dark:text-purple-400 dark:hover:text-purple-200 font-normal" href="/docs">Docs</a></li><li><a class="cursor-pointer text-base text-blurple-300 hover:text-blurple-500 dark:text-purple-400 dark:hover:text-purple-200 font-normal" href="/docs/guides/ci">Guides</a></li><li><a class="cursor-pointer text-base text-blurple-300 hover:text-blurple-500 dark:text-purple-400 dark:hover:text-purple-200 font-normal" href="/blog">Blog</a></li><li><a class="cursor-pointer text-base text-blurple-300 hover:text-blurple-500 dark:text-purple-400 dark:hover:text-purple-200 font-normal" href="/api">API</a></li></ul></div><div><h6 class="m-0 text-base font-semibold uppercase">Ecosystem</h6><ul role="list" class="m-0 mt-2 p-0 space-y-1 list-none"><li><a href="https://github.com/moonrepo/moon/releases" target="_blank" rel="noopener noreferrer" class="cursor-pointer text-base text-blurple-300 hover:text-blurple-500 dark:text-purple-400 dark:hover:text-purple-200 font-normal">Releases</a></li><li><a href="https://github.com/moonrepo/moon-configs" target="_blank" rel="noopener noreferrer" class="cursor-pointer text-base text-blurple-300 hover:text-blurple-500 dark:text-purple-400 dark:hover:text-purple-200 font-normal">Shared configs</a></li><li><a href="https://github.com/moonrepo/dev" target="_blank" rel="noopener noreferrer" class="cursor-pointer text-base text-blurple-300 hover:text-blurple-500 dark:text-purple-400 dark:hover:text-purple-200 font-normal">Developer tools</a></li><li><a href="https://github.com/moonrepo/examples" target="_blank" rel="noopener noreferrer" class="cursor-pointer text-base text-blurple-300 hover:text-blurple-500 dark:text-purple-400 dark:hover:text-purple-200 font-normal">Examples repository</a></li></ul></div><div><h6 class="m-0 text-base font-semibold uppercase">Support</h6><ul role="list" class="m-0 mt-2 p-0 space-y-1 list-none"><li><a href="https://github.com/moonrepo" target="_blank" rel="noopener noreferrer" class="cursor-pointer text-base text-blurple-300 hover:text-blurple-500 dark:text-purple-400 dark:hover:text-purple-200 font-normal">GitHub</a></li><li><a href="https://discord.gg/qCh9MEynv2" target="_blank" rel="noopener noreferrer" class="cursor-pointer text-base text-blurple-300 hover:text-blurple-500 dark:text-purple-400 dark:hover:text-purple-200 font-normal">Discord</a></li><li><a href="https://twitter.com/tothemoonrepo" target="_blank" rel="noopener noreferrer" class="cursor-pointer text-base text-blurple-300 hover:text-blurple-500 dark:text-purple-400 dark:hover:text-purple-200 font-normal">Twitter</a></li></ul></div></div><div class="mt-4 lg:mt-0 col-span-2"><h6 class="m-0 text-base font-semibold uppercase">Contact us</h6><p class="text-base text-gray-800 dark:text-slate-100 font-normal">Want to learn more about moonrepo? Have questions?</p><div class="mt-2"><div class="flex justify-between gap-x-1"><div class="w-3/4"><label for="subject" class="sr-only">Subject</label><select id="subject" name="subject" required="" class="outline-none min-w-0 w-full bg-white border border-transparent rounded-md px-1 py-1 text-base text-gray-800 placeholder-gray-600 h-full font-sans"><option value="" selected=""></option><option value="Consultation">Consultation</option><option value="Partnership">Partnership</option><option value="Affiliation">Affiliation</option></select></div><button class="border border-transparent rounded-md px-2 flex items-center justify-center text-base font-bold text-white bg-blurple-400 dark:bg-purple-600 opacity-60 py-1 w-1/4" disabled="" id="contact-next" type="button">Next</button></div></div><div class="mt-4 flex justify-end items-start gap-1"><div><p class="text-sm text-gray-800 dark:text-slate-100 font-normal">Backed by</p></div><div><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" x="0" y="0" viewBox="0 0 1604 320" style="enable-background:new 0 0 1604 320" xml:space="preserve" role="img" height="22"><style>.st0{fill-rule:evenodd;clip-rule:evenodd;fill:#fb651e}</style><g id="Group-19"><path id="Fill-1" class="st0" d="M0 320h320V0H0z"></path><path id="Fill-2" style="fill-rule:evenodd;clip-rule:evenodd;fill:#fff" d="M173 175.9V247h-27v-71.1L77.1 73H110l49.6 76L209 73h32.9z"></path><g id="Group-18" transform="translate(425.854 73.217)"><path id="Fill-3" class="st0" d="M81.8 34.1C52.2 34.1 30 57 30 86.6s22.2 52.7 51.8 52.7c19 0 35.5-9.8 44.4-26.3l25.4 15.1c-14.2 24.3-40.8 40.1-69.8 40.1C36.2 168.1 0 131.9 0 86.6 0 41.2 36.2 5 81.8 5c29.3 0 55.6 15.6 69.8 40.1l-25.4 15.1c-9-16.5-25.4-26.1-44.4-26.1"></path><path id="Fill-5" class="st0" d="M249.2 107.2c0-18.5-13.5-32.5-30.9-32.5-17.9 0-31.4 14-31.4 32.5s13.5 32.5 31.4 32.5c17.1 0 30.9-14 30.9-32.5m-91.4 0c0-33.4 26.8-60.2 60.5-60.2 33.2 0 60 26.8 60 60.2s-26.8 60.2-60 60.2c-33.7 0-60.5-26.8-60.5-60.2"></path><path id="Fill-7" class="st0" d="M467.1 97.6v67.2h-29v-62.1c0-17.4-8.5-28.4-21.3-28.4-13.1 0-22.7 11-22.7 28.4v62.1h-28v-62.1c0-17.4-8.8-28.4-21.7-28.4-12.9 0-22.3 11-22.3 28.4v62.1h-29v-115h29v14.7c7.1-11 18.1-17.9 31.6-17.9 14.7 0 26.3 8.3 33.4 21.2 7.3-11.5 20.8-21.2 37.8-21.2 25.5 0 42.2 22.5 42.2 51"></path><path id="Fill-9" class="st0" d="M570.2 108.4c0-19.2-11.9-33-28.6-33-16.3 0-28.6 13.1-28.6 32.7 0 19.5 12.6 32.7 29.1 32.7 16.2-.1 28.1-13.6 28.1-32.4m-22.5 59.4c-16 0-27.8-7.3-34.6-17.4v14.4h-29V4.8h29v59c7-9.4 18.8-16.2 34.1-16.2 29.7 0 52.4 25.6 52.9 60.1.5 34.9-22.7 60.1-52.4 60.1"></path><path id="Fill-11" class="st0" d="M612.1 164.8h29v-115h-29v115zm-3.7-147.6c0-9.8 8.2-17.2 18.1-17.2 9.6 0 17.6 7.3 17.6 17.2 0 9.8-8 17.2-17.6 17.2-9.8-.1-18.1-7.4-18.1-17.2z"></path><path id="Fill-13" class="st0" d="M766.1 98.1v66.7h-28v-60.5c0-18.5-9.7-30-23.7-30-15.4 0-26.3 14-26.3 30.5v60h-28v-115h28v14.5c7.8-10.8 20.3-17.7 34.9-17.7 25.8 0 43.1 22 43.1 51.5"></path><path id="Fill-14" class="st0" d="M854.1 113.8v-2.5l-29.3 5.7c-9.8 2.3-15.8 7.3-15.8 14 0 7.1 6.5 12.4 17.2 12.1 15.4-.5 27.9-13.9 27.9-29.3m28-18.4v69.4h-28v-13.3c-8.5 9.2-21.8 16-36.5 16.3-19.5 0-36.7-12.8-36.7-34.8 0-20.8 15.6-32.7 38.8-37.3l33.7-6.4c-2.3-9.6-9.6-16.9-20.7-16.9-11 0-21.3 6.9-27.5 15.6l-21.1-15.3c10.8-15.1 29.8-25.2 48.7-25.2 28.2-.2 49.3 19.3 49.3 47.9"></path><path id="Fill-15" class="st0" d="M941.1 75.8V124c0 9.4 4.1 13.7 12.6 13.7h14.4v27h-18.4c-24.5 0-36.6-12-36.6-37.2V75.8h-21v-26h20V21.4l29-8.9v37.3h27v26h-27z"></path><path id="Fill-16" class="st0" d="M1069 107.2c0-18.5-13.5-32.5-30.9-32.5-17.9 0-31.4 14-31.4 32.5s13.5 32.5 31.4 32.5c17.1 0 30.9-14 30.9-32.5m-91.4 0c0-33.4 26.8-60.2 60.5-60.2 33.2 0 60 26.8 60 60.2s-26.8 60.2-60 60.2c-33.7 0-60.5-26.8-60.5-60.2"></path><path id="Fill-17" class="st0" d="M1178.1 47.3v27.9c-25.9 0-37 12.6-37 29.1v60.5h-28v-115h28v14.4c7.9-10.3 20.6-16.9 37-16.9"></path></g></g></svg></div></div></div></div><div class="mt-3 pt-3 md:mt-4 md:pt-4 border-0 border-t border-solid border-gray-200 dark:border-slate-400 flex items-center justify-between"><div class="text-sm text-gray-800 dark:text-slate-100 font-normal m-0"><div class="footer__copyright">Copyright © 2023, moonrepo, Inc.</div></div><div class="flex space-x-2"><a href="https://github.com/moonrepo" target="_blank" rel="noopener noreferrer" class="cursor-pointer text-base text-blurple-300 hover:text-blurple-500 dark:text-purple-400 dark:hover:text-purple-200 font-normal"><span class="sr-only">GitHub</span><span class="inline-block" aria-hidden="true"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></span></a><a href="https://discord.gg/qCh9MEynv2" target="_blank" rel="noopener noreferrer" class="cursor-pointer text-base text-blurple-300 hover:text-blurple-500 dark:text-purple-400 dark:hover:text-purple-200 font-normal"><span class="sr-only">Discord</span><span class="inline-block" aria-hidden="true"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="discord" class="svg-inline--fa fa-discord" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z"></path></svg></span></a><a href="https://twitter.com/tothemoonrepo" target="_blank" rel="noopener noreferrer" class="cursor-pointer text-base text-blurple-300 hover:text-blurple-500 dark:text-purple-400 dark:hover:text-purple-200 font-normal"><span class="sr-only">Twitter</span><span class="inline-block" aria-hidden="true"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></span></a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.bf8956cd.js"></script>
<script src="/assets/js/main.6c6bb799.js"></script>
</body>
</html>