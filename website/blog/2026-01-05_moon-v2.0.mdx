---
slug: moon-v2.0
title: moon v2.0 - Official "Phobos" release!
authors: [milesj]
tags: []
# image: ./img/moon/v2.0.png
---

TODO

<!--truncate-->

## v2

## Breaking changes

TODO

## Extensions

Extensions are a WASM plugin based system that has existed for some time now, but they only
supported a single functionality: custom execution through the [`moon ext`](/docs/commands/ext)
command. With the introduction of toolchain plugins, we wanted to expand the extension system to
allow for more flexibility and use cases.

To start, we're intoducing a new `.moon/extensions.*` configuration file, that will contain all
extensions, similar to how toolchains are configured in `.moon/toolchains.*`. Because of this
change, the `extensions` setting has been removed from the workspace configuration.

### New APIs

With extensions now being first-class citizens in moon, we've expanded the PDK API to allow for more
functionality. Extensions can now utilize the following API functions, similar to toolchains:

- `extend_project_graph` - Extend projects with aliases, dependencies, and tasks.
- `extend_task_command` - Extend the task command before it's executed.
- `extend_task_script` - Extend the task script before it's executed.
- `sync_project` - Run operations during the project sync process.
- `sync_workspace` - Run operations during the workspace sync process.

## Toolchains

The new toolchain system replaces the legacy platform system and is the biggest change in moon v2.
Toolchains are now powered by WASM plugins, instead of hard-coded in core, allowing for more
flexibility, extensibility, and the ability for the community to create their own toolchains!

Moving to a plugin based system enables us to support more languages, more features, deeper
integration, as well as more complex workflows. For example, in the future we can now easily support
release workflows (changelogs, versioning, publishing) as part of a toolchain.

Just to demonstrate how powerful the plugin system is, it currently supports all the following
features:

- Extending the project graph with project dependencies and aliases
- Extending task commands and scripts before they're executed
- Integrates with our Docker flow for pruning and scaffolding
- Runs operations during the project/workspace sync processes
- Locates a root dependencies directory for package manager workspaces
- Parses manifest and lock files to extract dependencies and metadata
- Sets up the environment and auto-installs dependencies
- Hook into the task hashing process
- Manages downloading and installing tools (via proto)

## Projects

### Multiple aliases

In addition to identifiers, projects also support aliases, which are toolchain specific names
derived from manifest files, for example, the `name` field in `package.json` or `Cargo.toml`. This
allows you to refer to projects by their native names on the command line, in configuration, and
more.

Previously, projects only supported a single alias, but now they support multiple aliases, one from
each applicable toolchain. In addition, we have added a new `$projectAliases` token, which is a
comma-separated list of all aliases. The existing `$projectAlias` token now returns the first alias,
if it exists.

## Tasks

### Toolchain merging

A task can now be associated with multiple toolchains (javascript, node, npm), unlike the previous
platform system which only allowed for 1 platform (node). This change allows for more flexibility
but also requires more granular control over how toolchains are inherited. To accommodate this,
we've added a `mergeToolchains` task option:

```yaml title="moon.yml"
tasks:
  build:
    # ...
    toolchains: ['javascript']
    options:
      mergeToolchains: 'replace'
```

## Docker

### Defaults with overrides

To improve customizability of `Dockerfile` generation, and to allow for more flexibility during the
scaffolding process, we've updated the `docker` settings in `.moon/workspace.*` to act as defaults,
and the `docker` settings in `moon.*` to act as overrides on a per-project basis. Because of this,
we've also updated `docker.file` and `docker.scaffold` settings to be the same across both files.

```yaml title=".moon/workspace.yml"
docker:
  file:
    buildTask: 'build'
```

```yaml title="moon.yml"
docker:
  file:
    buildTask: 'compile'
```

## VCS

### New implementation

In moon v1 we were running an experiment that utilizes a new Git implementation, which we dubbed Git
v2. We've made this the default implementation and removed the legacy implementation. This new
implementation is faster, more reliable, and has better support for complex repositories (worktrees,
submodules, etc). The `experiments.gitV2` setting should now be removed.

## Other changes

View the [official release](https://github.com/moonrepo/moon/releases/tag/v2.0.0) for a full list of
changes.
